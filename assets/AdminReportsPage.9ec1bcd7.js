import{ar as b,as as p,r as S,o as _,a4 as C,w,d as g,f as A,e as u,c as H,a as k,Q as y}from"./index.61c223d1.js";import{u as M}from"./pageHeader.7dd4733c.js";import{E as R,D as j}from"./position-engine.7b4b864d.js";import{a as x,Q as O}from"./QTable.6cf6a4d4.js";import"./focus-manager.e746b2b7.js";import"./use-key-composition.99250c09.js";const $=b("attendanceTest",{state:()=>({}),getters:{},actions:{formatDate(t){const e=t.getFullYear(),a=String(t.getMonth()+1).padStart(2,"0"),n=String(t.getDate()).padStart(2,"0");return`${e}-${a}-${n}`},getAndCheckDateRangesForCurrentMonth(){const t=new Date,e=t.getFullYear(),a=t.getMonth(),n=new Date(e,a,1),o=new Date(e,a,15),s=new Date(e,a,16),l=new Date(e,a+1,0),c={firstHalf:{start:this.formatDate(n),end:this.formatDate(o)},secondHalf:{start:this.formatDate(s),end:this.formatDate(l)}},r=this.formatDate(t),m=new Date(c.firstHalf.start),f=new Date(c.firstHalf.end),i=new Date(c.secondHalf.start),d=new Date(c.secondHalf.end);let h,D;return t>=m&&t<=f?(h=this.formatDate(m),D=this.formatDate(f)):t>=i&&t<=d?(h=this.formatDate(i),D=this.formatDate(d)):(h="out of range",D="out of range"),{todayDate:r,startDate:h,endDate:D}},async checkAdjustmentSalary(){try{const{count:t,error:e}=await p.from("adjustment_salary").select("*",{count:"exact",head:!0}).eq("employee_id","75bfee88-fb93-45dd-8723-9f52916cd3ab").eq("date_start","2024-08-16").eq("date_end","2024-08-31");if(console.log("Checking Adjustment Salary"),e)throw e;return console.log(t),t}catch(t){return console.log(t),0}},async createAdjustmentSalary(){let{todayDate:t,startDate:e,endDate:a}=this.getAndCheckDateRangesForCurrentMonth();console.log(t,e,a);try{const{data:n,error:o}=await p.from("adjustment_salary").insert({employee_id:"75bfee88-fb93-45dd-8723-9f52916cd3ab",date_start:e,date_end:a}).select();if(console.log("Created Adjustment Salary"),o)throw o;return console.log(n[0].id),n[0].id}catch(n){console.log(n)}},async inputAttendance(t){try{const e=new Date,{data:a,error:n}=await p.from("attendance").insert({adjustment_salary_id:t,employee_id:"75bfee88-fb93-45dd-8723-9f52916cd3ab",time_in:"08:00:00",time_out:"16:00:00",date:this.formatDate(e)}).select();if(console.log("Input Attendance"),n)throw n;console.log(a)}catch(e){console.log(e)}},async processAttendance(){try{const t=await this.checkAdjustmentSalary();if(t===0){const e=await this.createAdjustmentSalary();await this.inputAttendance(e)}else await this.inputAttendance(t)}catch(t){console.error("An error occurred:",t)}}}}),T=b("attendanceTable",{state:()=>({rows:[],selectedDate:null,selectedDateOptions:null,attendanceColumns:{columns:[]}}),getters:{getSelectedDate(){return this.selectedDate}},actions:{formatDate(t){const e=t.getFullYear(),a=String(t.getMonth()+1).padStart(2,"0"),n=String(t.getDate()).padStart(2,"0");return`${e}-${a}-${n}`},getAndCheckDateRangesForCurrentMonth(){const t=new Date,e=t.getFullYear(),a=t.getMonth(),n=new Date(e,a,1),o=new Date(e,a,15),s=new Date(e,a,16),l=new Date(e,a+1,0),c={firstHalf:{start:this.formatDate(n),end:this.formatDate(o)},secondHalf:{start:this.formatDate(s),end:this.formatDate(l)}},r=this.formatDate(t),m=new Date(c.firstHalf.start),f=new Date(c.firstHalf.end),i=new Date(c.secondHalf.start),d=new Date(c.secondHalf.end);let h,D;return t>=m&&t<=f?(h=this.formatDate(m),D=this.formatDate(f)):t>=i&&t<=d?(h=this.formatDate(i),D=this.formatDate(d)):(h="out of range",D="out of range"),{todayDate:r,startDate:h,endDate:D}},async getSalaryHistory(){try{const{data:t,error:e}=await p.from("salary_history").select();e&&console.error(e),this.selectedDateOptions=t}catch(t){console.error(t)}},async fetchAttendanceInRange(t=this.selectedDate.date_start,e=this.selectedDate.date_end){try{const{data:a,error:n}=await p.from("attendance").select(`
            *,
            employee:employee_id (
              first_name,
              last_name
            )
          `).gte("date",t).lte("date",e);if(n)console.error("Error fetching data:",n);else{const o=a.reduce((s,l)=>(s[l.employee_id]||(s[l.employee_id]=[]),s[l.employee_id].push(l),s),{});this.rows=Object.values(o),console.log("This is row",this.rows)}}catch(a){console.error(a)}},columns(t=this.selectedDate.date_start,e=this.selectedDate.date_end){const a=new Date(t),n=new Date(e),o=[],s={day:"numeric",month:"numeric"};let l=0;for(let r=new Date(a);r<=n;r.setDate(r.getDate()+1)){const m=r.getDate(),f=new Intl.DateTimeFormat("en-US",s).format(r);o.push((()=>{const i=l;return{name:`${m}`,align:"center",label:`${f}`,sortable:!0,field:d=>d[i]&&d[i].time_in&&d[i].time_out?"Present":d[i]===void 0||d[i]===null?"N/A":"Absent",format:d=>`${d}`}})()),l++}console.log(o);const c=[{name:"employeeName",align:"center",label:"Name",sortable:!0,field:r=>r[0].employee.first_name+" "+r[0].employee.last_name,format:r=>`${r}`},...o,{name:"totalPresent",align:"center",label:"P",sortable:!0},{name:"totalLate",align:"center",label:"L",sortable:!0},{name:"totalAbsent",align:"center",label:"A",sortable:!0},{name:"totalLeave",align:"center",label:"LVE",sortable:!0}];this.attendanceColumns.columns.push(...c)},getNearestDateRange(){if(this.selectedDate!=null)return;const t=new Date;function e(s){return new Date(s)}function a(s){return Math.abs(t-s)}let n=null,o=1/0;for(const s of this.selectedDateOptions){const l=e(s.date_start),c=e(s.date_end),r=a(l),m=a(c),f=Math.min(r,m);f<o&&(o=f,n=s)}this.selectedDate=n},async fetchAttendanceReports(){this.attendanceColumns.columns=[],await this.getSalaryHistory(),this.getNearestDateRange(),this.columns(),this.fetchAttendanceInRange()}}}),E={__name:"AttendanceTable",setup(t){const e=T(),a=S("");return e.fetchAttendanceReports(),(n,o)=>(_(),C(O,{class:"tw-border tw-rounded-3xl tw-shadow-lg",flat:"",bordered:"",dense:"",title:"Attendance Report","title-class":["tw-text-xl","tw-font-bold"],filter:a.value,columns:u(e).attendanceColumns.columns,rows:u(e).rows,"rows-per-page-options":[0],separator:"cell","row-key":"name"},{"top-left":w(()=>[g(x,{filled:"",modelValue:u(e).selectedDate,"onUpdate:modelValue":[o[0]||(o[0]=s=>u(e).selectedDate=s),o[1]||(o[1]=s=>u(e).fetchAttendanceReports())],"use-input":"","hide-selected":"","fill-input":"","hide-bottom-space":"","input-debounce":"0",options:u(e).selectedDateOptions,"option-label":s=>s.date_start+" "+s.date_end,class:"!tw-pb-0"},{"no-option":w(()=>[g(R,null,{default:w(()=>[g(j,{class:"text-grey"},{default:w(()=>[A(" No results ")]),_:1})]),_:1})]),_:1},8,["modelValue","options","option-label"])]),_:1},8,["filter","columns","rows"]))}},F={class:"tw-w-12/12 tw-max-w-full tw-mx-auto tw-bg-white tw-shadow-lg tw-border tw-rounded-3xl tw-border-collapse tw-p-4 tw-mt-0"},B={__name:"AdminReportsPage",setup(t){const e=$(),a=M();return a.currentPage="Reports",(n,o)=>(_(),H("div",F,[k("div",null,[g(E),A(" \xA0 "),g(y,{icon:"mdi-plus",label:"Check Date Ranges for Current Month",onClick:u(e).getAndCheckDateRangesForCurrentMonth,class:"tw-bg-white"},null,8,["onClick"]),g(y,{icon:"mdi-plus",label:"Adjustment Salary",onClick:u(e).checkAdjustmentSalary,class:"tw-bg-white"},null,8,["onClick"]),g(y,{icon:"mdi-plus",label:"createAdjustmentSalary",onClick:u(e).createAdjustmentSalary,class:"tw-bg-white"},null,8,["onClick"]),g(y,{icon:"mdi-plus",label:"createAdjustmentSalary",onClick:u(e).processAttendance,class:"tw-bg-white"},null,8,["onClick"])])]))}};export{B as default};
