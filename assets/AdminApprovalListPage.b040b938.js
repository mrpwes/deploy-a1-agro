import{Q as A}from"./QTd.bf93fd94.js";import{r as f,o as h,c as g,d as e,Q as p,w as l,a as i,e as r,G as S,V as b,a7 as v,u as O,ar as U,as as w,aH as k,f as y}from"./index.bf7e997d.js";import{Q as m}from"./QInput.4134d3c6.js";import{Q as x,a as q}from"./QTable.29d7648c.js";import{d as R}from"./date.102a1a7d.js";import{u as L}from"./pageHeader.ac2658eb.js";import{u as Q,_ as C}from"./ViewApprovalButton.46813c21.js";import{Q as j,C as _}from"./ClosePopup.38ced318.js";import{Q as I,E as V,D}from"./position-engine.a149a9e4.js";import{Q as $}from"./QCardSection.6df096ca.js";import{Q as P}from"./QForm.42f55d2f.js";import{Q as Y}from"./QCard.21da1498.js";import"./use-key-composition.94b308a3.js";import"./focus-manager.1122f075.js";const E={class:"!tw-h-min !tw-w-8/12 !tw-max-w-full tw-bg-white tw-p-6"},F=i("div",{class:"tw-col-span-4 tw-text-3xl tw-font-extrabold tw-pb-3"}," Archived Approval ",-1),M={__name:"ArchivedApprovalButton",setup(s){const o=Q(),d=f(!1),u=f(""),t=[{name:"Request ID",required:!0,label:"Request ID",align:"left",field:a=>a.id,format:a=>`${a}`,sortable:!0},{name:"Request Date",align:"center",label:"Request Date",field:a=>a.request_confirmation.application_date,format:a=>R.formatDate(a,"MMM D, YYYY"),sortable:!0},{name:"Subject",align:"center",label:"Subject",field:"subject",sortable:!0},{name:"Description",align:"center",label:"Description",field:"description",sortable:!0},{name:"Recipient",align:"center",label:"Recipient",field:a=>a.recipient.last_name+" "+a.recipient.first_name,sortable:!0},{name:"actions",align:"center",label:"",field:""}];return(a,n)=>(h(),g(v,null,[e(p,{icon:"mdi-archive",label:"Archived Request",onClick:n[0]||(n[0]=c=>d.value=!0),class:"tw-bg-white"}),e(I,{modelValue:d.value,"onUpdate:modelValue":n[2]||(n[2]=c=>d.value=c),persistent:""},{default:l(()=>[i("div",E,[F,e(x,{class:"my-sticky-header-table tw-w-11/12 tw-mx-auto tw-mt-6 tw-bg-white tw-shadow-lg tw-border tw-rounded-3xl tw-border-collapse",flat:"",bordered:"",filter:u.value,columns:t,rows:r(o).getArchivedApprovalList,"rows-per-page-options":[10,20,0],"row-key":"name"},{"body-cell-actions":l(c=>[e(A,{props:c},{default:l(()=>[i("div",null,[e(C,{rows:c.row},null,8,["rows"])])]),_:2},1032,["props"])]),"top-right":l(()=>[e(m,{borderless:"",dense:"",debounce:"300",modelValue:u.value,"onUpdate:modelValue":n[1]||(n[1]=c=>u.value=c),placeholder:"Search"},{append:l(()=>[e(S,{name:"search"})]),_:1},8,["modelValue"])]),_:1},8,["filter","rows"]),e(j,{align:"right",class:"text-primary"},{default:l(()=>[b(e(p,{flat:"",label:"Cancel"},null,512),[[_]])]),_:1})])]),_:1},8,["modelValue"])],64))}},T=O(),z=U("addApproval",{state:()=>({recipient:null,recipientOptions:null,issuer:null,issuerOptions:null,type:null,typeOptions:["LeaveTODO!!!!","Other"],subject:null,description:null,current_user_id:T.getEmployeeId,insertRequestConfirmationID:null}),getters:{},actions:{async fetchEmployeeOptions(){try{const{data:s,error:o}=await w.from("employee").select("id, first_name, middle_name, last_name");if(o)throw o;this.recipientOptions=s,this.issuerOptions=s}catch(s){console.log(s)}},insertRequestForm(){this.insertRequestConfirmation().then(()=>this.insertRequestFormToRequest()).catch(s=>{console.error("An error occurred:",s)})},async insertRequestFormToRequest(){try{const{error:s}=await w.from("request").insert([{employee_id:this.recipient.id,request_type_id:3,request_confirmation_id:this.insertRequestConfirmationID,request_date:new Date().toLocaleDateString("en-US"),subject:this.subject,description:this.description,remarks:"Pending",is_archive:!1}]);if(s)throw s}catch(s){console.log(s)}},async insertRequestConfirmation(){try{const{data:s,error:o}=await w.from("request_confirmation").insert([{employee_id:this.current_user_id,application_date:new Date().toLocaleDateString("en-US"),request_confirmation_date:new Date().toLocaleDateString("en-US"),status:"Pending",remarks:"Pending",is_archive:!1}]).select("id");if(o)throw o;console.log(s[0].id),this.insertRequestConfirmationID=s[0].id}catch(s){alert(s+"line 81"),console.log(s)}}}}),B={class:"tw-m-4"},N=i("div",{class:"tw-text-3xl tw-font-extrabold tw-pb-3"}," Add Request Form ",-1),H={class:"tw-flex tw-mb-3"},G=i("div",{class:"tw-content-center tw-mr-3"},"Employee Name:",-1),J={class:"tw-flex tw-mb-3"},K=i("div",{class:"tw-content-center tw-mr-3"},"Type:",-1),W={class:"tw-mb-3"},X=i("div",null,"Subject:",-1),Z={class:"tw-pb-3 tw-px-2"},ee={class:"tw-mb-3"},te=i("div",null,"Description:",-1),ae={class:"tw-pb-3 tw-px-2"},oe={__name:"AddApprovalButton",setup(s){const o=z(),d=f(!1);return o.fetchEmployeeOptions(),(u,t)=>(h(),g(v,null,[e(p,{icon:"mdi-plus",label:"Add Request",onClick:t[0]||(t[0]=a=>d.value=!0),class:"tw-bg-white"}),e(I,{modelValue:d.value,"onUpdate:modelValue":t[5]||(t[5]=a=>d.value=a),persistent:""},{default:l(()=>[e(Y,{class:"min-width: 500px"},{default:l(()=>[e(P,{onSubmit:k(r(o).insertRequestForm,["prevent"]),autofocus:""},{default:l(()=>[i("div",B,[e($,{class:"tw-pt-0 tw-pl-0"},{default:l(()=>[N]),_:1}),i("div",H,[G,e(q,{filled:"",modelValue:r(o).recipient,"onUpdate:modelValue":t[1]||(t[1]=a=>r(o).recipient=a),"use-input":"","hide-selected":"","fill-input":"","hide-bottom-space":"","input-debounce":"0",options:r(o).recipientOptions,"option-label":a=>"first_name"in a?a.first_name+" "+a.last_name:"","option-value":u.id,class:"!tw-pb-0; tw-capitalize","popup-content-class":"tw-capitalize"},{"no-option":l(()=>[e(V,null,{default:l(()=>[e(D,{class:"text-grey"},{default:l(()=>[y(" No results ")]),_:1})]),_:1})]),_:1},8,["modelValue","options","option-label","option-value"])]),i("div",J,[K,e(q,{filled:"",modelValue:r(o).type,"onUpdate:modelValue":t[2]||(t[2]=a=>r(o).type=a),"use-input":"","hide-selected":"","fill-input":"","hide-bottom-space":"","input-debounce":"0",options:r(o).typeOptions,class:"!tw-pb-0; tw-capitalize;","popup-content-class":"tw-capitalize"},{"no-option":l(()=>[e(V,null,{default:l(()=>[e(D,{class:"text-grey"},{default:l(()=>[y(" No results ")]),_:1})]),_:1})]),_:1},8,["modelValue","options"])]),i("div",W,[X,i("div",Z,[e(m,{modelValue:r(o).subject,"onUpdate:modelValue":t[3]||(t[3]=a=>r(o).subject=a),filled:"",autogrow:"",class:"tw-max-w-full","lazy-rules":""},null,8,["modelValue"])])]),i("div",ee,[te,i("div",ae,[e(m,{modelValue:r(o).description,"onUpdate:modelValue":t[4]||(t[4]=a=>r(o).description=a),filled:"",autogrow:"",class:"tw-max-w-full","lazy-rules":""},null,8,["modelValue"])])]),e(j,{align:"right",class:"text-primary"},{default:l(()=>[b(e(p,{flat:"",label:"Cancel"},null,512),[[_]]),b(e(p,{flat:"",class:"tw-bg-green-400",label:"Add Loan",type:"submit"},null,512),[[_]])]),_:1})])]),_:1},8,["onSubmit"])]),_:1})]),_:1},8,["modelValue"])],64))}},le={class:"tw-w-11/12 tw-mx-auto tw-flex tw-justify-end tw-mb-5 tw-gap-4"},ge={__name:"AdminApprovalListPage",setup(s){const o=L();o.currentPage="Approval List";const d=Q();d.getApprovalList();const u=[{name:"Request ID",required:!0,label:"Request ID",align:"left",field:t=>t.id,format:t=>`${t}`,sortable:!0},{name:"Request Date",align:"center",label:"Request Date",field:t=>t.request_confirmation.application_date,format:t=>R.formatDate(t,"MMM D, YYYY"),sortable:!0},{name:"Subject",align:"center",label:"Subject",field:"subject",sortable:!0},{name:"Description",align:"center",label:"Description",field:"description",sortable:!0},{name:"Recipient",align:"center",label:"Recipient",field:t=>t.recipient.last_name+" "+t.recipient.first_name,sortable:!0},{name:"actions",align:"center",label:"",field:""}];return(t,a)=>(h(),g(v,null,[i("div",le,[e(M),e(oe)]),e(x,{class:"my-sticky-header-table tw-w-11/12 tw-mx-auto tw-mt-6 tw-bg-white tw-shadow-lg tw-border tw-rounded-3xl tw-border-collapse",flat:"",bordered:"",filter:t.tableSearch,columns:u,rows:r(d).getUnarchivedApprovalList,"rows-per-page-options":[10,20,0],"row-key":"name"},{"body-cell-actions":l(n=>[e(A,{key:"actions",class:"tw-w-2/12",props:n},{default:l(()=>[e(C,{rows:n.row},null,8,["rows"])]),_:2},1032,["props"])]),"top-right":l(()=>[e(m,{borderless:"",dense:"",debounce:"300",modelValue:t.tableSearch,"onUpdate:modelValue":a[0]||(a[0]=n=>t.tableSearch=n),placeholder:"Search"},{append:l(()=>[e(S,{name:"search"})]),_:1},8,["modelValue"])]),_:1},8,["filter","rows"])],64))}};export{ge as default};
