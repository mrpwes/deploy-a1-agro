import{u as rt}from"./pageHeader.6353e771.js";import{at as te,au as O,k as it,r as L,j as M,h as Me,I as ut,p as H,t as ct,ax as dt,T as mt,S as Y,Q as R,i as ft,ai as ht,o as B,c as fe,d as h,n as pt,w as v,aA as gt,e as g,a as S,a8 as V,f as q,a7 as z,aa as yt,G as he}from"./index.699df2e5.js";import{Q as ae}from"./QInput.12796967.js";import{Q as F}from"./QTd.6ee6ef09.js";import{h as K,g as pe,Q as ge}from"./position-engine.8521c1b5.js";import{Q as ye}from"./QSelect.38022951.js";import{Q as _e}from"./QTable.413d4eaa.js";import{u as _t}from"./globalNotification.5eb1dbc4.js";import{T as vt}from"./TouchPan.2c1e326c.js";import{b as wt,u as bt}from"./focus-manager.64be5504.js";import{a as Dt,h as St,i as At}from"./use-key-composition.9ccdcebb.js";import{u as Oe,a as Tt,b as xt,g as Ct,Q as Re}from"./QPopupProxy.41ee7b92.js";import{_ as me,f as It}from"./date.26e16c0f.js";import{C as W,Q as qe}from"./ClosePopup.ed8bbe15.js";import{Q as Et}from"./QForm.492dccf3.js";import{Q as Ht}from"./QDialog.ae33bb74.js";import{Q as Te}from"./QTr.cd2d674a.js";import"./QList.d27f3e86.js";const Fe=te("attendanceTable",{state:()=>({rows:[],selectedDate:null,selectedDateOptions:null,attendanceColumns:{columns:[]}}),getters:{getSelectedDate(){return this.selectedDate}},actions:{capitalizeFirstLetterOfEachWord(e){return e.split(" ").map(t=>t.charAt(0).toUpperCase()+t.slice(1)).join(" ")},formatDate(e){const t=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0"),n=String(e.getDate()).padStart(2,"0");return`${t}-${a}-${n}`},getAndCheckDateRangesForCurrentMonth(){const e=new Date,t=e.getFullYear(),a=e.getMonth(),n=new Date(t,a,1),f=new Date(t,a,15),o=new Date(t,a,16),i=new Date(t,a+1,0),b={firstHalf:{start:this.formatDate(n),end:this.formatDate(f)},secondHalf:{start:this.formatDate(o),end:this.formatDate(i)}},p=this.formatDate(e),y=new Date(b.firstHalf.start),d=new Date(b.firstHalf.end),s=new Date(b.secondHalf.start),r=new Date(b.secondHalf.end);let c,m;return e>=y&&e<=d?(c=this.formatDate(y),m=this.formatDate(d)):e>=s&&e<=r?(c=this.formatDate(s),m=this.formatDate(r)):(c="out of range",m="out of range"),{todayDate:p,startDate:c,endDate:m}},async getSalaryHistory(){try{const{data:e,error:t}=await O.from("salary_history").select();t&&console.error(t),this.selectedDateOptions=e.sort((a,n)=>new Date(a.date_start)-new Date(n.date_start))}catch(e){console.error(e)}},fillMissingDates(e,t,a){console.log("FILLING MISSING DATES"+t+" "+a);const n=i=>{const b=i.getFullYear(),p=String(i.getMonth()+1).padStart(2,"0"),y=String(i.getDate()).padStart(2,"0");return`${b}-${p}-${y}`},f=new Date(t),o=new Date(a);return o.setDate(o.getDate()+1),e.forEach(i=>{const b=new Set(i.attendance.map(p=>p.date));for(let p=new Date(f);p<=o;p.setDate(p.getDate()+1)){const y=n(p);b.has(y)||i.attendance.push({id:null,date:y,employee:{first_name:i.first_name,last_name:i.first_name},remarks:null,time_in:null,time_out:null,employee_id:i.id,adjustment_salary_id:null})}i.attendance.sort((p,y)=>new Date(p.date)-new Date(y.date))}),e},async fetchAttendanceInRange(e=this.selectedDate.date_start,t=this.selectedDate.date_end){try{const{data:a,error:n}=await O.from("employee").select(`*,
             is_archive,
              attendance(*, attendance_type(*), employee(first_name, last_name, company_employee_id))`).gte("attendance.date",e).lte("attendance.date",t).eq("is_archive",!1);n&&console.error(n),this.rows=Object.values(this.fillMissingDates(a,e,t))}catch(a){console.error(a)}},columns(e=this.selectedDate.date_start,t=this.selectedDate.date_end){const a=new Date(e),n=new Date(t),f=[],o={day:"numeric",month:"numeric"},i=["S","M","T","W","TH","F","S"];for(let p=new Date(a);p<=n;p.setDate(p.getDate()+1)){p.getDate();const y=new Intl.DateTimeFormat("en-US",o).format(p),d=p.getDay(),s=`${y} ${i[d]}`;f.push((()=>({name:"actions",align:"center",label:`${s}`,sortable:!0}))())}const b=[{name:"employeeName",align:"center",label:"Name",sortable:!0,field:p=>p.company_employee_id+" - "+p.last_name+", "+p.first_name,format:p=>`${p}`},...f,{name:"totalHours",align:"center",label:"Total Hours",sortable:!0,field:p=>{let y=0;return p.attendance.forEach(d=>{if(d.time_out===null&&d.time_in!==null)y+=0;else if(d.attendance_type_id!==1&&d.attendance_type_id!==void 0)y+=8;else if(d.time_in&&d.time_out){const s=new Date(d.time_in),r=new Date(d.time_out),c=new Date(s);c.setHours(8,0,0,0),s<c&&s.setHours(8,0,0,0);const m=new Date(r);m.setHours(17,0,0,0),r>m&&r.setHours(17,0,0,0);let w=(r-s)/(1e3*60*60);const x=new Date(r);x.setHours(13,0,0,0),r>x&&(w-=1),y+=w}}),y.toFixed(2)}},{name:"totalAbsent",align:"center",label:"A",sortable:!0,field:p=>{let y=0;const d=new Date;for(let s=0;s<p.attendance.length;s++)new Date(p.attendance[s].date)<=d&&(!p.attendance[s].time_in||!p.attendance[s].time_out)&&y++;return y}},{name:"totalLeave",align:"center",label:"LVE",field:p=>{let y=0;for(let d=0;d<p.attendance.length;d++)p.attendance[d].attendance_type_id==2&&y++;return y}}];this.attendanceColumns.columns.push(...b)},getNearestDateRange(){if(this.selectedDate!=null)return;const e=new Date;function t(o){return new Date(o)}function a(o){return Math.abs(e-o)}let n=null,f=1/0;for(const o of this.selectedDateOptions){const i=t(o.date_start),b=t(o.date_end),p=a(i),y=a(b),d=Math.min(p,y);d<f&&(f=d,n=o)}this.selectedDate=n},async fetchAttendanceReports(){this.attendanceColumns.columns=[],await this.getSalaryHistory(),this.getNearestDateRange(),this.columns(),this.fetchAttendanceInRange()}}}),$e=_t(),kt=Fe(),Ne=te("reportsViewAttendanceTable",{state:()=>({attendanceID:null,attendanceDate:null,attendanceRemarks:null,attendanceTimeIn:null,attendanceTimeInProxy:null,attendanceTimeOut:null,attendanceTimeOutProxy:null,attendanceEmployeeID:null,attendanceType:null,attendanceAdjustmentSalaryID:null,listOfAttendanceType:[],listOfAdjustmentSalary:[],hourOptions:[8,9,10,11,12,13,14,15,16,17],is_editing:!1}),getters:{getIsEditing(e){return e.is_editing},getFormattedTimeIn(e){if(e.attendanceTimeOut===null)return null;const t=new Date(e.attendanceTimeIn);let a=t.getHours();const n=t.getMinutes(),f=a>=12?"PM":"AM";a=a%12,a=a||12;const o=n<10?"0"+n:n;return`${a}:${o} ${f}`},getFormattedTimeOut(e){if(e.attendanceTimeOut===null)return null;const t=new Date(e.attendanceTimeOut);let a=t.getHours();const n=t.getMinutes(),f=a>=12?"PM":"AM";a=a%12,a=a||12;const o=n<10?"0"+n:n;return`${a}:${o} ${f}`}},actions:{updateProxy(e){e==!0?this.attendanceTimeInProxy=this.attendanceTimeIn:this.attendanceTimeOutProxy=this.attendanceTimeOut},saveProxy(e){e==!0?this.attendanceTimeIn=this.attendanceTimeInProxy:this.attendanceTimeOut=this.attendanceTimeOutProxy},async fetchAttendanceTable(){const{data:e,error:t}=await O.from("attendance").select("*").eq("id");if(t)console.log(t);else return e},async fetchAttendanceType(){const{data:e,error:t}=await O.from("attendance_type").select("*");t?console.log(t):this.listOfAttendanceType=e},async fetchAdjustmentSalary(){const{data:e,error:t}=await O.from("adjustment_salary").select("*");t?console.log(t):this.listOfAdjustmentSalary=e},async updateAttendance(){const{error:e}=await O.from("attendance").update({date:this.attendanceDate,remarks:this.attendanceRemarks,time_in:this.attendanceTimeIn,time_out:this.attendanceTimeOut,employee_id:this.attendanceEmployeeID,attendance_type_id:this.attendanceType,adjustment_salary_id:this.attendanceAdjustmentSalaryID}).eq("id",this.attendanceID);e?$e.showErrorNotification("Failed to update attendance"):(kt.fetchAttendanceReports(),$e.showSuccessNotification("Attendance updated successfully"),this.is_editing=!1)},resetForm(){this.attendanceID=null,this.attendanceDate=null,this.attendanceRemarks=null,this.attendanceTimeIn=null,this.attendanceTimeInProxy=null,this.attendanceTimeOut=null,this.attendanceTimeOutProxy=null,this.attendanceEmployeeID=null,this.attendanceType=null,this.attendanceAdjustmentSalaryID=null,this.is_editing=!1}}});function Mt(e,t){if(e.hour!==null){if(e.minute===null)return"minute";if(t===!0&&e.second===null)return"second"}return"hour"}function Ot(){const e=new Date;return{hour:e.getHours(),minute:e.getMinutes(),second:e.getSeconds(),millisecond:e.getMilliseconds()}}var Pe=it({name:"QTime",props:{...wt,...Dt,...Oe,modelValue:{required:!0,validator:e=>typeof e=="string"||e===null},mask:{...Oe.mask,default:null},format24h:{type:Boolean,default:null},defaultDate:{type:String,validator:e=>/^-?[\d]+\/[0-1]\d\/[0-3]\d$/.test(e)},options:Function,hourOptions:Array,minuteOptions:Array,secondOptions:Array,withSeconds:Boolean,nowBtn:Boolean},emits:Tt,setup(e,{slots:t,emit:a}){const n=ct(),{$q:f}=n.proxy,o=bt(e,f),{tabindex:i,headerClass:b,getLocale:p,getCurrentDate:y}=xt(e,f),d=St(e),s=At(d);let r,c;const m=L(null),w=M(()=>Ye()),x=M(()=>p()),E=M(()=>Ke()),N=me(e.modelValue,w.value,x.value,e.calendar,E.value),A=L(Mt(N)),_=L(N),I=L(N.hour===null||N.hour<12),G=M(()=>`q-time q-time--${e.landscape===!0?"landscape":"portrait"}`+(o.value===!0?" q-time--dark q-dark":"")+(e.disable===!0?" disabled":e.readonly===!0?" q-time--readonly":"")+(e.bordered===!0?" q-time--bordered":"")+(e.square===!0?" q-time--square no-border-radius":"")+(e.flat===!0?" q-time--flat no-shadow":"")),ne=M(()=>{const l=_.value;return{hour:l.hour===null?"--":$.value===!0?K(l.hour):String(I.value===!0?l.hour===0?12:l.hour:l.hour>12?l.hour-12:l.hour),minute:l.minute===null?"--":K(l.minute),second:l.second===null?"--":K(l.second)}}),$=M(()=>e.format24h!==null?e.format24h:f.lang.date.format24h),Ue=M(()=>{const l=A.value==="hour",u=l===!0?12:60,D=_.value[A.value];let k=`rotate(${Math.round(D*(360/u))-180}deg) translateX(-50%)`;return l===!0&&$.value===!0&&_.value.hour>=12&&(k+=" scale(.7)"),{transform:k}}),xe=M(()=>_.value.hour!==null),je=M(()=>xe.value===!0&&_.value.minute!==null),X=M(()=>e.hourOptions!==void 0?l=>e.hourOptions.includes(l):e.options!==void 0?l=>e.options(l,null,null):null),le=M(()=>e.minuteOptions!==void 0?l=>e.minuteOptions.includes(l):e.options!==void 0?l=>e.options(_.value.hour,l,null):null),oe=M(()=>e.secondOptions!==void 0?l=>e.secondOptions.includes(l):e.options!==void 0?l=>e.options(_.value.hour,_.value.minute,l):null),j=M(()=>{if(X.value===null)return null;const l=re(0,11,X.value),u=re(12,11,X.value);return{am:l,pm:u,values:l.values.concat(u.values)}}),J=M(()=>le.value!==null?re(0,59,le.value):null),Z=M(()=>oe.value!==null?re(0,59,oe.value):null),se=M(()=>{switch(A.value){case"hour":return j.value;case"minute":return J.value;case"second":return Z.value}}),Be=M(()=>{let l,u,D=0,C=1;const k=se.value!==null?se.value.values:void 0;A.value==="hour"?$.value===!0?(l=0,u=23):(l=0,u=11,I.value===!1&&(D=12)):(l=0,u=55,C=5);const U=[];for(let T=l,P=l;T<=u;T+=C,P++){const Q=T+D,ot=k!==void 0&&k.includes(Q)===!1,st=A.value==="hour"&&T===0?$.value===!0?"00":"12":T;U.push({val:Q,index:P,disable:ot,label:st})}return U}),Qe=M(()=>[[vt,We,void 0,{stop:!0,prevent:!0,mouse:!0}]]);Me(()=>e.modelValue,l=>{const u=me(l,w.value,x.value,e.calendar,E.value);(u.dateHash!==_.value.dateHash||u.timeHash!==_.value.timeHash)&&(_.value=u,u.hour===null?A.value="hour":I.value=u.hour<12)}),Me([w,x],()=>{ft(()=>{Ae()})});function Ce(){const l={...y(),...Ot()};Ae(l),Object.assign(_.value,l),A.value="hour"}function re(l,u,D){const C=Array.apply(null,{length:u+1}).map((k,U)=>{const T=U+l;return{index:T,val:D(T)===!0}}).filter(k=>k.val===!0).map(k=>k.index);return{min:C[0],max:C[C.length-1],values:C,threshold:u+1}}function Ie(l,u,D){const C=Math.abs(l-u);return Math.min(C,D-C)}function ve(l,{min:u,max:D,values:C,threshold:k}){if(l===u)return u;if(l<u||l>D)return Ie(l,u,k)<=Ie(l,D,k)?u:D;const U=C.findIndex(Q=>l<=Q),T=C[U-1],P=C[U];return l-T<=P-l?T:P}function Ye(){return e.calendar!=="persian"&&e.mask!==null?e.mask:`HH:mm${e.withSeconds===!0?":ss":""}`}function Ke(){if(typeof e.defaultDate!="string"){const l=y(!0);return l.dateHash=Ct(l),l}return me(e.defaultDate,"YYYY/MM/DD",void 0,e.calendar)}function we(){return ht(n)===!0||se.value!==null&&(se.value.values.length===0||A.value==="hour"&&$.value!==!0&&j.value[I.value===!0?"am":"pm"].values.length===0)}function be(){const l=m.value,{top:u,left:D,width:C}=l.getBoundingClientRect(),k=C/2;return{top:u+k,left:D+k,dist:k*.7}}function We(l){if(we()!==!0){if(l.isFirst===!0){r=be(),c=ie(l.evt,r);return}c=ie(l.evt,r,c),l.isFinal===!0&&(r=!1,c=null,Ee())}}function Ee(){A.value==="hour"?A.value="minute":e.withSeconds&&A.value==="minute"&&(A.value="second")}function ie(l,u,D){const C=dt(l),k=Math.abs(C.top-u.top),U=Math.sqrt(Math.pow(Math.abs(C.top-u.top),2)+Math.pow(Math.abs(C.left-u.left),2));let T,P=Math.asin(k/U)*(180/Math.PI);if(C.top<u.top?P=u.left<C.left?90-P:270+P:P=u.left<C.left?P+90:270-P,A.value==="hour"){if(T=P/30,j.value!==null){const Q=$.value!==!0?I.value===!0:j.value.am.values.length!==0&&j.value.pm.values.length!==0?U>=u.dist:j.value.am.values.length!==0;T=ve(T+(Q===!0?0:12),j.value[Q===!0?"am":"pm"])}else T=Math.round(T),$.value===!0?U<u.dist?T<12&&(T+=12):T===12&&(T=0):I.value===!0&&T===12?T=0:I.value===!1&&T!==12&&(T+=12);$.value===!0&&(I.value=T<12)}else T=Math.round(P/6)%60,A.value==="minute"&&J.value!==null?T=ve(T,J.value):A.value==="second"&&Z.value!==null&&(T=ve(T,Z.value));return D!==T&&at[A.value](T),T}const De={hour(){A.value="hour"},minute(){A.value="minute"},second(){A.value="second"}};function ze(l){l.keyCode===13&&He()}function Ge(l){l.keyCode===13&&ke()}function Xe(l){we()!==!0&&(f.platform.is.desktop!==!0&&ie(l,be()),Ee())}function Je(l){we()!==!0&&ie(l,be())}function Ze(l){if(l.keyCode===13)A.value="hour";else if([37,39].includes(l.keyCode)){const u=l.keyCode===37?-1:1;if(j.value!==null){const D=$.value===!0?j.value.values:j.value[I.value===!0?"am":"pm"].values;if(D.length===0)return;if(_.value.hour===null)ue(D[0]);else{const C=(D.length+D.indexOf(_.value.hour)+u)%D.length;ue(D[C])}}else{const D=$.value===!0?24:12,C=$.value!==!0&&I.value===!1?12:0,k=_.value.hour===null?-u:_.value.hour;ue(C+(24+k+u)%D)}}}function et(l){if(l.keyCode===13)A.value="minute";else if([37,39].includes(l.keyCode)){const u=l.keyCode===37?-1:1;if(J.value!==null){const D=J.value.values;if(D.length===0)return;if(_.value.minute===null)ce(D[0]);else{const C=(D.length+D.indexOf(_.value.minute)+u)%D.length;ce(D[C])}}else{const D=_.value.minute===null?-u:_.value.minute;ce((60+D+u)%60)}}}function tt(l){if(l.keyCode===13)A.value="second";else if([37,39].includes(l.keyCode)){const u=l.keyCode===37?-1:1;if(Z.value!==null){const D=Z.value.values;if(D.length===0)return;if(_.value.seconds===null)de(D[0]);else{const C=(D.length+D.indexOf(_.value.second)+u)%D.length;de(D[C])}}else{const D=_.value.second===null?-u:_.value.second;de((60+D+u)%60)}}}function ue(l){_.value.hour!==l&&(_.value.hour=l,ee())}function ce(l){_.value.minute!==l&&(_.value.minute=l,ee())}function de(l){_.value.second!==l&&(_.value.second=l,ee())}const at={hour:ue,minute:ce,second:de};function He(){I.value===!1&&(I.value=!0,_.value.hour!==null&&(_.value.hour-=12,ee()))}function ke(){I.value===!0&&(I.value=!1,_.value.hour!==null&&(_.value.hour+=12,ee()))}function Se(l){const u=e.modelValue;A.value!==l&&u!==void 0&&u!==null&&u!==""&&typeof u!="string"&&(A.value=l)}function ee(){if(X.value!==null&&X.value(_.value.hour)!==!0){_.value=me(),Se("hour");return}if(le.value!==null&&le.value(_.value.minute)!==!0){_.value.minute=null,_.value.second=null,Se("minute");return}if(e.withSeconds===!0&&oe.value!==null&&oe.value(_.value.second)!==!0){_.value.second=null,Se("second");return}_.value.hour===null||_.value.minute===null||e.withSeconds===!0&&_.value.second===null||Ae()}function Ae(l){const u=Object.assign({..._.value},l),D=e.calendar==="persian"?K(u.hour)+":"+K(u.minute)+(e.withSeconds===!0?":"+K(u.second):""):It(new Date(u.year,u.month===null?null:u.month-1,u.day,u.hour,u.minute,u.second,u.millisecond),w.value,x.value,u.year,u.timezoneOffset);u.changed=D!==e.modelValue,a("update:modelValue",D,u)}function nt(){const l=[H("div",{class:"q-time__link "+(A.value==="hour"?"q-time__link--active":"cursor-pointer"),tabindex:i.value,onClick:De.hour,onKeyup:Ze},ne.value.hour),H("div",":"),H("div",xe.value===!0?{class:"q-time__link "+(A.value==="minute"?"q-time__link--active":"cursor-pointer"),tabindex:i.value,onKeyup:et,onClick:De.minute}:{class:"q-time__link"},ne.value.minute)];e.withSeconds===!0&&l.push(H("div",":"),H("div",je.value===!0?{class:"q-time__link "+(A.value==="second"?"q-time__link--active":"cursor-pointer"),tabindex:i.value,onKeyup:tt,onClick:De.second}:{class:"q-time__link"},ne.value.second));const u=[H("div",{class:"q-time__header-label row items-center no-wrap",dir:"ltr"},l)];return $.value===!1&&u.push(H("div",{class:"q-time__header-ampm column items-between no-wrap"},[H("div",{class:"q-time__link "+(I.value===!0?"q-time__link--active":"cursor-pointer"),tabindex:i.value,onClick:He,onKeyup:ze},"AM"),H("div",{class:"q-time__link "+(I.value!==!0?"q-time__link--active":"cursor-pointer"),tabindex:i.value,onClick:ke,onKeyup:Ge},"PM")])),H("div",{class:"q-time__header flex flex-center no-wrap "+b.value},u)}function lt(){const l=_.value[A.value];return H("div",{class:"q-time__content col relative-position"},[H(mt,{name:"q-transition--scale"},()=>H("div",{key:"clock"+A.value,class:"q-time__container-parent absolute-full"},[H("div",{ref:m,class:"q-time__container-child fit overflow-hidden"},[Y(H("div",{class:"q-time__clock cursor-pointer non-selectable",onClick:Xe,onMousedown:Je},[H("div",{class:"q-time__clock-circle fit"},[H("div",{class:"q-time__clock-pointer"+(_.value[A.value]===null?" hidden":e.color!==void 0?` text-${e.color}`:""),style:Ue.value}),Be.value.map(u=>H("div",{class:`q-time__clock-position row flex-center q-time__clock-pos-${u.index}`+(u.val===l?" q-time__clock-position--active "+b.value:u.disable===!0?" q-time__clock-position--disable":"")},[H("span",u.label)]))])]),Qe.value)])])),e.nowBtn===!0?H(R,{class:"q-time__now-button absolute",icon:f.iconSet.datetime.now,unelevated:!0,size:"sm",round:!0,color:e.color,textColor:e.textColor,tabindex:i.value,onClick:Ce}):null])}return n.proxy.setNow=Ce,()=>{const l=[lt()],u=ut(t.default);return u!==void 0&&l.push(H("div",{class:"q-time__actions"},u)),e.name!==void 0&&e.disable!==!0&&s(l,"push"),H("div",{class:G.value,tabindex:-1},[nt(),H("div",{class:"q-time__main col overflow-auto"},l)])}}});const Rt={key:0,class:"!tw-h-min !tw-w-4/12 !tw-max-w-full tw-bg-white tw-p-6"},qt={class:"tw-grid tw-gap-7"},$t={class:"tw-text-3xl tw-font-extrabold tw-flex tw-justify-between"},Pt={class:"tw-flex tw-justify-between"},Vt={class:"row items-center justify-end q-gutter-sm"},Ft={class:"row items-center justify-end q-gutter-sm"},Nt={key:1},Lt={__name:"ViewAttendance",props:["rows","column","columns","qBtnLabel","qBtnClass"],setup(e){const t=Ne(),a=L(!1),n=L(null),f=L(null),o=L(null);function i(d,s,r){f.value=b(r,s),n.value=d.row.attendance[f.value-1],a.value=!0,o.value=p(n),console.log(o.value),t.attendanceID=n.value.id,t.attendanceDate=n.value.date,t.attendanceRemarks=n.value.remarks,t.attendanceTimeIn=n.value.time_in,t.attendanceTimeOut=n.value.time_out,t.attendanceEmployeeID=n.value.employee_id,t.attendanceType=n.value.attendance_type_id,t.attendanceAdjustmentSalaryID=n.value.adjustment_salary_id}function b(d,s){return d.findIndex(r=>r.name===s.name&&r.align===s.align&&r.label===s.label&&r.sortable===s.sortable&&r.__iconClass===s.__iconClass&&r.__thClass===s.__thClass)}function p(d){const s=new Date;if(new Date(d.date)>=s)return"N/A";let c;const m=d.time_in?new Date(d.time_in):null,w=d.time_out?new Date(d.time_out):null;if(w===null&&m!==null)return"No Time Out";if(d.attendance_type_id!==1&&d.attendance_type_id!==void 0)return y(d.attendance_type.attendance_type_name);if(m){const x=new Date(m);x.setHours(8,0,0,0),m<x&&m.setHours(8,0,0,0)}if(w){const x=new Date(w);if(x.setHours(17,0,0,0),w>x&&w.setHours(17,0,0,0),m&&w){c=((w-m)/(1e3*60*60)).toFixed(2);const E=new Date(w);E.setHours(13,0,0,0),w>E&&(c=(parseFloat(c)-1).toFixed(2))}else c="No Time Out"}else c="No Time Out";return c}function y(d){return d.replace(/\b\w/g,s=>s.toUpperCase())}return(d,s)=>(B(),fe(yt,null,[h(R,{unelevated:"",padding:"none",label:e.qBtnLabel,onClick:s[0]||(s[0]=r=>i(e.rows,e.column,e.columns)),class:pt(e.qBtnClass)},null,8,["label","class"]),h(Ht,{modelValue:a.value,"onUpdate:modelValue":s[10]||(s[10]=r=>a.value=r),persistent:""},{default:v(()=>[n.value.id!=null&&n.value.attendance_type_id==1?(B(),fe("div",Rt,[h(Et,{onSubmit:s[9]||(s[9]=gt(r=>g(t).updateAttendance(),["prevent"]))},{default:v(()=>[S("div",qt,[S("div",$t,[S("div",null,"Attendance ID: "+V(n.value.id),1),S("div",null,V(e.column.label),1)]),S("div",null," Employee: "+V(n.value.employee.company_employee_id)+" - "+V(n.value.employee.last_name)+", "+V(n.value.employee.first_name),1),S("div",null,[q(" Remarks: "),h(ae,{rounded:"",standout:"bg-teal text-white",modelValue:g(t).attendanceRemarks,"onUpdate:modelValue":s[1]||(s[1]=r=>g(t).attendanceRemarks=r),type:"textarea",autogrow:"",disable:!g(t).is_editing},null,8,["modelValue","disable"])]),S("div",Pt,[S("div",null,[q(" Time In: "),h(R,{rounded:"",standout:"bg-teal text-white",icon:"access_time",label:g(t).getFormattedTimeIn,disable:!g(t).is_editing},{default:v(()=>[h(Re,{onBeforeShow:s[4]||(s[4]=r=>g(t).updateProxy(d.isTimeIn=!0)),cover:"","transition-show":"scale","transition-hide":"scale"},{default:v(()=>[h(Pe,{modelValue:g(t).attendanceTimeInProxy,"onUpdate:modelValue":s[3]||(s[3]=r=>g(t).attendanceTimeInProxy=r),mask:"YYYY-MM-DDTHH:mm:ss","hour-options":g(t).hourOptions},{default:v(()=>[S("div",Vt,[Y(h(R,{label:"Cancel",color:"primary",flat:""},null,512),[[W]]),Y(h(R,{label:"OK",color:"primary",flat:"",onClick:s[2]||(s[2]=r=>g(t).saveProxy(d.isTimeIn=!0))},null,512),[[W]])])]),_:1},8,["modelValue","hour-options"])]),_:1})]),_:1},8,["label","disable"])]),S("div",null,[q(" Time Out: "),h(R,{rounded:"",standout:"bg-teal text-white",icon:"access_time",label:g(t).getFormattedTimeOut,disable:!g(t).is_editing},{default:v(()=>[h(Re,{onBeforeShow:s[7]||(s[7]=r=>g(t).updateProxy(d.isTimeIn=!1)),cover:"","transition-show":"scale","transition-hide":"scale"},{default:v(()=>[h(Pe,{modelValue:g(t).attendanceTimeOutProxy,"onUpdate:modelValue":s[6]||(s[6]=r=>g(t).attendanceTimeOutProxy=r),mask:"YYYY-MM-DDTHH:mm:ss","hour-options":g(t).hourOptions},{default:v(()=>[S("div",Ft,[Y(h(R,{label:"Cancel",color:"primary",flat:""},null,512),[[W]]),Y(h(R,{label:"OK",color:"primary",flat:"",onClick:s[5]||(s[5]=r=>g(t).saveProxy(d.isTimeIn=!1))},null,512),[[W]])])]),_:1},8,["modelValue","hour-options"])]),_:1})]),_:1},8,["label","disable"])])])]),h(qe,{align:"right",class:"text-primary noPrint"},{default:v(()=>[g(t).is_editing==!1?(B(),z(R,{key:0,flat:"",class:"tw-bg-green-400",icon:g(t).is_editing?"save":"edit",label:g(t).is_editing?"Save":"Edit",onClick:s[8]||(s[8]=r=>g(t).is_editing=!0)},null,8,["icon","label"])):(B(),z(R,{key:1,flat:"",type:"submit",class:"tw-bg-green-400",icon:g(t).is_editing?"save":"edit",label:g(t).is_editing?"Save":"Edit"},null,8,["icon","label"])),Y(h(R,{flat:"",label:"CLOSE",onClick:g(t).resetForm},null,8,["onClick"]),[[W]])]),_:1})]),_:1})])):(B(),fe("div",Nt,[q(V(n.value)+" ",1),h(qe,{align:"right",class:"text-primary noPrint"},{default:v(()=>[Y(h(R,{flat:"",label:"Cancel"},null,512),[[W]])]),_:1})]))]),_:1},8,["modelValue"])],64))}},Ut=S("div",{class:"tw-text-xl, tw-font-bold"},"Attendance Report",-1),jt=S("div",{class:"tw-w-3"},null,-1),Bt=S("div",{class:"tw-flex tw-items-center tw-ml-5"},[S("div",{class:"tw-flex tw-items-center tw-mr-3"},[S("div",{class:"tw-rounded-lg tw-w-3 tw-h-6 !tw-bg-[#4ade80]"}),S("div",{class:"tw-ml-2"},"Present")]),S("div",{class:"tw-flex tw-items-center tw-mr-3"},[S("div",{class:"tw-rounded-lg tw-w-3 tw-h-6 !tw-bg-[#f87171]"}),S("div",{class:"tw-ml-2"},"Absent")]),S("div",{class:"tw-flex tw-items-center tw-mr-3"},[S("div",{class:"tw-rounded-lg tw-w-3 tw-h-6 !tw-bg-[#fb923c]"}),S("div",{class:"tw-ml-2"},"Late")]),S("div",{class:"tw-flex tw-items-center tw-mr-3"},[S("div",{class:"tw-rounded-lg tw-w-3 tw-h-6 !tw-bg-[#ec4899]"}),S("div",{class:"tw-ml-2"},"Undertime")]),S("div",{class:"tw-flex tw-items-center tw-mr-3"},[S("div",{class:"tw-rounded-lg tw-w-3 tw-h-6 !tw-bg-[#3b82f6]"}),S("div",{class:"tw-ml-2"},"Leave")]),S("div",{class:"tw-flex tw-items-center tw-mr-3"},[S("div",{class:"tw-rounded-lg tw-w-3 tw-h-6 !tw-bg-[#fef08a]"}),S("div",{class:"tw-ml-2"},"Holiday")])],-1),Qt={__name:"AttendanceTable",setup(e){Ne().fetchAttendanceType();const a=Fe(),n=L("");function f(s){const r=document.getElementById(s);let c="";c+=Array.from(r.querySelectorAll("th")).map(G=>G.innerText.replace(/arrow_upward/g,"")).join(",")+`
`,Array.from(r.querySelectorAll("tr")).slice(1).forEach(G=>{c+=Array.from(G.querySelectorAll("td")).map($=>$.innerText).join(",")+`
`});const x=new Date,E={month:"short",day:"2-digit",year:"numeric"},N=x.toLocaleDateString("en-US",E).replace(",","").replace(/\s+/g,"-"),A=new Blob([c],{type:"text/csv;charset=utf-8;"}),_=URL.createObjectURL(A),I=document.createElement("a");I.setAttribute("href",_),I.setAttribute("download",`Attendance-Report-${N}.csv`),document.body.appendChild(I),I.click(),document.body.removeChild(I),URL.revokeObjectURL(_)}a.fetchAttendanceReports();function o(s,r,c){const m=p(s,r),w=c.row.attendance[m-1];return y(w)}function i(s,r,c){const m=p(s,r),w=c.row.attendance[m-1];return d(w)}function b(s){return s.replace(/\b\w/g,r=>r.toUpperCase())}function p(s,r){return s.findIndex(c=>c.name===r.name&&c.align===r.align&&c.label===r.label&&c.sortable===r.sortable&&c.__iconClass===r.__iconClass&&c.__thClass===r.__thClass)}function y(s){const r=new Date;if(new Date(s.date)>=r)return"N/A";var m;if(s.time_out===null&&s.time_in!==null)m="No Time Out";else if(s.attendance_type_id!==1&&s.attendance_type_id!==void 0)m=b(s.attendance_type.attendance_type_name);else{const w=new Date(s.time_in),x=new Date(s.time_out),E=new Date(w);E.setHours(8,0,0,0),w<E&&w.setHours(8,0,0,0);const N=new Date(x);N.setHours(17,0,0,0),x>N&&x.setHours(17,0,0,0),m=((x-w)/(1e3*60*60)).toFixed(2);const A=new Date(x);A.setHours(13,0,0,0),x>A&&(m=(parseFloat(m)-1).toFixed(2))}return m}function d(s){const r=new Date;if(new Date(s.date)>=r)return"N/A";var m,w;if(s.time_out===null&&s.time_in!==null)m="No Time Out",w="!tw-bg-[#e11d48]";else if(s.attendance_type_id!==1&&s.attendance_type_id!==void 0)w="!tw-bg-[#3b82f6]";else{const x=new Date(s.time_in),E=new Date(s.time_out),N=new Date(x);N.setHours(8,0,0,0),x<N&&x.setHours(8,0,0,0);const A=new Date(E);A.setHours(17,0,0,0),E>A&&E.setHours(17,0,0,0),m=((E-x)/(1e3*60*60)).toFixed(2);const _=new Date(E);_.setHours(13,0,0,0),E>_&&(m=(parseFloat(m)-1).toFixed(2));const I=new Date(x);I.setHours(8,10,0,0),parseFloat(m)>=8?w="!tw-bg-[#4ade80]":parseFloat(m)==0?w="!tw-bg-[#f87171]":x>I&&(w="!tw-bg-[#fb923c]",parseFloat(m)<5&&(w="!tw-bg-[#ec4899]"))}return console.log(w+" !tw-w-[50px] !tw-h-[50px] tw-rounded"),w+" !tw-w-[50px] !tw-h-auto tw-rounded"}return(s,r)=>(B(),z(_e,{id:"attendance-table",class:"tw-border tw-rounded-3xl tw-shadow-lg",flat:"",bordered:"",dense:"",title:"Attendance Report","title-class":["tw-text-xl","tw-font-bold"],filter:n.value,columns:g(a).attendanceColumns.columns,rows:g(a).rows,"rows-per-page-options":[0],separator:"cell","row-key":"name"},{"top-right":v(()=>[h(R,{color:"blue","icon-right":"archive",label:"Export to CSV","no-caps":"",onClick:r[0]||(r[0]=c=>f("attendance-table")),class:"tw-mr-16"}),h(ae,{borderless:"",dense:"",debounce:"300",modelValue:n.value,"onUpdate:modelValue":r[1]||(r[1]=c=>n.value=c),placeholder:"Search"},{append:v(()=>[h(he,{name:"search"})]),_:1},8,["modelValue"])]),"body-cell-actions":v(c=>[h(F,{key:"actions",class:"tw-w-2/12 !tw-p-0",props:c},{default:v(()=>[h(Lt,{rows:c,columns:c.cols,qBtnLabel:o(c.cols,c.col,c),qBtnClass:i(c.cols,c.col,c),column:c.col},null,8,["rows","columns","qBtnLabel","qBtnClass","column"])]),_:2},1032,["props"])]),"top-left":v(()=>[Ut,jt,h(ye,{rounded:"",standout:"",modelValue:g(a).selectedDate,"onUpdate:modelValue":[r[2]||(r[2]=c=>g(a).selectedDate=c),r[3]||(r[3]=c=>g(a).fetchAttendanceReports())],"use-input":"","hide-selected":"","fill-input":"","hide-bottom-space":"","input-debounce":"0",options:g(a).selectedDateOptions,"option-label":c=>c.date_start+" "+c.date_end,class:"!tw-pb-0"},{"no-option":v(()=>[h(pe,null,{default:v(()=>[h(ge,{class:"text-grey"},{default:v(()=>[q(" No results ")]),_:1})]),_:1})]),_:1},8,["modelValue","options","option-label"])]),bottom:v(()=>[Bt]),_:1},8,["filter","columns","rows"]))}},Yt=te("philhealthTable",{state:()=>({rows:[],columns:[{name:"employeeId",required:!0,label:"Emp. Id",field:e=>e.employee.company_employee_id,align:"left",sortable:!0},{name:"employeeName",align:"center",label:"Name",field:e=>e.employee.last_name+" "+e.employee.first_name+" "+e.employee.middle_name,sortable:!0,classes:"!tw-bg-neutral-300"},{name:"philhealthNumber",align:"center",label:"PhilHealth No.",field:e=>e.employee.phil_health_number,sortable:!0,classes:"!tw-bg-neutral-300"},{name:"employeeShare",align:"center",label:"Employee Share",field:e=>e.amount,sortable:!0,classes:"!tw-bg-neutral-300"},{name:"employerShare",align:"center",label:"Employer Share",field:e=>e.amount,sortable:!0,classes:"!tw-bg-neutral-300"}],selectedDate:null,selectedDateOptions:null,employeeIds:[],philhealthAudit:[],philhealthContributionTableAudit:[]}),getters:{getSelectedDate(){return this.selectedDate},getTotalEmployeeShare(){let e=0;return this.philhealthAudit.forEach(t=>{e+=t.amount}),e}},actions:{capitalizeFirstLetterOfEachWord(e){return e.split(" ").map(t=>t.charAt(0).toUpperCase()+t.slice(1)).join(" ")},formatDate(e){const t=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0"),n=String(e.getDate()).padStart(2,"0");return`${t}-${a}-${n}`},getEmployeeIds(e){return e.map(t=>t.employee_id)},getAndCheckDateRangesForCurrentMonth(){const e=new Date,t=e.getFullYear(),a=e.getMonth(),n=new Date(t,a,1),f=new Date(t,a,15),o=new Date(t,a,16),i=new Date(t,a+1,0),b={firstHalf:{start:this.formatDate(n),end:this.formatDate(f)},secondHalf:{start:this.formatDate(o),end:this.formatDate(i)}},p=this.formatDate(e),y=new Date(b.firstHalf.start),d=new Date(b.firstHalf.end),s=new Date(b.secondHalf.start),r=new Date(b.secondHalf.end);let c,m;return e>=y&&e<=d?(c=this.formatDate(y),m=this.formatDate(d)):e>=s&&e<=r?(c=this.formatDate(s),m=this.formatDate(r)):(c="out of range",m="out of range"),{todayDate:p,startDate:c,endDate:m}},async getSalaryHistory(){try{const{data:e,error:t}=await O.from("salary_history").select();t&&console.error(t),this.selectedDateOptions=e.sort((a,n)=>new Date(a.date_start)-new Date(n.date_start))}catch(e){console.error(e)}},filterHighestAuditId(e){const t=e.reduce((a,n)=>{const{employee_id:f,audit_id:o}=n;return(!a[f]||a[f].audit_id<o)&&(a[f]=n),a},{});return Object.values(t)},getHighestAuditId(e){return e.length===0?null:e.reduce((a,n)=>n.audit_id>a.audit_id?n:a)},async fetchEmployeeInRange(e=this.selectedDate.date_end){try{const{data:t,error:a}=await O.from("employee_audit").select("*").lte("change_date",e).eq("is_archive",!1);a&&console.error(a),this.rows=this.filterHighestAuditId(t),this.employeeIds=this.getEmployeeIds(this.rows)}catch(t){console.error(t)}},async fetchPhilhealthContribAudit(e=this.selectedDate.date_end){try{const{data:t,error:a}=await O.from("emp_philhealth_contrib_audit").select("*, employee!emp_philhealth_contrib_audit_employee_id_fkey(last_name, first_name, middle_name, company_employee_id, phil_health_number, is_archive)").lte("change_date",e).eq("employee.is_archive",!1).in("employee_id",this.employeeIds);a&&console.error(a),this.philhealthAudit=this.filterHighestAuditId(t.filter(n=>n.employee!==null))}catch(t){console.error(t)}},async fetchPhilhealthContributionTableAudit(e=this.selectedDate.date_end){try{const{data:t,error:a}=await O.from("philhealth_contribution_table_audit").select("*").lte("change_date",e);a&&console.error(a),this.philhealthContributionTableAudit=this.getHighestAuditId(t)}catch(t){console.error(t)}},getNearestDateRange(){if(this.selectedDate!=null)return;const e=new Date;function t(o){return new Date(o)}function a(o){return Math.abs(e-o)}let n=null,f=1/0;for(const o of this.selectedDateOptions){const i=t(o.date_start),b=t(o.date_end),p=a(i),y=a(b),d=Math.min(p,y);d<f&&(f=d,n=o)}this.selectedDate=n},async fetchEmployeeReports(){await this.getSalaryHistory(),await this.getNearestDateRange(),await this.fetchEmployeeInRange(),await this.fetchPhilhealthContribAudit(),await this.fetchPhilhealthContributionTableAudit()}}}),Kt=S("div",{class:"tw-text-xl, tw-font-bold"},"PhilHealth Report",-1),Wt=S("div",{class:"tw-w-3"},null,-1),zt={__name:"PhilhealthTable",setup(e){const t=Yt(),a=L("");function n(f){const o=document.getElementById(f);let i="";i+=Array.from(o.querySelectorAll("th")).map(w=>w.innerText.replace(/arrow_upward/g,"")).join(",")+`
`,Array.from(o.querySelectorAll("tr")).slice(1).forEach(w=>{i+=Array.from(w.querySelectorAll("td")).map(E=>E.innerText).join(",")+`
`});const y=new Date,d={month:"short",day:"2-digit",year:"numeric"},s=y.toLocaleDateString("en-US",d).replace(",","").replace(/\s+/g,"-"),r=new Blob([i],{type:"text/csv;charset=utf-8;"}),c=URL.createObjectURL(r),m=document.createElement("a");m.setAttribute("href",c),m.setAttribute("download",`Philhealth-Report-${s}.csv`),document.body.appendChild(m),m.click(),document.body.removeChild(m),URL.revokeObjectURL(c)}return t.fetchEmployeeReports(),(f,o)=>(B(),z(_e,{id:"philhealth-table",class:"tw-border tw-rounded-3xl tw-shadow-lg",flat:"",bordered:"",dense:"",title:"Attendance Report","title-class":["tw-text-xl","tw-font-bold"],filter:a.value,columns:g(t).columns,rows:g(t).philhealthAudit,"rows-per-page-options":[0],separator:"cell","row-key":"name"},{"top-right":v(()=>[h(R,{color:"blue","icon-right":"archive",label:"Export to CSV","no-caps":"",onClick:o[0]||(o[0]=i=>n("philhealth-table")),class:"tw-mr-16"}),h(ae,{borderless:"",dense:"",debounce:"300",modelValue:a.value,"onUpdate:modelValue":o[1]||(o[1]=i=>a.value=i),placeholder:"Search"},{append:v(()=>[h(he,{name:"search"})]),_:1},8,["modelValue"])]),"top-left":v(()=>[Kt,Wt,h(ye,{rounded:"",standout:"",modelValue:g(t).selectedDate,"onUpdate:modelValue":[o[2]||(o[2]=i=>g(t).selectedDate=i),o[3]||(o[3]=i=>g(t).fetchEmployeeReports())],"use-input":"","hide-selected":"","fill-input":"","hide-bottom-space":"","input-debounce":"0",options:g(t).selectedDateOptions,"option-label":i=>i.date_start+" "+i.date_end,class:"!tw-pb-0"},{"no-option":v(()=>[h(pe,null,{default:v(()=>[h(ge,{class:"text-grey"},{default:v(()=>[q(" No results ")]),_:1})]),_:1})]),_:1},8,["modelValue","options","option-label"])]),"bottom-row":v(()=>[h(Te,null,{default:v(()=>[h(F,{colspan:"3"}),h(F,{class:"tw-text-center"},{default:v(()=>[q(" Total Employee Share: "+V(g(t).getTotalEmployeeShare),1)]),_:1}),h(F,{class:"tw-text-center"},{default:v(()=>[q(" Total Employer Share: "+V(g(t).getTotalEmployeeShare),1)]),_:1})]),_:1})]),bottom:v(()=>[]),_:1},8,["filter","columns","rows"]))}};function Le(e){var t=e.toString().match(/^-?\d+(?:\.\d{0,2})?/)[0];return parseFloat(t)}function Gt(e,t=30){return Le(e*t)}function Ve(e){const t=Gt(e);let a,n;return t<=1500?(a=.01,n=Math.min(t,1e4)*a):(a=.02,n=Math.min(t,1e4)*a),Le(n)}const Xt=te("pagibigTable",{state:()=>({rows:[],columns:[{name:"employeeId",required:!0,label:"Emp. Id",field:e=>e.employee.company_employee_id,align:"left",sortable:!0},{name:"employeeName",align:"center",label:"Name",field:e=>e.employee.last_name+" "+e.employee.first_name+" "+e.employee.middle_name,sortable:!0,classes:"!tw-bg-neutral-300"},{name:"pagibigNumber",align:"center",label:"Pagibig No.",field:e=>e.employee.pag_ibig_number,sortable:!0,classes:"!tw-bg-neutral-300"},{name:"employeeShare",align:"center",label:"Employee Share",field:e=>e.amount,sortable:!0,classes:"!tw-bg-neutral-300"},{name:"employerShare",align:"center",label:"Employer Share",field:e=>Ve(e.employee.rate_per_day),sortable:!0,classes:"!tw-bg-neutral-300"}],selectedDate:null,selectedDateOptions:null,employeeIds:[],pagibigAudit:[],pagibigContributionTableAudit:[]}),getters:{getSelectedDate(){return this.selectedDate},getTotalEmployerShare(){let e=0;return this.pagibigAudit.forEach(t=>{e+=Ve(t.amount)}),e},getTotalEmployeeShare(){let e=0;return this.pagibigAudit.forEach(t=>{e+=t.amount}),e}},actions:{capitalizeFirstLetterOfEachWord(e){return e.split(" ").map(t=>t.charAt(0).toUpperCase()+t.slice(1)).join(" ")},formatDate(e){const t=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0"),n=String(e.getDate()).padStart(2,"0");return`${t}-${a}-${n}`},getEmployeeIds(e){return e.map(t=>t.employee_id)},getAndCheckDateRangesForCurrentMonth(){const e=new Date,t=e.getFullYear(),a=e.getMonth(),n=new Date(t,a,1),f=new Date(t,a,15),o=new Date(t,a,16),i=new Date(t,a+1,0),b={firstHalf:{start:this.formatDate(n),end:this.formatDate(f)},secondHalf:{start:this.formatDate(o),end:this.formatDate(i)}},p=this.formatDate(e),y=new Date(b.firstHalf.start),d=new Date(b.firstHalf.end),s=new Date(b.secondHalf.start),r=new Date(b.secondHalf.end);let c,m;return e>=y&&e<=d?(c=this.formatDate(y),m=this.formatDate(d)):e>=s&&e<=r?(c=this.formatDate(s),m=this.formatDate(r)):(c="out of range",m="out of range"),{todayDate:p,startDate:c,endDate:m}},async getSalaryHistory(){try{const{data:e,error:t}=await O.from("salary_history").select();t&&console.error(t),this.selectedDateOptions=e.sort((a,n)=>new Date(a.date_start)-new Date(n.date_start))}catch(e){console.error(e)}},filterHighestAuditId(e){const t=e.reduce((a,n)=>{const{employee_id:f,audit_id:o}=n;return(!a[f]||a[f].audit_id<o)&&(a[f]=n),a},{});return Object.values(t)},getHighestAuditId(e){return e.length===0?null:e.reduce((a,n)=>n.audit_id>a.audit_id?n:a)},async fetchEmployeeInRange(e=this.selectedDate.date_end){try{const{data:t,error:a}=await O.from("employee_audit").select("*").lte("change_date",e).eq("is_archive",!1);a&&console.error(a),this.rows=this.filterHighestAuditId(t),this.employeeIds=this.getEmployeeIds(this.rows)}catch(t){console.error(t)}},async fetchPagibigContribAudit(e=this.selectedDate.date_end){try{const{data:t,error:a}=await O.from("emp_pagibig_contrib_audit").select("*, employee!emp_pagibig_contrib_audit_employee_id_fkey(last_name, first_name, middle_name, company_employee_id, pag_ibig_number, rate_per_day, is_archive)").lte("change_date",e).eq("employee.is_archive",!1).in("employee_id",this.employeeIds);a&&console.error(a),this.pagibigAudit=this.filterHighestAuditId(t.filter(n=>n.employee!==null)),console.log(t)}catch(t){console.error(t)}},async fetchPagibigContributionTableAudit(e=this.selectedDate.date_end){try{const{data:t,error:a}=await O.from("pagibig_contribution_table_audit").select("*").lte("change_date",e);a&&console.error(a),this.pagibigContributionTableAudit=this.getHighestAuditId(t)}catch(t){console.error(t)}},getNearestDateRange(){if(this.selectedDate!=null)return;const e=new Date;function t(o){return new Date(o)}function a(o){return Math.abs(e-o)}let n=null,f=1/0;for(const o of this.selectedDateOptions){const i=t(o.date_start),b=t(o.date_end),p=a(i),y=a(b),d=Math.min(p,y);d<f&&(f=d,n=o)}this.selectedDate=n},async fetchEmployeeReports(){await this.getSalaryHistory(),await this.getNearestDateRange(),await this.fetchEmployeeInRange(),await this.fetchPagibigContribAudit(),await this.fetchPagibigContributionTableAudit()}}}),Jt=S("div",{class:"tw-text-xl, tw-font-bold"},"Pag-IBIG Report",-1),Zt=S("div",{class:"tw-w-3"},null,-1),ea={__name:"PagibigTable",setup(e){const t=Xt(),a=L("");function n(f){const o=document.getElementById(f);let i="";i+=Array.from(o.querySelectorAll("th")).map(w=>w.innerText.replace(/arrow_upward/g,"")).join(",")+`
`,Array.from(o.querySelectorAll("tr")).slice(1).forEach(w=>{i+=Array.from(w.querySelectorAll("td")).map(E=>E.innerText).join(",")+`
`});const y=new Date,d={month:"short",day:"2-digit",year:"numeric"},s=y.toLocaleDateString("en-US",d).replace(",","").replace(/\s+/g,"-"),r=new Blob([i],{type:"text/csv;charset=utf-8;"}),c=URL.createObjectURL(r),m=document.createElement("a");m.setAttribute("href",c),m.setAttribute("download",`Pag-IBIG-Report-${s}.csv`),document.body.appendChild(m),m.click(),document.body.removeChild(m),URL.revokeObjectURL(c)}return t.fetchEmployeeReports(),(f,o)=>(B(),z(_e,{id:"pagibig-table",class:"tw-border tw-rounded-3xl tw-shadow-lg",flat:"",bordered:"",dense:"",title:"Attendance Report","title-class":["tw-text-xl","tw-font-bold"],filter:a.value,columns:g(t).columns,rows:g(t).pagibigAudit,"rows-per-page-options":[0],separator:"cell","row-key":"name"},{"top-right":v(()=>[h(R,{color:"blue","icon-right":"archive",label:"Export to CSV","no-caps":"",onClick:o[0]||(o[0]=i=>n("pagibig-table")),class:"tw-mr-16"}),h(ae,{borderless:"",dense:"",debounce:"300",modelValue:a.value,"onUpdate:modelValue":o[1]||(o[1]=i=>a.value=i),placeholder:"Search"},{append:v(()=>[h(he,{name:"search"})]),_:1},8,["modelValue"])]),"top-left":v(()=>[Jt,Zt,h(ye,{rounded:"",standout:"",modelValue:g(t).selectedDate,"onUpdate:modelValue":[o[2]||(o[2]=i=>g(t).selectedDate=i),o[3]||(o[3]=i=>g(t).fetchEmployeeReports())],"use-input":"","hide-selected":"","fill-input":"","hide-bottom-space":"","input-debounce":"0",options:g(t).selectedDateOptions,"option-label":i=>i.date_start+" "+i.date_end,class:"!tw-pb-0"},{"no-option":v(()=>[h(pe,null,{default:v(()=>[h(ge,{class:"text-grey"},{default:v(()=>[q(" No results ")]),_:1})]),_:1})]),_:1},8,["modelValue","options","option-label"])]),"bottom-row":v(()=>[h(Te,null,{default:v(()=>[h(F,{colspan:"3"}),h(F,{class:"tw-text-center"},{default:v(()=>[q(" Total Employee Share: "+V(g(t).getTotalEmployeeShare),1)]),_:1}),h(F,{class:"tw-text-center"},{default:v(()=>[q(" Total Employer Share: "+V(g(t).getTotalEmployerShare),1)]),_:1})]),_:1})]),bottom:v(()=>[]),_:1},8,["filter","columns","rows"]))}},ta=te("sssTable",{state:()=>({rows:[],columns:[],selectedDate:null,selectedDateOptions:null,employeeIds:[],sssAudit:[],sssContributionTableAudit:[]}),getters:{getSelectedDate(){return this.selectedDate},getTotalEmployeeShare(){let e=0;return this.sssAudit.forEach(t=>{e+=t.amount}),e},getTotalEmployerShare(){let e=0;return this.sssAudit.forEach(t=>{e+=typeof this.getEmployerShare(t.amount)=="number"?this.getEmployerShare(t.amount):0}),e},getTotalECEmployerShare(){let e=0;return this.sssAudit.forEach(t=>{e+=typeof this.getECER(t.amount)=="number"?this.getECER(t.amount):0}),e}},actions:{setColumns(){this.columns=[{name:"employeeId",required:!0,label:"Emp. Id",field:e=>e.employee.company_employee_id,align:"left",sortable:!0},{name:"employeeName",align:"center",label:"Name",field:e=>e.employee.last_name+" "+e.employee.first_name+" "+e.employee.middle_name,sortable:!0,classes:"!tw-bg-neutral-300"},{name:"sssNumber",align:"center",label:"SSS No.",field:e=>e.employee.sss_number,sortable:!0,classes:"!tw-bg-neutral-300"},{name:"employeeShare",align:"center",label:"Employee Share",field:e=>e.amount,sortable:!0,classes:"!tw-bg-neutral-300"},{name:"employerShare",align:"center",label:"Employer Share",field:e=>this.getEmployerShare(e.amount),sortable:!0,classes:"!tw-bg-neutral-300"},{name:"ecEmployerShare",align:"center",label:"EC Employer Share",field:e=>this.getECER(e.amount),sortable:!0,classes:"!tw-bg-neutral-300"}]},getEmployerShare(e){console.log(e,this.sssContributionTableAudit);for(const t of this.sssContributionTableAudit)if(e==t.ee_share)return t.er_share;return"Out of range"},getECER(e){for(const t of this.sssContributionTableAudit)if(e==t.ee_share)return t.ec_er_share;return"Out of range"},capitalizeFirstLetterOfEachWord(e){return e.split(" ").map(t=>t.charAt(0).toUpperCase()+t.slice(1)).join(" ")},formatDate(e){const t=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0"),n=String(e.getDate()).padStart(2,"0");return`${t}-${a}-${n}`},getEmployeeIds(e){return e.map(t=>t.employee_id)},getAndCheckDateRangesForCurrentMonth(){const e=new Date,t=e.getFullYear(),a=e.getMonth(),n=new Date(t,a,1),f=new Date(t,a,15),o=new Date(t,a,16),i=new Date(t,a+1,0),b={firstHalf:{start:this.formatDate(n),end:this.formatDate(f)},secondHalf:{start:this.formatDate(o),end:this.formatDate(i)}},p=this.formatDate(e),y=new Date(b.firstHalf.start),d=new Date(b.firstHalf.end),s=new Date(b.secondHalf.start),r=new Date(b.secondHalf.end);let c,m;return e>=y&&e<=d?(c=this.formatDate(y),m=this.formatDate(d)):e>=s&&e<=r?(c=this.formatDate(s),m=this.formatDate(r)):(c="out of range",m="out of range"),{todayDate:p,startDate:c,endDate:m}},async getSalaryHistory(){try{const{data:e,error:t}=await O.from("salary_history").select();t&&console.error(t),this.selectedDateOptions=e.sort((a,n)=>new Date(a.date_start)-new Date(n.date_start))}catch(e){console.error(e)}},filterHighestAuditId(e){const t=e.reduce((a,n)=>{const{employee_id:f,audit_id:o}=n;return(!a[f]||a[f].audit_id<o)&&(a[f]=n),a},{});return Object.values(t)},getHighestAuditId(e){return e.length===0?null:e.reduce((a,n)=>n.audit_id>a.audit_id?n:a)},async fetchEmployeeInRange(e=this.selectedDate.date_end){try{const{data:t,error:a}=await O.from("employee_audit").select("*").lte("change_date",e).eq("is_archive",!1);a&&console.error(a),this.rows=this.filterHighestAuditId(t),this.employeeIds=this.getEmployeeIds(this.rows)}catch(t){console.error(t)}},async fetchSssContribAudit(e=this.selectedDate.date_end){try{const{data:t,error:a}=await O.from("emp_sss_contrib_audit").select("*, employee!emp_sss_contrib_audit_employee_id_fkey(last_name, first_name, middle_name, company_employee_id, sss_number, is_archive)").lte("change_date",e).eq("employee.is_archive",!1).in("employee_id",this.employeeIds);a&&console.error(a),this.sssAudit=this.filterHighestAuditId(t.filter(n=>n.employee!==null))}catch(t){console.error(t)}},async fetchSssContributionTableAudit(e=this.selectedDate.date_end){try{const{data:t,error:a}=await O.from("sss_contribution_table_audit").select("*").lte("change_date",e);a&&console.error(a),this.sssContributionTableAudit=this.getHighestAuditId(t),this.sssContributionTableAudit=this.sssContributionTableAudit.data.map(n=>{const f=n.combinedValue;let o,i,b,p,y;if(b=parseFloat(n.values[4].replace(",","")),p=parseFloat(n.values[3].replace(",","")),y=parseFloat(n.values[6].replace(",","")),f.startsWith("Below"))o=0,i=parseFloat(f.split(" ")[1].replace(",",""));else if(f.includes("Over"))o=parseFloat(f.split(" ")[0].replace(",","")),i=null;else{const[d,s]=f.split(" - ");o=parseFloat(d.replace(",","")),i=parseFloat(s.replace(",",""))}return{min:o,max:i,ee_share:b,er_share:p,ec_er_share:y}}),this.setColumns()}catch(t){console.error(t)}},getNearestDateRange(){if(this.selectedDate!=null)return;const e=new Date;function t(o){return new Date(o)}function a(o){return Math.abs(e-o)}let n=null,f=1/0;for(const o of this.selectedDateOptions){const i=t(o.date_start),b=t(o.date_end),p=a(i),y=a(b),d=Math.min(p,y);d<f&&(f=d,n=o)}this.selectedDate=n},async fetchEmployeeReports(){await this.getSalaryHistory(),await this.getNearestDateRange(),await this.fetchSssContributionTableAudit(),await this.fetchEmployeeInRange(),await this.fetchSssContribAudit()}}}),aa=S("div",{class:"tw-text-xl, tw-font-bold"},"SSS Report",-1),na=S("div",{class:"tw-w-3"},null,-1),la={__name:"SssTable",setup(e){const t=ta(),a=L("");function n(f){const o=document.getElementById(f);let i="";i+=Array.from(o.querySelectorAll("th")).map(w=>w.innerText.replace(/arrow_upward/g,"")).join(",")+`
`,Array.from(o.querySelectorAll("tr")).slice(1).forEach(w=>{i+=Array.from(w.querySelectorAll("td")).map(E=>E.innerText).join(",")+`
`});const y=new Date,d={month:"short",day:"2-digit",year:"numeric"},s=y.toLocaleDateString("en-US",d).replace(",","").replace(/\s+/g,"-"),r=new Blob([i],{type:"text/csv;charset=utf-8;"}),c=URL.createObjectURL(r),m=document.createElement("a");m.setAttribute("href",c),m.setAttribute("download",`SSS-Report-${s}.csv`),document.body.appendChild(m),m.click(),document.body.removeChild(m),URL.revokeObjectURL(c)}return t.fetchEmployeeReports(),(f,o)=>(B(),z(_e,{id:"sss-table",class:"tw-border tw-rounded-3xl tw-shadow-lg",flat:"",bordered:"",dense:"",title:"Attendance Report",filter:a.value,columns:g(t).columns,rows:g(t).sssAudit,"rows-per-page-options":[0],separator:"cell","row-key":"name"},{"top-right":v(()=>[h(R,{color:"blue","icon-right":"archive",label:"Export to CSV","no-caps":"",onClick:o[0]||(o[0]=i=>n("sss-table")),class:"tw-mr-16"}),h(ae,{borderless:"",dense:"",debounce:"300",modelValue:a.value,"onUpdate:modelValue":o[1]||(o[1]=i=>a.value=i),placeholder:"Search"},{append:v(()=>[h(he,{name:"search"})]),_:1},8,["modelValue"])]),"top-left":v(()=>[aa,na,h(ye,{rounded:"",standout:"",modelValue:g(t).selectedDate,"onUpdate:modelValue":[o[2]||(o[2]=i=>g(t).selectedDate=i),o[3]||(o[3]=i=>g(t).fetchEmployeeReports())],"use-input":"","hide-selected":"","fill-input":"","hide-bottom-space":"","input-debounce":"0",options:g(t).selectedDateOptions,"option-label":i=>i.date_start+" "+i.date_end,class:"!tw-pb-0"},{"no-option":v(()=>[h(pe,null,{default:v(()=>[h(ge,{class:"text-grey"},{default:v(()=>[q(" No results ")]),_:1})]),_:1})]),_:1},8,["modelValue","options","option-label"])]),"bottom-row":v(()=>[h(Te,null,{default:v(()=>[h(F),h(F),h(F),h(F,{class:"tw-text-center"},{default:v(()=>[q(" Total EE Share: "+V(g(t).getTotalEmployeeShare),1)]),_:1}),h(F,{class:"tw-text-center"},{default:v(()=>[q(" Total ER Share: "+V(g(t).getTotalEmployerShare),1)]),_:1}),h(F,{class:"tw-text-center"},{default:v(()=>[q(" Total EC ER Share: "+V(g(t).getTotalECEmployerShare),1)]),_:1})]),_:1})]),bottom:v(()=>[]),_:1},8,["filter","columns","rows"]))}},oa={class:"tw-w-12/12 tw-max-w-full tw-mx-auto tw-bg-white tw-shadow-lg tw-border tw-rounded-3xl tw-border-collapse tw-p-4 tw-mt-0"},sa=S("br",null,null,-1),ra=S("br",null,null,-1),ia=S("br",null,null,-1),ua=S("br",null,null,-1),Ia={__name:"AdminReportsPage",setup(e){const t=rt();return t.currentPage="Reports",(a,n)=>(B(),fe("div",oa,[S("div",null,[h(Qt),sa,h(zt),ra,h(ea),ia,h(la),ua])]))}};export{Ia as default};
