import{Q as $}from"./QTd.51e0046c.js";import{ar as S,as as _,r as v,o as V,c as y,d as l,Q as p,w as i,a as o,a5 as m,V as w,n as L,e as d,a7 as x,G as g,aG as M,f}from"./index.15824037.js";import{Q as b}from"./QInput.97164f39.js";import{Q as U,a as C}from"./QTable.651292d7.js";import{d as k}from"./date.ba044ebc.js";import{u as P}from"./pageHeader.0d890997.js";import{Q as I,C as h}from"./ClosePopup.5de5c96a.js";import{Q as A,E as O,D as Y}from"./position-engine.85dc6960.js";import{Q as B,a as N}from"./QPopupProxy.3ad8482b.js";import{Q as z}from"./QForm.808c4aa5.js";import{Q as F}from"./QCard.c5d3f01b.js";import"./use-key-composition.28aa7500.js";import"./focus-manager.8e091e03.js";const D=S("viewVoucher",{state:()=>({rows:[]}),getters:{getActive(n){return n.rows.filter(e=>e.is_archive===!1)},getInactive(n){return n.rows.filter(e=>e.is_archive===!0)}},actions:{async fetchListOfVouchers(){try{const{data:n,error:e}=await _.from("voucher").select(`
              id,
              employee_id,
              type,
              date_issued,
              recipient:employee_id(first_name, middle_name, last_name),
              issuer:employee_id(first_name, middle_name, last_name), 
              issuer,
              description,
              amount,
              is_archive
            `);if(e)throw e;this.rows=n}catch(n){console.log(n)}},async archivedVoucher(n,e){try{const{data:c,error:r}=await _.from("voucher").update({is_archive:!e}).eq("id",n);if(r)throw r;console.log(c),this.fetchListOfVouchers()}catch(c){console.log(c)}}}});const E={class:"!tw-h-min !tw-w-5/12 !tw-max-w-full tw-bg-white tw-p-6"},q={id:"section-to-print"},T={class:"tw-text-3xl tw-font-extrabold tw-pb-3"},j={class:"tw-w-full tw-table-auto tw-border-collapse"},R={__name:"ViewVoucherButton",props:["rows"],setup(n){const e=D(),c=v(!1),r=v(null);function u(a){r.value=a,c.value=!0}return(a,s)=>(V(),y(x,null,[l(p,{style:{"flex-wrap":"nowrap !important"},icon:"visibility",label:"VIEW",onClick:s[0]||(s[0]=t=>u(n.rows))}),l(A,{modelValue:c.value,"onUpdate:modelValue":s[2]||(s[2]=t=>c.value=t),persistent:""},{default:i(()=>[o("div",E,[o("div",q,[o("div",T," Voucher ID "+m(r.value.id)+" \xA0 \xA0 \xA0 \xA0 "+m(r.value.employeeName),1),o("table",j,[o("tr",null,[o("td",null," Recipient: "+m(r.value.recipient.last_name+" "+r.value.recipient.first_name),1),o("td",null," Issuer: "+m(r.value.recipient.last_name+" "+r.value.recipient.first_name),1),o("td",null,m(r.value.date),1)]),o("tr",null,[o("td",null,"Description: "+m(r.value.description),1)]),o("tr",null,[o("td",null,"Amount: "+m(r.value.amount),1)])])]),l(I,{align:"right",class:"text-primary noPrint"},{default:i(()=>[w(l(p,{flat:"",label:"Cancel"},null,512),[[h]]),w(l(p,{flat:"",class:L(r.value.is_archive?"tw-bg-green-400":"tw-bg-red-400"),icon:"mdi-archive",label:r.value.is_archive?"Unarchive":"Archive",onClick:s[1]||(s[1]=t=>d(e).archivedVoucher(r.value.id,r.value.is_archive))},null,8,["class","label"]),[[h]])]),_:1})])]),_:1},8,["modelValue"])],64))}},G={class:"!tw-h-min !tw-w-8/12 !tw-max-w-full tw-bg-white tw-p-6"},H=o("div",{class:"tw-col-span-4 tw-text-3xl tw-font-extrabold tw-pb-3"}," Archived Voucher ",-1),W={__name:"ArchivedVoucherButton",setup(n){const e=D(),c=v(!1),r=v(""),u=[{name:"Voucher Id",required:!0,label:"Voucher Id",align:"left",field:a=>a.id,format:a=>`${a}`,sortable:!0},{name:"Date",align:"center",label:"Date",field:a=>a.date_issued,format:a=>k.formatDate(a,"MMM D, YYYY"),sortable:!0},{name:"Description",align:"center",label:"Description",field:"description",sortable:!0},{name:"Recipient",align:"center",label:"Recipient",field:a=>a.recipient.last_name+" "+a.recipient.first_name,sortable:!0},{name:"Issuer",align:"center",label:"Issuer",field:a=>a.issuer.last_name+" "+a.issuer.first_name,sortable:!0},{name:"Amount",align:"center",label:"Amount",field:"amount",sortable:!0},{name:"actions",align:"center",label:"",field:""}];return(a,s)=>(V(),y(x,null,[l(p,{icon:"mdi-archive",label:"Archived Voucher",onClick:s[0]||(s[0]=t=>c.value=!0),class:"tw-bg-white"}),l(A,{modelValue:c.value,"onUpdate:modelValue":s[2]||(s[2]=t=>c.value=t),persistent:""},{default:i(()=>[o("div",G,[H,l(U,{class:"my-sticky-header-table tw-w-11/12 tw-mx-auto tw-mt-6 tw-bg-white tw-shadow-lg tw-border tw-rounded-3xl tw-border-collapse",flat:"",bordered:"",filter:r.value,columns:u,rows:d(e).getInactive,"rows-per-page-options":[10,20,0],"row-key":"name"},{"body-cell-actions":i(t=>[l($,{props:t},{default:i(()=>[o("div",null,[l(R,{rows:t.row},null,8,["rows"])])]),_:2},1032,["props"])]),"top-right":i(()=>[l(b,{borderless:"",dense:"",debounce:"300",modelValue:r.value,"onUpdate:modelValue":s[1]||(s[1]=t=>r.value=t),placeholder:"Search"},{append:i(()=>[l(g,{name:"search"})]),_:1},8,["modelValue"])]),_:1},8,["filter","rows"]),l(I,{align:"right",class:"text-primary"},{default:i(()=>[w(l(p,{flat:"",label:"Cancel"},null,512),[[h]])]),_:1})])]),_:1},8,["modelValue"])],64))}},J=D(),K=S("addVoucher",{state:()=>({employee_id:null,type:null,date_issued:null,recipient:null,recipientOptions:[],issuer:null,issuerOptions:[],description:null,amount:null,is_archive:null,loading:!1}),getters:{},actions:{addVoucher(){Promise.all([this.getCurrentUser()]).then(()=>{this.addVoucherData(),this.reset()})},async addVoucherData(){this.loading=!0;try{const{data:n,error:e}=await _.from("voucher").insert([{employee_id:this.employee_id,type:this.type,date_issued:this.date_issued,recipient:this.recipient.id,issuer:this.issuer.id,description:this.description,amount:this.amount,is_archive:!1}]);if(e)throw e;console.log(n),this.loading=!1,this.success(),J.fetchListOfVouchers()}catch(n){console.log(n),this.loading=!1}},async getCurrentUser(){const{data:{user:n}}=await _.auth.getUser();this.employee_id=n.id},async fetchReferenceData(){try{const{data:n,error:e}=await _.from("employee").select("id, company_employee_id, first_name, middle_name, last_name");if(e)throw e;this.recipientOptions=n,this.issuerOptions=n}catch(n){console.log(n)}},success(){M.create({icon:"done",color:"positive",message:"Added Voucher Successfully!"})},reset(){this.employee_id=null,this.type=null,this.date_issued=null,this.recipient=null,this.issuer=null,this.description=null,this.amount=null,this.is_archive=null}}}),X={class:"tw-grid tw-grid-cols-3 tw-gap-3 tw-mb-5"},Z=o("div",{class:"tw-col-span-3 tw-text-3xl tw-font-extrabold tw-pb-3"}," Add Voucher ",-1),ee={class:"tw-col-span-1"},te=o("div",{class:"tw-col-span-1"},null,-1),le={class:"tw-col-span-1"},se=o("div",{class:"tw-col-span-3"},"Description",-1),ae={class:"tw-col-span-3"},oe={class:"tw-col-span-1"},ie={class:"row items-center justify-end"},ne=o("div",{class:"tw-col-span-1"},null,-1),re={class:"tw-col-span-1"},de={__name:"AddVoucherButton",setup(n){const e=K(),c=v(!1);e.fetchReferenceData();function r(a,s){s(()=>{console.log(a);const t=a.toLowerCase();e.selectorRecipientOptions=e.recipientOptions.filter(Q=>String(Q.company_employee_id).toLowerCase().indexOf(t)>-1)})}function u(a,s){s(()=>{console.log(a);const t=a.toLowerCase();e.selectorIssuerOptions=e.issuerOptions.filter(Q=>String(Q.company_employee_id).toLowerCase().indexOf(t)>-1)})}return(a,s)=>(V(),y(x,null,[l(p,{icon:"mdi-plus",label:"Add Voucher",onClick:s[0]||(s[0]=t=>c.value=!0),class:"tw-bg-white"}),l(A,{modelValue:c.value,"onUpdate:modelValue":s[7]||(s[7]=t=>c.value=t),persistent:""},{default:i(()=>[l(F,{class:"!tw-h-min !tw-w-5/12 !tw-max-w-full tw-bg-white tw-p-6"},{default:i(()=>[l(z,{autofocus:""},{default:i(()=>[o("div",null,[o("div",X,[Z,o("div",ee,[f(" Recipient "),l(C,{filled:"",modelValue:d(e).recipient,"onUpdate:modelValue":s[1]||(s[1]=t=>d(e).recipient=t),"use-input":"","hide-selected":"","fill-input":"","hide-bottom-space":"","input-debounce":"0",options:d(e).selectorRecipientOptions,"option-label":t=>"first_name"in t?t.company_employee_id+" - "+t.last_name:"","option-value":a.id,onFilter:r,class:"!tw-pb-0; tw-capitalize","popup-content-class":"tw-capitalize",disable:d(e).loading},{"no-option":i(()=>[l(O,null,{default:i(()=>[l(Y,{class:"text-grey"},{default:i(()=>[f(" No results ")]),_:1})]),_:1})]),_:1},8,["modelValue","options","option-label","option-value","disable"])]),te,o("div",le,[f(" Issuer "),l(C,{filled:"",modelValue:d(e).issuer,"onUpdate:modelValue":s[2]||(s[2]=t=>d(e).issuer=t),"use-input":"","hide-selected":"","fill-input":"","hide-bottom-space":"","input-debounce":"0",options:d(e).selectorIssuerOptions,"option-label":t=>"first_name"in t?t.company_employee_id+" - "+t.last_name:"","option-value":a.id,onFilter:u,class:"!tw-pb-0; tw-capitalize","popup-content-class":"tw-capitalize",disable:d(e).loading},{"no-option":i(()=>[l(O,null,{default:i(()=>[l(Y,{class:"text-grey"},{default:i(()=>[f(" No results ")]),_:1})]),_:1})]),_:1},8,["modelValue","options","option-label","option-value","disable"])]),se,o("div",ae,[l(b,{modelValue:d(e).description,"onUpdate:modelValue":s[3]||(s[3]=t=>d(e).description=t),type:"textarea",filled:"","hide-bottom-space":"",rules:[t=>t.length>=1],disable:d(e).loading},null,8,["modelValue","rules","disable"])]),o("div",oe,[f(" Date: "),l(b,{filled:"",modelValue:d(e).date_issued,"onUpdate:modelValue":s[5]||(s[5]=t=>d(e).date_issued=t),label:"YYYY-MM-DD",rules:[t=>a.date.isValid(t)],"hide-bottom-space":"",disable:d(e).loading},{append:i(()=>[l(g,{name:"event",class:"cursor-pointer"},{default:i(()=>[l(B,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:i(()=>[l(N,{modelValue:d(e).date_issued,"onUpdate:modelValue":s[4]||(s[4]=t=>d(e).date_issued=t),mask:"YYYY-MM-DD"},{default:i(()=>[o("div",ie,[w(l(p,{label:"Close",color:"primary",flat:""},null,512),[[h]])])]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue","rules","disable"])]),ne,o("div",re,[f(" Amount "),l(b,{filled:"",modelValue:d(e).amount,"onUpdate:modelValue":s[6]||(s[6]=t=>d(e).amount=t),dense:a.dense,rules:[t=>t.length>=1],"hide-bottom-space":"",disable:d(e).loading},{prepend:i(()=>[l(g,{style:{"font-size":"x-large"},name:"mdi-currency-php"})]),_:1},8,["modelValue","dense","rules","disable"])])]),l(I,{align:"right",class:"text-primary"},{default:i(()=>[w(l(p,{flat:"",label:"Cancel"},null,512),[[h]]),w(l(p,{flat:"",class:"tw-bg-green-400",label:"Add Invoice",type:"submit",onclick:d(e).addVoucher,disable:d(e).loading},null,8,["onclick","disable"]),[[h]])]),_:1})])]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}},ue={class:"tw-w-11/12 tw-mx-auto tw-flex tw-justify-end tw-mb-5 tw-gap-4"},De={__name:"AdminVoucherListPage",setup(n){const e=P();e.currentPage="Voucher List";const c=D();c.fetchListOfVouchers();const r=[{name:"Voucher Id",required:!0,label:"Voucher Id",align:"left",field:u=>u.id,format:u=>`${u}`,sortable:!0},{name:"Date",align:"center",label:"Date",field:u=>u.date_issued,format:u=>k.formatDate(u,"MMM D, YYYY"),sortable:!0},{name:"Description",align:"center",label:"Description",field:"description",sortable:!0},{name:"Recipient",align:"center",label:"Recipient",field:u=>u.recipient.last_name+" "+u.recipient.first_name,sortable:!0},{name:"Issuer",align:"center",label:"Issuer",field:u=>u.issuer.last_name+" "+u.issuer.first_name,sortable:!0},{name:"Amount",align:"center",label:"Amount",field:"amount",sortable:!0},{name:"actions",align:"center",label:"",field:""}];return(u,a)=>(V(),y(x,null,[o("div",ue,[l(W),l(de)]),l(U,{class:"my-sticky-header-table tw-w-11/12 tw-mx-auto tw-mt-6 tw-bg-white tw-shadow-lg tw-border tw-rounded-3xl tw-border-collapse",flat:"",bordered:"",filter:u.tableSearch,columns:r,rows:d(c).getActive,"rows-per-page-options":[10,20,0],"row-key":"name"},{"body-cell-actions":i(s=>[l($,{key:"actions",class:"tw-w-2/12",props:s},{default:i(()=>[l(R,{rows:s.row},null,8,["rows"])]),_:2},1032,["props"])]),"top-right":i(()=>[l(b,{borderless:"",dense:"",debounce:"300",modelValue:u.tableSearch,"onUpdate:modelValue":a[0]||(a[0]=s=>u.tableSearch=s),placeholder:"Search"},{append:i(()=>[l(g,{name:"search"})]),_:1},8,["modelValue"])]),_:1},8,["filter","rows"])],64))}};export{De as default};
