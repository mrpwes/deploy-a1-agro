import{Q as j}from"./QTd.312e33a5.js";import{at as Q,au as w,r as _,o as g,c as V,d as o,Q as p,w as d,a as l,f,S as h,n as L,e as r,aa as y,G as U,u as R,aA as E}from"./index.4b3c3d71.js";import{Q as m}from"./QInput.0b7d6fff.js";import{Q as C}from"./QTable.7eaf985e.js";import{d as O}from"./date.eeec251e.js";import{u as F}from"./pageHeader.5864d687.js";import{Q as b}from"./QSelect.719db4c9.js";import{Q as $,C as v}from"./ClosePopup.261790f7.js";import{Q as k}from"./QForm.2888d044.js";import{Q as D}from"./QDialog.f2508d6d.js";import{g as I,Q as S}from"./position-engine.65eff008.js";import{u as N}from"./globalNotification.5695dab9.js";import"./use-key-composition.58a46558.js";import"./focus-manager.f3c2b9a5.js";import"./QList.bb366341.js";const x=Q("viewVoucher",{state:()=>({rows:[]}),getters:{getActive(n){return n.rows.filter(s=>s.is_archive===!1)},getInactive(n){return n.rows.filter(s=>s.is_archive===!0)}},actions:{async fetchListOfVouchers(){try{const{data:n,error:s}=await w.from("voucher").select(`
              id,
              admin_employee_id(company_employee_id, first_name, middle_name, last_name),
              subject,
              description,
              date_issued,
              recipient(company_employee_id, first_name, middle_name, last_name),
              issuer(company_employee_id, first_name, middle_name, last_name), 
              amount,
              is_archive
            `);if(s)throw s;this.rows=n}catch(n){console.log(n)}},async archivedVoucher(n,s){try{const{data:u,error:i}=await w.from("voucher").update({is_archive:!s}).eq("id",n);if(i)throw i;console.log(u),this.fetchListOfVouchers()}catch(u){console.log(u)}}}});const B={class:"!tw-h-min !tw-w-4/12 !tw-max-w-full tw-bg-white tw-p-6 tw-pb-3"},Y={class:"tw-grid tw-gap-3"},M=l("div",{class:"tw-text-3xl tw-font-extrabold"},"Add Voucher",-1),P={class:"tw-flex tw-justify-between"},T={class:"tw-flex"},G=l("div",{class:"tw-my-auto"},"Subject:",-1),H=l("div",{class:"tw-w-2"},null,-1),z={class:"tw-w-36"},W=l("span",{class:"tw-text-gray-500"},"(Optional)",-1),J={class:"tw-flex tw-justify-between"},K={class:"tw-flex"},X=l("div",{class:"tw-my-auto"},"Date Issued:",-1),Z=l("div",{class:"tw-w-2"},null,-1),ee={class:"tw-flex"},te=l("div",{class:"tw-my-auto"},"Amount:",-1),se=l("div",{class:"tw-w-2"},null,-1),q={__name:"ViewVoucherButton",props:["rows"],setup(n){const s=x(),u=_(!1),i=_(null);function c(e){i.value=e,u.value=!0,i.value.issuer_name=e.issuer.company_employee_id+" - "+e.issuer.last_name+", "+e.issuer.first_name+" "+e.issuer.middle_name,i.value.recipient_name=e.issuer.company_employee_id+" - "+e.recipient.last_name+", "+e.recipient.first_name+" "+e.recipient.middle_name}return(e,t)=>(g(),V(y,null,[o(p,{style:{"flex-wrap":"nowrap !important"},icon:"visibility",label:"VIEW",onClick:t[0]||(t[0]=a=>c(n.rows))}),o(D,{modelValue:u.value,"onUpdate:modelValue":t[8]||(t[8]=a=>u.value=a),persistent:""},{default:d(()=>[l("div",B,[o(k,{autofocus:""},{default:d(()=>[l("div",Y,[M,l("div",P,[l("div",null,[o(b,{rounded:"",standout:"bg-teal text-white",modelValue:i.value.recipient_name,"onUpdate:modelValue":t[1]||(t[1]=a=>i.value.recipient_name=a),label:"Recipient",readonly:"",autogrow:""},null,8,["modelValue"])]),l("div",null,[o(b,{rounded:"",standout:"bg-teal text-white",modelValue:i.value.issuer_name,"onUpdate:modelValue":t[2]||(t[2]=a=>i.value.issuer_name=a),label:"Issuer",readonly:"",autogrow:""},null,8,["modelValue"])])]),l("div",T,[G,H,l("div",z,[o(m,{rounded:"",standout:"bg-teal text-white",modelValue:i.value.subject,"onUpdate:modelValue":t[3]||(t[3]=a=>i.value.subject=a),readonly:"",autogrow:"",type:"text",required:""},null,8,["modelValue"])])]),l("div",null,[f(" Description: "),W,o(m,{rounded:"",standout:"bg-teal text-white",modelValue:i.value.description,"onUpdate:modelValue":t[4]||(t[4]=a=>i.value.description=a),readonly:"",autogrow:"",type:"text"},null,8,["modelValue"])]),l("div",J,[l("div",K,[X,Z,o(m,{rounded:"",standout:"bg-teal text-white",modelValue:i.value.date_issued,"onUpdate:modelValue":t[5]||(t[5]=a=>i.value.date_issued=a),"aria-required":"",type:"date","hide-bottom-space":"",readonly:""},null,8,["modelValue"])]),l("div",ee,[te,se,o(m,{rounded:"",standout:"bg-teal text-white",modelValue:i.value.amount,"onUpdate:modelValue":t[6]||(t[6]=a=>i.value.amount=a),readonly:"",dense:e.dense,"hide-bottom-space":"",type:"number",required:""},null,8,["modelValue","dense"])])])]),o($,{align:"right"},{default:d(()=>[h(o(p,{flat:"",label:"CLOSE"},null,512),[[v]]),h(o(p,{flat:"",class:L(i.value.is_archive?"tw-bg-green-400":"tw-bg-red-400"),icon:"mdi-archive",label:i.value.is_archive?"Unarchive":"Archive",onClick:t[7]||(t[7]=a=>r(s).archivedVoucher(i.value.id,i.value.is_archive))},null,8,["class","label"]),[[v]])]),_:1})]),_:1})])]),_:1},8,["modelValue"])],64))}},oe={class:"!tw-h-min !tw-w-8/12 !tw-max-w-full tw-bg-white tw-p-6"},le=l("div",{class:"tw-col-span-4 tw-text-3xl tw-font-extrabold tw-pb-3"}," Archived Voucher ",-1),ae={__name:"ArchivedVoucherButton",setup(n){const s=x(),u=_(!1),i=_(""),c=[{name:"id",required:!0,label:"Voucher Id",align:"left",field:e=>e.id,format:e=>`${e}`,sortable:!0},{name:"subject",align:"center",label:"Subject",field:"subject",sortable:!0},{name:"Date",align:"center",label:"Date",field:e=>e.date_issued,format:e=>O.formatDate(e,"MMM D, YYYY"),sortable:!0},{name:"Recipient",align:"center",label:"Recipient",field:e=>e.recipient.last_name+" "+e.recipient.first_name,sortable:!0},{name:"Issuer",align:"center",label:"Issuer",field:e=>e.issuer.last_name+" "+e.issuer.first_name,sortable:!0},{name:"Amount",align:"center",label:"Amount",field:"amount",sortable:!0},{name:"actions",align:"center",label:"",field:""}];return(e,t)=>(g(),V(y,null,[o(p,{icon:"mdi-archive",label:"Archived Voucher",onClick:t[0]||(t[0]=a=>u.value=!0),class:"tw-bg-white"}),o(D,{modelValue:u.value,"onUpdate:modelValue":t[2]||(t[2]=a=>u.value=a),persistent:""},{default:d(()=>[l("div",oe,[le,o(C,{class:"my-sticky-header-table tw-w-11/12 tw-mx-auto tw-mt-6 tw-bg-white tw-shadow-lg tw-border tw-rounded-3xl tw-border-collapse",flat:"",bordered:"",filter:i.value,columns:c,rows:r(s).getInactive,"rows-per-page-options":[10,20,0],"row-key":"name"},{"body-cell-actions":d(a=>[o(j,{props:a},{default:d(()=>[l("div",null,[o(q,{rows:a.row},null,8,["rows"])])]),_:2},1032,["props"])]),"top-right":d(()=>[o(m,{borderless:"",dense:"",debounce:"300",modelValue:i.value,"onUpdate:modelValue":t[1]||(t[1]=a=>i.value=a),placeholder:"Search"},{append:d(()=>[o(U,{name:"search"})]),_:1},8,["modelValue"])]),_:1},8,["filter","rows"]),o($,{align:"right",class:"text-primary"},{default:d(()=>[h(o(p,{flat:"",label:"Cancel"},null,512),[[v]])]),_:1})])]),_:1},8,["modelValue"])],64))}},A=N(),ie=R(),ne=x(),re=Q("addVoucher",{state:()=>({currentEmployeeID:ie.getEmployeeId,type:null,date_issued:null,recipient:null,recipientOptions:[],issuer:null,issuerOptions:[],description:null,amount:null,addVoucherDialog:!1}),getters:{},actions:{async addVoucherData(){try{const{data:n,error:s}=await w.from("voucher").insert([{admin_employee_id:this.currentEmployeeID,subject:this.subject,description:this.description,date_issued:this.date_issued,recipient:this.recipient.id,issuer:this.issuer.id,amount:this.amount,is_archive:!1}]);if(s)throw s;console.log(n),this.addVoucherDialog=!1,A.showSuccessNotification("Voucher added successfully"),ne.fetchListOfVouchers(),this.resetForm()}catch(n){A.showErrorNotification("Error: "+n.message),this.resetForm()}},resetForm(){this.subject=null,this.description=null,this.date_issued=null,this.recipient=null,this.issuer=null,this.amount=null},async getCurrentUser(){const{data:{user:n}}=await w.auth.getUser();this.employee_id=n.id},async fetchReferenceData(){try{const{data:n,error:s}=await w.from("employee").select("id, company_employee_id, first_name, middle_name, last_name");if(s)throw s;this.recipientOptions=n,this.issuerOptions=n}catch(n){console.log(n)}}}}),de={class:"!tw-h-min !tw-w-4/12 !tw-max-w-full tw-bg-white tw-p-6 tw-pb-3"},ue={class:"tw-grid tw-gap-3"},ce=l("div",{class:"tw-text-3xl tw-font-extrabold"},"Add Voucher",-1),me={class:"tw-flex tw-justify-between"},pe={class:"tw-flex"},we=l("div",{class:"tw-my-auto"},"Subject:",-1),_e=l("div",{class:"tw-w-2"},null,-1),fe={class:"tw-w-36"},he=l("span",{class:"tw-text-gray-500"},"(Optional)",-1),be={class:"tw-flex tw-justify-between"},ve={class:"tw-flex"},ge=l("div",{class:"tw-my-auto"},"Date Issued:",-1),Ve=l("div",{class:"tw-w-2"},null,-1),ye={class:"tw-flex"},xe=l("div",{class:"tw-my-auto"},"Amount:",-1),$e=l("div",{class:"tw-w-2"},null,-1),De={__name:"AddVoucherButton",setup(n){const s=re();s.fetchReferenceData();function u(c,e){e(()=>{console.log(c);const t=c.toLowerCase();s.selectorRecipientOptions=s.recipientOptions.filter(a=>String(a.company_employee_id).toLowerCase().indexOf(t)>-1)})}function i(c,e){e(()=>{console.log(c);const t=c.toLowerCase();s.selectorIssuerOptions=s.issuerOptions.filter(a=>String(a.company_employee_id).toLowerCase().indexOf(t)>-1)})}return(c,e)=>(g(),V(y,null,[o(p,{icon:"mdi-plus",label:"Add Voucher",onClick:e[0]||(e[0]=t=>r(s).addVoucherDialog=!0),class:"tw-bg-white"}),o(D,{modelValue:r(s).addVoucherDialog,"onUpdate:modelValue":e[7]||(e[7]=t=>r(s).addVoucherDialog=t),persistent:""},{default:d(()=>[l("div",de,[o(k,{onSubmit:E(r(s).addVoucherData,["prevent"]),autofocus:""},{default:d(()=>[l("div",ue,[ce,l("div",me,[l("div",null,[o(b,{rounded:"",standout:"bg-teal text-white",modelValue:r(s).recipient,"onUpdate:modelValue":e[1]||(e[1]=t=>r(s).recipient=t),"use-input":"","hide-selected":"","fill-input":"","hide-bottom-space":"","input-debounce":"0",label:"Recipient",options:r(s).selectorRecipientOptions,"option-label":t=>"first_name"in t?t.company_employee_id+" - "+t.last_name:"","option-value":c.id,onFilter:u,disable:r(s).loading,required:""},{"no-option":d(()=>[o(I,null,{default:d(()=>[o(S,{class:"text-grey"},{default:d(()=>[f(" No results ")]),_:1})]),_:1})]),_:1},8,["modelValue","options","option-label","option-value","disable"])]),l("div",null,[o(b,{rounded:"",standout:"bg-teal text-white",modelValue:r(s).issuer,"onUpdate:modelValue":e[2]||(e[2]=t=>r(s).issuer=t),"use-input":"","hide-selected":"","fill-input":"","hide-bottom-space":"","input-debounce":"0",label:"Issuer",options:r(s).selectorIssuerOptions,"option-label":t=>"first_name"in t?t.company_employee_id+" - "+t.last_name:"","option-value":c.id,onFilter:i,required:""},{"no-option":d(()=>[o(I,null,{default:d(()=>[o(S,{class:"text-grey"},{default:d(()=>[f(" No results ")]),_:1})]),_:1})]),_:1},8,["modelValue","options","option-label","option-value"])])]),l("div",pe,[we,_e,l("div",fe,[o(m,{rounded:"",standout:"bg-teal text-white",modelValue:r(s).subject,"onUpdate:modelValue":e[3]||(e[3]=t=>r(s).subject=t),autogrow:"",type:"text",required:""},null,8,["modelValue"])])]),l("div",null,[f(" Description: "),he,o(m,{rounded:"",standout:"bg-teal text-white",modelValue:r(s).description,"onUpdate:modelValue":e[4]||(e[4]=t=>r(s).description=t),autogrow:"",type:"text"},null,8,["modelValue"])]),l("div",be,[l("div",ve,[ge,Ve,o(m,{rounded:"",standout:"bg-teal text-white",modelValue:r(s).date_issued,"onUpdate:modelValue":e[5]||(e[5]=t=>r(s).date_issued=t),"aria-required":"",type:"date","hide-bottom-space":""},null,8,["modelValue"])]),l("div",ye,[xe,$e,o(m,{rounded:"",standout:"bg-teal text-white",modelValue:r(s).amount,"onUpdate:modelValue":e[6]||(e[6]=t=>r(s).amount=t),dense:c.dense,"hide-bottom-space":"",type:"number",required:""},null,8,["modelValue","dense"])])])]),o($,{align:"right"},{default:d(()=>[h(o(p,{flat:"",label:"Cancel",onClick:r(s).resetForm},null,8,["onClick"]),[[v]]),o(p,{flat:"",class:"tw-bg-green-400",label:"Add Invoice",type:"submit"})]),_:1})]),_:1},8,["onSubmit"])])]),_:1},8,["modelValue"])],64))}},Ie={class:"tw-w-11/12 tw-mx-auto tw-flex tw-justify-end tw-mb-5 tw-gap-4"},Ye={__name:"AdminVoucherListPage",setup(n){const s=F();s.currentPage="Voucher List";const u=_(""),i=x();i.fetchListOfVouchers();const c=[{name:"id",required:!0,label:"Voucher Id",align:"left",field:e=>e.id,format:e=>`${e}`,sortable:!0},{name:"subject",align:"center",label:"Subject",field:"subject",sortable:!0},{name:"Date",align:"center",label:"Date",field:e=>e.date_issued,format:e=>O.formatDate(e,"MMM D, YYYY"),sortable:!0},{name:"Recipient",align:"center",label:"Recipient",field:e=>e.recipient.last_name+" "+e.recipient.first_name,sortable:!0},{name:"Issuer",align:"center",label:"Issuer",field:e=>e.issuer.last_name+" "+e.issuer.first_name,sortable:!0},{name:"Amount",align:"center",label:"Amount",field:"amount",sortable:!0},{name:"actions",align:"center",label:"",field:""}];return(e,t)=>(g(),V(y,null,[l("div",Ie,[o(ae),o(De)]),o(C,{class:"my-sticky-header-table tw-w-11/12 tw-mx-auto tw-mt-6 tw-bg-white tw-shadow-lg tw-border tw-rounded-3xl tw-border-collapse",flat:"",bordered:"",filter:u.value,columns:c,rows:r(i).getActive,"rows-per-page-options":[10,20,0],"row-key":"name"},{"body-cell-actions":d(a=>[o(j,{key:"actions",class:"tw-w-2/12",props:a},{default:d(()=>[o(q,{rows:a.row},null,8,["rows"])]),_:2},1032,["props"])]),"top-right":d(()=>[o(m,{borderless:"",dense:"",debounce:"300",modelValue:u.value,"onUpdate:modelValue":t[0]||(t[0]=a=>u.value=a),placeholder:"Search"},{append:d(()=>[o(U,{name:"search"})]),_:1},8,["modelValue"])]),_:1},8,["filter","rows"])],64))}};export{Ye as default};
