import{w as R,t as A}from"./position-engine.b68752fb.js";import{b as T,Q as k}from"./QSelect.862e4161.js";import{u as L}from"./pageHeader.8f3bb32f.js";import{u as N,ar as M,as as S,at as W,o as O,c as E,a as t,a8 as m,d as I,w as P,e as r,aT as V,f as B,aR as G,aS as Q}from"./index.2cf10682.js";import{u as U}from"./payrollTableFormatter.e3a7b8df.js";import"./focus-manager.c6d20410.js";import"./use-key-composition.6156933d.js";import"./globalNotification.4b844c52.js";import"./axios.0ed95acd.js";const $=N(),j=M("payslip",{state:()=>({payrollColumns:{columns:[{name:"employeeId",required:!0,label:"Emp. Id",align:"left",sortable:!0},{name:"employeeName",align:"center",label:"Name",sortable:!0,classes:"!tw-bg-neutral-300"},{name:"noDaysWorked",align:"center",label:"Days Worked",sortable:!0},{name:"ratePerDay",align:"center",label:"Rate/Day",classes:"!tw-bg-neutral-300"},{name:"total",align:"center",label:"Total",sortable:!0},{name:"sss",align:"center",label:"SSS",sortable:!0,classes:"!tw-bg-neutral-300"},{name:"philHealth",align:"center",label:"PhilHealth",sortable:!0},{name:"pagIbig",align:"center",label:"PagIBIG",sortable:!0,classes:"!tw-bg-neutral-300"},{name:"sssCalamityLoan",align:"center",label:"SSS Calamity Loan",sortable:!0},{name:"sssLoan",align:"center",label:"SSS  Loan",sortable:!0,classes:"!tw-bg-neutral-300"},{name:"pagIbigLoan",align:"center",label:"Pag-IBIG Loan",sortable:!0,headerStyle:"width: 0px"},{name:"NetPay",align:"center",label:"NetPay",sortable:!0,classes:"!tw-bg-neutral-300"},{name:"actions",align:"center",label:""}]},rows:[{id:null,company_employee_id:null,employment_type_id:null,first_name:null,middle_name:null,last_name:null,date_of_birth:null,gender:null,martial_status:null,department:null,position:null,phil_health_number:null,pag_ibig_number:null,sss_number:null,bir_tin:null,hired_date:null,rate_per_day:null,is_archive:null,emp_id_modified_by:null,change_date:null,attendance:[],emp_sss_contrib_audit:[],emp_philhealth_contrib_audit:[],emp_pagibig_contrib_audit:[],vale_audit:null,employee_audit:[{gender:null,bir_tin:null,audit_id:null,position:null,last_name:null,department:null,first_name:null,hired_date:null,is_archive:null,sss_number:null,change_date:null,employee_id:null,middle_name:null,rate_per_day:null,date_of_birth:null,martial_status:null,operation_type:null,pag_ibig_number:null,emp_id_modified_by:null,employment_type_id:null},{gender:null,bir_tin:null,audit_id:null,position:null,last_name:null,department:null,first_name:null,hired_date:null,is_archive:null,sss_number:null,change_date:null,employee_id:null,middle_name:null,rate_per_day:null,date_of_birth:null,martial_status:null,operation_type:null,pag_ibig_number:null,emp_id_modified_by:null,employment_type_id:null},{gender:null,bir_tin:null,audit_id:null,position:null,last_name:null,department:null,first_name:null,hired_date:null,is_archive:null,sss_number:null,change_date:null,employee_id:null,middle_name:null,rate_per_day:null,date_of_birth:null,martial_status:null,operation_type:null,pag_ibig_number:null,emp_id_modified_by:null,employment_type_id:null}],partial_to_ar_audit:null}],selectedDate:null,selectedDateOptions:null,currentUser:$.getEmployeeId}),getters:{},actions:{formatDate(a){const e=a.getFullYear(),o=String(a.getMonth()+1).padStart(2,"0"),n=String(a.getDate()).padStart(2,"0");return`${e}-${o}-${n}`},getAndCheckDateRangesForCurrentMonth(){const a=new Date,e=a.getFullYear(),o=a.getMonth(),n=new Date(e,o,1),s=new Date(e,o,15),l=new Date(e,o,16),d=new Date(e,o+1,0),p={firstHalf:{start:this.formatDate(n),end:this.formatDate(s)},secondHalf:{start:this.formatDate(l),end:this.formatDate(d)}},h=this.formatDate(a),i=new Date(p.firstHalf.start),u=new Date(p.firstHalf.end),_=new Date(p.secondHalf.start),f=new Date(p.secondHalf.end);let b,g;return a>=i&&a<=u?(b=this.formatDate(i),g=this.formatDate(u)):a>=_&&a<=f?(b=this.formatDate(_),g=this.formatDate(f)):(b="out of range",g="out of range"),{todayDate:h,startDate:b,endDate:g}},async getSalaryHistory(){try{const{data:a,error:e}=await S.from("salary_history").select();e&&console.error(e),this.selectedDateOptions=a.sort((o,n)=>new Date(o.date_start)-new Date(n.date_start))}catch(a){console.error(a)}},customLogic(a,e){return!(a&&e)},async fetchAttendanceInRange(a=this.selectedDate.date_start,e=this.selectedDate.date_end){try{const{data:o,error:n}=await S.from("employee").select(`*,
            attendance(*, attendance_type(*)),
            employee_audit!employee_audit_employee_id_fkey(*),
            emp_sss_contrib_audit!emp_sss_contrib_audit_employee_id_fkey(*),
            emp_philhealth_contrib_audit!emp_philhealth_contrib_audit_employee_id_fkey(*),
            emp_pagibig_contrib_audit!emp_pagibig_contrib_audit_employee_id_fkey(*),
            vale_audit!vale_audit_employee_id_fkey(*),
            partial_to_ar_audit!partial_to_ar_audit_employee_id_fkey(*)
            `).eq("is_archive",!1).gte("attendance.date",a).lte("attendance.date",e).lte("emp_sss_contrib_audit.change_date",e).lte("emp_philhealth_contrib_audit.change_date",e).lte("emp_pagibig_contrib_audit.change_date",e).lte("vale_audit.change_date",e).eq("id",this.currentUser);o.forEach(s=>{const l=s.emp_sss_contrib_audit;if(l.length>0){const d=l[l.length-1];d.half_month_indicator==!0&&[28,29,30,31].includes(parseInt(e.split("-")[2]))?console.log("is true."):d.half_month_indicator==!1&&[15].includes(parseInt(e.split("-")[2]))?console.log("is true 2."):(console.log("EMPLOYEE SSS is false."),s.emp_sss_contrib_audit=[])}else console.log("emp_sss_contrib_audit array is empty.")}),o.forEach(s=>{const l=s.emp_philhealth_contrib_audit;if(l.length>0){const d=l[l.length-1];d.half_month_indicator==!0&&[28,29,30,31].includes(parseInt(e.split("-")[2]))?console.log("Philhealth is true."):d.half_month_indicator==!1&&[15].includes(parseInt(e.split("-")[2]))?console.log("Philhealth is true 2."):s.emp_philhealth_contrib_audit=[]}else console.log("emp_philhealth_contrib_audit array is empty.")}),o.forEach(s=>{const l=s.emp_pagibig_contrib_audit;if(l.length>0){const d=l[l.length-1];d.half_month_indicator==!0&&[28,29,30,31].includes(parseInt(e.split("-")[2]))?console.log("Pagibig is true."):d.half_month_indicator==!1&&[15].includes(parseInt(e.split("-")[2]))?console.log("Pagibig is true 2."):s.emp_pagibig_contrib_audit=[]}else console.log("emp_pagibig_contrib_audit array is empty.")}),n&&console.error(n),this.rows=o}catch(o){console.error(o)}},getNearestDateRange(){if(this.selectedDate!=null)return;const a=new Date;function e(l){return new Date(l)}function o(l){return Math.abs(a-l)}let n=null,s=1/0;for(const l of this.selectedDateOptions){const d=e(l.date_start),p=e(l.date_end),h=o(d),i=o(p),u=Math.min(h,i);u<s&&(s=u,n=l)}this.selectedDate=n},async fetchAttendanceReports(){await this.getSalaryHistory(),await this.getNearestDateRange(),await this.fetchAttendanceInRange()}}}),q=M("payslipFormatter",{state:()=>({payrollData:[],sssContributionTableRanges:[],philhealthContributionRate:null,pagibigContributionRate:null,totalHours:0}),getters:{formattedPayrollData:a=>a.payrollData.map(e=>({...e,formattedDate:new Date(e.date).toLocaleDateString()}))},actions:{twoDecimalWithoutRounding(a){var e=a.toString().match(/^-?\d+(?:\.\d{0,2})?/)[0];return parseFloat(e)},capitalizeFirstLetterOfEachWord(a){return a.split(" ").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" ")},noDaysWorkedFormatter(a){let e=0;a.forEach(n=>{if(n.time_out===null&&n.time_in!==null)e+=0;else if(n.attendance_type_id!==1&&n.attendance_type_id!==void 0)e+=480;else if(n.time_in&&n.time_out){const s=new Date(n.time_in),l=new Date(n.time_out),d=new Date(s);d.setHours(8,0,0,0),s<d&&s.setHours(8,0,0,0);const p=new Date(l);p.setHours(17,0,0,0),l>p&&l.setHours(17,0,0,0);let h=(l-s)/(1e3*60);const i=new Date(l);i.setHours(13,0,0,0),l>i&&(h-=60),e+=h}});const o=e/60;return this.totalHours=this.twoDecimalWithoutRounding(o),(this.twoDecimalWithoutRounding(o)/8).toFixed(2)},grossIncomeFormatter(a,e){const o=this.noDaysWorkedFormatter(e);return a*o},monthlyIncomeFormatter(a,e=30){return this.twoDecimalWithoutRounding(a*e)},async fetchSssContributionTable(){try{const{data:a,error:e}=await S.from("sss_contribution_table_audit").select("*").order("audit_id",{ascending:!1}).limit(1);if(e)throw console.error(e),e;this.sssContributionTableRanges=a[0].data.map(o=>{const n=o.combinedValue;let s,l,d;if(d=parseFloat(o.values[4].replace(",","")),n.startsWith("Below"))s=0,l=parseFloat(n.split(" ")[1].replace(",",""));else if(n.includes("Over"))s=parseFloat(n.split(" ")[0].replace(",","")),l=null;else{const[p,h]=n.split(" - ");s=parseFloat(p.replace(",","")),l=parseFloat(h.replace(",",""))}return{min:s,max:l,sss_bracket:d}})}catch(a){console.error(a)}},findSSSRange(a){for(const e of this.sssContributionTableRanges)if(a>=e.min&&a<e.max)return e.sss_bracket;return"Value is out of range"},async fetchPhilhealthContributionTable(){try{const{data:a,error:e}=await S.from("philhealth_contribution_table_audit").select("*").order("audit_id",{ascending:!1}).limit(1);if(e)throw console.error(e),e;this.philhealthContributionRate=a[0].data.value}catch(a){console.error(a)}},async fetchPagibigContributionTable(){try{const{data:a,error:e}=await S.from("pagibig_contribution_table_audit").select("*").order("audit_id",{ascending:!1}).limit(1);if(e)throw console.error(e),e;this.pagibigContributionRate=a}catch(a){console.error(a)}},calculatePagibigContribution(a){const e=this.monthlyIncomeFormatter(a);let o,n;return e<=1500?(o=.01,n=Math.min(e,1e4)*o):(o=.02,n=Math.min(e,1e4)*o),this.twoDecimalWithoutRounding(n)}}});const c=a=>(G("data-v-500b5334"),a=a(),Q(),a),z={class:"noScreen"},Y=V('<div class="tw-flex tw-flex-row tw-justify-between tw-mb-10" data-v-500b5334><div class="tw-flex tw-flex-row" data-v-500b5334><img class="tw-size-28 tw-mt-3" src="src/assets/logo.png" data-v-500b5334><div class="tw-text-1xl tw-w-1/6 tw-content-center tw-ml-2 tw-text-nowrap tw-mt-3" data-v-500b5334> A1 Agro Fertilizer and<br data-v-500b5334> Chemical Supply <br data-v-500b5334><br data-v-500b5334><text class="tw-text-nowrap" data-v-500b5334>+63 123 456 7890</text></div></div><div data-v-500b5334><div class="tw-font-bold tw-text-3xl tw-text-right" data-v-500b5334>Payslip</div><div class="tw-text-lg tw-text-right" data-v-500b5334>#123123</div></div></div>',1),J={class:"tw-pl-10"},K={class:"tw-py-2"},X=c(()=>t("div",{class:"tw-flex tw-flex-row"},[t("div",{class:"tw-pr-8"},"MARAAN, ARNIENO P."),t("div",null,"20190149350")],-1)),Z={class:"tw-rounded-3xl tw-text-nowrap tw-w-6/12 tw-mx-auto tw-mb-3 tw-bg-white tw-shadow-lg noPrint"},tt={class:"tw-justify-evenly"},et=c(()=>t("td",{class:"tw-text-center"},null,-1)),at={class:"tw-text-end tw-pr-3"},nt=c(()=>t("thead",null,[t("tr",null,[t("th",{colspan:"3"},[t("div",null,"Gross Income")]),t("th",{colspan:"3"},[t("div",null,"Deductions")])])],-1)),lt=c(()=>t("td",{colspan:"1"},[t("div",null,"Rate Per Day:")],-1)),ot={colspan:"1"},st=c(()=>t("td",{colspan:"1"},null,-1)),it=c(()=>t("td",{colspan:"2"},[t("div",null,"SSS Contribution:")],-1)),rt=c(()=>t("td",{colspan:"1"},[t("div",null,"Days Worked:")],-1)),dt={colspan:"1"},ct=c(()=>t("td",{colspan:"2"},[t("div",null,"PhilHealth Contribution:")],-1)),ut=c(()=>t("td",null,[t("div")],-1)),_t=c(()=>t("td",{colspan:"2"},[t("div")],-1)),pt=c(()=>t("td",{colspan:"2"},[t("div",null,"Pag-IBIG Contribution:")],-1)),mt=c(()=>t("tr",null,[t("td",{colspan:"3"},[t("br")]),t("td",{colspan:"3"},[t("br")])],-1)),ht=c(()=>t("tr",null,[t("td",{colspan:"3"},[t("div")]),t("td",{colspan:"2"},[t("div",null,"SSS Calamity Loan:")]),t("td",null,[t("div",null,"0")])],-1)),bt=c(()=>t("tr",null,[t("td",{colspan:"3"},[t("div")]),t("td",{colspan:"2"},[t("div",null,"SSS Loan:")]),t("td",null,[t("div",null,"0")])],-1)),gt=c(()=>t("tr",null,[t("td",{colspan:"3"},[t("div")]),t("td",{colspan:"2"},[t("div",null,"Pag-IBIG Loan:")]),t("td",null,[t("div",null,"0")])],-1)),ft=c(()=>t("tr",null,[t("td",{colspan:"3"},[t("br")]),t("td",{colspan:"3"},[t("br")])],-1)),yt=c(()=>t("td",{colspan:"2"},"Total Gross Income:",-1)),wt=c(()=>t("td",{colspan:"2"},"Total Deductions:",-1)),Dt=c(()=>t("td",{colspan:"3"},null,-1)),vt=c(()=>t("td",{colspan:"2"},"Total Net Pay:",-1)),St={__name:"PayslipPage",setup(a){const e=U(),o=L();o.currentPage="Payslip";const n=j(),s=q();n.fetchAttendanceReports();function l(i){var u=i.toString().match(/^-?\d+(?:\.\d{0,2})?/)[0];return parseFloat(u)}function d(i){var u,_,f,b,g,y,w,D,v;return((_=(u=i.emp_sss_contrib_audit[0])==null?void 0:u.amount)!=null?_:0)+((b=(f=i.emp_philhealth_contrib_audit[0])==null?void 0:f.amount)!=null?b:0)+((y=(g=i.emp_pagibig_contrib_audit[0])==null?void 0:g.amount)!=null?y:0)+((w=i.sssCalamityLoan)!=null?w:0)+((D=i.sssLoan)!=null?D:0)+((v=i.pagIbigLoan)!=null?v:0)}function p(i){try{return l(s.grossIncomeFormatter(i.rate_per_day,i.attendance)-d(i))}catch(u){return console.error("Error calculating payroll:",u),i}}function h(i){return Math.floor(i*100)/100}return(i,u)=>(O(),E("div",null,[t("div",z,[Y,t("div",J,[t("div",K,m(i.model),1),X])]),t("table",Z,[t("tr",tt,[t("td",null,[t("div",null,[I(T,{rounded:"",standout:"","use-input":"",modelValue:r(n).selectedDate,"onUpdate:modelValue":[u[0]||(u[0]=_=>r(n).selectedDate=_),u[1]||(u[1]=_=>r(n).fetchAttendanceReports())],options:r(n).selectedDateOptions,"option-label":_=>_.date_start+" "+_.date_end,"hide-selected":"","fill-input":"","hide-bottom-space":"","input-debounce":"0",class:"!tw-pb-0"},{"no-option":P(()=>[I(R,null,{default:P(()=>[I(A,{class:"text-grey"},{default:P(()=>[B(" No results ")]),_:1})]),_:1})]),_:1},8,["modelValue","options","option-label"])])]),et,t("td",at,m(r(n).rows[0].last_name)+", "+m(r(n).rows[0].first_name)+" "+m(r(n).rows[0].middle_name),1)])]),I(k,{separator:"cell",class:"tw-rounded-3xl tw-w-6/12 tw-mx-auto tw-mb-3 tw-bg-white tw-shadow-lg"},{default:P(()=>{var _,f,b,g,y,w,D,v,x,C,F,H;return[nt,t("tbody",null,[t("tr",null,[lt,t("td",ot,[t("div",null,"\u20B1"+m(r(n).rows[0].rate_per_day),1)]),st,it,t("td",null,[t("div",null," \u20B1 "+m((g=(b=(f=(_=r(n).rows[0])==null?void 0:_.emp_sss_contrib_audit)==null?void 0:f[r(n).rows[0].emp_sss_contrib_audit.length-1])==null?void 0:b.amount)!=null?g:0),1)])]),t("tr",null,[rt,t("td",dt,[t("div",null,m(h(r(e).calculateTotalAttendanceHours(r(n).rows[0].attendance)/8)),1)]),t("td",null," \u20B1"+m(h(r(e).grossIncomeFormatter(r(n).rows[0].rate_per_day,r(n).rows[0].attendance))),1),ct,t("td",null,[t("div",null," \u20B1 "+m((v=(D=(w=(y=r(n).rows[0])==null?void 0:y.emp_philhealth_contrib_audit)==null?void 0:w[r(n).rows[0].emp_philhealth_contrib_audit.length-1])==null?void 0:D.amount)!=null?v:0),1)])]),t("tr",null,[ut,_t,pt,t("td",null,[t("div",null," \u20B1 "+m((H=(F=(C=(x=r(n).rows[0])==null?void 0:x.emp_pagibig_contrib_audit)==null?void 0:C[r(n).rows[0].emp_pagibig_contrib_audit.length-1])==null?void 0:F.amount)!=null?H:0),1)])]),mt,ht,bt,gt,ft,t("tr",null,[yt,t("td",null," \u20B1"+m(h(r(e).grossIncomeFormatter(r(n).rows[0].rate_per_day,r(n).rows[0].attendance))),1),wt,t("td",null,"\u20B1"+m(d(r(n).rows[0])),1)]),t("tr",null,[Dt,vt,t("td",null,"\u20B1"+m(p(r(n).rows[0])),1)])])]}),_:1})]))}};var Tt=W(St,[["__scopeId","data-v-500b5334"]]);export{Tt as default};
