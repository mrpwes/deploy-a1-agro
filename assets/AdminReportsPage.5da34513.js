import{u as ct}from"./pageHeader.b29c2f83.js";import{ar as te,as as O,k as dt,r as N,j as k,h as Oe,I as mt,p as I,t as ft,ax as ht,T as pt,S as Y,Q as R,i as gt,af as yt,o as B,c as me,d as h,n as vt,w as y,aN as _t,e as p,a as D,a8 as V,f as q,a7 as z,a5 as bt,G as fe}from"./index.504ec86a.js";import{Q as ae}from"./QInput.83dad3fc.js";import{Q as P}from"./QTd.6a465a6b.js";import{G as K,Q as wt,w as he,t as pe}from"./position-engine.224580a6.js";import{b as ge}from"./QSelect.b29667b8.js";import{Q as ye}from"./QTable.b7213eba.js";import{u as Dt}from"./globalNotification.5d4f7813.js";import{T as St}from"./TouchPan.d0668a2a.js";import{b as At,u as Tt}from"./focus-manager.bec94b0c.js";import{a as xt,i as Ct,h as It}from"./use-key-composition.c8c0c6cd.js";import{u as Re,a as Et,b as Ht,g as Mt,Q as qe}from"./QPopupProxy.7af26239.js";import{_ as de,f as kt}from"./date.40c9c2e6.js";import{C as W,Q as $e}from"./ClosePopup.337d1baa.js";import{Q as Ot}from"./QForm.590c6937.js";import{Q as Te}from"./QTr.e0dfd343.js";import"./QList.6e762c59.js";const Ue=te("attendanceTable",{state:()=>({rows:[],selectedDate:null,selectedDateOptions:null,attendanceColumns:{columns:[]}}),getters:{getSelectedDate(){return this.selectedDate},sortRowsByCompanyEmployeeId(e){e.rows.sort((t,a)=>t.company_employee_id-a.company_employee_id)}},actions:{capitalizeFirstLetterOfEachWord(e){return e.split(" ").map(t=>t.charAt(0).toUpperCase()+t.slice(1)).join(" ")},formatDate(e){const t=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0"),n=String(e.getDate()).padStart(2,"0");return`${t}-${a}-${n}`},getAndCheckDateRangesForCurrentMonth(){const e=new Date,t=e.getFullYear(),a=e.getMonth(),n=new Date(t,a,1),m=new Date(t,a,15),c=new Date(t,a,16),f=new Date(t,a+1,0),i={firstHalf:{start:this.formatDate(n),end:this.formatDate(m)},secondHalf:{start:this.formatDate(c),end:this.formatDate(f)}},o=this.formatDate(e),v=new Date(i.firstHalf.start),d=new Date(i.firstHalf.end),s=new Date(i.secondHalf.start),r=new Date(i.secondHalf.end);let b,w;return e>=v&&e<=d?(b=this.formatDate(v),w=this.formatDate(d)):e>=s&&e<=r?(b=this.formatDate(s),w=this.formatDate(r)):(b="out of range",w="out of range"),{todayDate:o,startDate:b,endDate:w}},async getSalaryHistory(){try{const{data:e,error:t}=await O.from("salary_history").select();t&&console.error(t),this.selectedDateOptions=e.sort((a,n)=>new Date(a.date_start)-new Date(n.date_start))}catch(e){console.error(e)}},fillMissingDates(e,t,a){console.log("FILLING MISSING DATES"+t+" "+a);const n=f=>{const i=f.getFullYear(),o=String(f.getMonth()+1).padStart(2,"0"),v=String(f.getDate()).padStart(2,"0");return`${i}-${o}-${v}`},m=new Date(t),c=new Date(a);return c.setDate(c.getDate()+1),e.forEach(f=>{const i=new Set(f.attendance.map(o=>o.date));for(let o=new Date(m);o<=c;o.setDate(o.getDate()+1)){const v=n(o);i.has(v)||f.attendance.push({id:null,date:v,employee:{first_name:f.first_name,last_name:f.first_name},remarks:null,time_in:null,time_out:null,employee_id:f.id,adjustment_salary_id:null})}f.attendance.sort((o,v)=>new Date(o.date)-new Date(v.date))}),e},calculateTotalHours(e){if(e.attendance_type==null)return 0;if(e.attendance_type.id!==1)return this.convertDecimalToHoursMinutes(8);let t=new Date(e.time_in);t.setMilliseconds(0);let a=new Date(e.time_out);a.setMilliseconds(0);const n=new Date(t);n.setHours(8,0,0),t<n&&t.setHours(8,0,0);const m=new Date(a);m.setHours(17,0,0),a>m&&a.setHours(17,0,0);let c=(a-t)/(1e3*60);const f=new Date(a);f.setHours(13,0,0);const i=new Date(a);i.setHours(12,0,0),a>f&&t<i&&(c-=60);const o=Math.floor(c/60)+c%60/60;return this.convertDecimalToHoursMinutes(o)},sumArray(e){return e.reduce((t,a)=>t+Number(a),0)},calculateTotalAttendanceHours(e){let t=0,a=[];return e.forEach(n=>{a.push(this.calculateTotalHours(n))}),console.log(a),t=this.sumArray(a),console.log(t),t.toFixed(4)},convertDecimalToHoursMinutes(e){const t=Math.floor(e),a=Math.floor((e-t)*60);return t+"."+a},async fetchAttendanceInRange(e=this.selectedDate.date_start,t=this.selectedDate.date_end){try{const{data:a,error:n}=await O.from("employee").select(`*,
             is_archive,
              attendance(*, attendance_type(*), employee(first_name, last_name, company_employee_id))`).gte("attendance.date",e).lte("attendance.date",t).eq("is_archive",!1);n&&console.error(n),this.rows=Object.values(this.fillMissingDates(a,e,t))}catch(a){console.error(a)}},columns(e=this.selectedDate.date_start,t=this.selectedDate.date_end){const a=new Date(e),n=new Date(t),m=[],c={day:"numeric",month:"numeric"},f=["S","M","T","W","TH","F","S"];for(let o=new Date(a);o<=n;o.setDate(o.getDate()+1)){o.getDate();const v=new Intl.DateTimeFormat("en-US",c).format(o),d=o.getDay(),s=`${v} ${f[d]}`;m.push((()=>({name:"actions",align:"center",label:`${s}`,sortable:!0}))())}const i=[{name:"employeeName",align:"center",label:"Name",sortable:!0,field:o=>o.company_employee_id+" - "+o.last_name+", "+o.first_name,format:o=>`${o}`},...m,{name:"totalHours",align:"center",label:"Total Hours",field:o=>this.calculateTotalAttendanceHours(o.attendance)},{name:"totalAbsent",align:"center",label:"A",sortable:!0,field:o=>{let v=0;const d=new Date;for(let s=0;s<o.attendance.length;s++)new Date(o.attendance[s].date)<=d&&(!o.attendance[s].time_in||!o.attendance[s].time_out)&&v++;return v}},{name:"totalLeave",align:"center",label:"LVE",field:o=>{let v=0;for(let d=0;d<o.attendance.length;d++)o.attendance[d].attendance_type_id==2&&v++;return v}}];this.attendanceColumns.columns.push(...i)},getNearestDateRange(){if(this.selectedDate!=null)return;const e=new Date;function t(c){return new Date(c)}function a(c){return Math.abs(e-c)}let n=null,m=1/0;for(const c of this.selectedDateOptions){const f=t(c.date_start),i=t(c.date_end),o=a(f),v=a(i),d=Math.min(o,v);d<m&&(m=d,n=c)}this.selectedDate=n},async fetchAttendanceReports(){this.attendanceColumns.columns=[],await this.getSalaryHistory(),this.getNearestDateRange(),this.columns(),this.fetchAttendanceInRange()}}}),Ve=Dt(),Rt=Ue(),je=te("reportsViewAttendanceTable",{state:()=>({attendanceID:null,attendanceDate:null,attendanceRemarks:null,attendanceTimeIn:null,attendanceTimeInProxy:null,attendanceTimeOut:null,attendanceTimeOutProxy:null,attendanceEmployeeID:null,attendanceType:null,attendanceAdjustmentSalaryID:null,listOfAttendanceType:[],listOfAdjustmentSalary:[],hourOptions:[8,9,10,11,12,13,14,15,16,17],is_editing:!1}),getters:{getIsEditing(e){return e.is_editing},getFormattedTimeIn(e){if(e.attendanceTimeOut===null)return null;const t=new Date(e.attendanceTimeIn);let a=t.getHours();const n=t.getMinutes(),m=a>=12?"PM":"AM";a=a%12,a=a||12;const c=n<10?"0"+n:n;return`${a}:${c} ${m}`},getFormattedTimeOut(e){if(e.attendanceTimeOut===null)return null;const t=new Date(e.attendanceTimeOut);let a=t.getHours();const n=t.getMinutes(),m=a>=12?"PM":"AM";a=a%12,a=a||12;const c=n<10?"0"+n:n;return`${a}:${c} ${m}`}},actions:{updateProxy(e){e==!0?this.attendanceTimeInProxy=this.attendanceTimeIn:this.attendanceTimeOutProxy=this.attendanceTimeOut},saveProxy(e){e==!0?this.attendanceTimeIn=this.attendanceTimeInProxy:this.attendanceTimeOut=this.attendanceTimeOutProxy},async fetchAttendanceTable(){const{data:e,error:t}=await O.from("attendance").select("*").eq("id");if(t)console.log(t);else return e},async fetchAttendanceType(){const{data:e,error:t}=await O.from("attendance_type").select("*");t?console.log(t):this.listOfAttendanceType=e},async fetchAdjustmentSalary(){const{data:e,error:t}=await O.from("adjustment_salary").select("*");t?console.log(t):this.listOfAdjustmentSalary=e},async updateAttendance(){const{error:e}=await O.from("attendance").update({date:this.attendanceDate,remarks:this.attendanceRemarks,time_in:this.attendanceTimeIn,time_out:this.attendanceTimeOut,employee_id:this.attendanceEmployeeID,attendance_type_id:this.attendanceType,adjustment_salary_id:this.attendanceAdjustmentSalaryID}).eq("id",this.attendanceID);e?Ve.showErrorNotification("Failed to update attendance"):(Rt.fetchAttendanceReports(),Ve.showSuccessNotification("Attendance updated successfully"),this.is_editing=!1)},resetForm(){this.attendanceID=null,this.attendanceDate=null,this.attendanceRemarks=null,this.attendanceTimeIn=null,this.attendanceTimeInProxy=null,this.attendanceTimeOut=null,this.attendanceTimeOutProxy=null,this.attendanceEmployeeID=null,this.attendanceType=null,this.attendanceAdjustmentSalaryID=null,this.is_editing=!1}}});function qt(e,t){if(e.hour!==null){if(e.minute===null)return"minute";if(t===!0&&e.second===null)return"second"}return"hour"}function $t(){const e=new Date;return{hour:e.getHours(),minute:e.getMinutes(),second:e.getSeconds(),millisecond:e.getMilliseconds()}}var Pe=dt({name:"QTime",props:{...At,...xt,...Re,modelValue:{required:!0,validator:e=>typeof e=="string"||e===null},mask:{...Re.mask,default:null},format24h:{type:Boolean,default:null},defaultDate:{type:String,validator:e=>/^-?[\d]+\/[0-1]\d\/[0-3]\d$/.test(e)},options:Function,hourOptions:Array,minuteOptions:Array,secondOptions:Array,withSeconds:Boolean,nowBtn:Boolean},emits:Et,setup(e,{slots:t,emit:a}){const n=ft(),{$q:m}=n.proxy,c=Tt(e,m),{tabindex:f,headerClass:i,getLocale:o,getCurrentDate:v}=Ht(e,m),d=Ct(e),s=It(d);let r,b;const w=N(null),C=k(()=>ze()),T=k(()=>o()),E=k(()=>Ge()),L=de(e.modelValue,C.value,T.value,e.calendar,E.value),S=N(qt(L)),g=N(L),M=N(L.hour===null||L.hour<12),xe=k(()=>`q-time q-time--${e.landscape===!0?"landscape":"portrait"}`+(c.value===!0?" q-time--dark q-dark":"")+(e.disable===!0?" disabled":e.readonly===!0?" q-time--readonly":"")+(e.bordered===!0?" q-time--bordered":"")+(e.square===!0?" q-time--square no-border-radius":"")+(e.flat===!0?" q-time--flat no-shadow":"")),G=k(()=>{const l=g.value;return{hour:l.hour===null?"--":F.value===!0?K(l.hour):String(M.value===!0?l.hour===0?12:l.hour:l.hour>12?l.hour-12:l.hour),minute:l.minute===null?"--":K(l.minute),second:l.second===null?"--":K(l.second)}}),F=k(()=>e.format24h!==null?e.format24h:m.lang.date.format24h),Qe=k(()=>{const l=S.value==="hour",u=l===!0?12:60,_=g.value[S.value];let H=`rotate(${Math.round(_*(360/u))-180}deg) translateX(-50%)`;return l===!0&&F.value===!0&&g.value.hour>=12&&(H+=" scale(.7)"),{transform:H}}),Ce=k(()=>g.value.hour!==null),Ye=k(()=>Ce.value===!0&&g.value.minute!==null),X=k(()=>e.hourOptions!==void 0?l=>e.hourOptions.includes(l):e.options!==void 0?l=>e.options(l,null,null):null),ne=k(()=>e.minuteOptions!==void 0?l=>e.minuteOptions.includes(l):e.options!==void 0?l=>e.options(g.value.hour,l,null):null),le=k(()=>e.secondOptions!==void 0?l=>e.secondOptions.includes(l):e.options!==void 0?l=>e.options(g.value.hour,g.value.minute,l):null),j=k(()=>{if(X.value===null)return null;const l=se(0,11,X.value),u=se(12,11,X.value);return{am:l,pm:u,values:l.values.concat(u.values)}}),J=k(()=>ne.value!==null?se(0,59,ne.value):null),Z=k(()=>le.value!==null?se(0,59,le.value):null),oe=k(()=>{switch(S.value){case"hour":return j.value;case"minute":return J.value;case"second":return Z.value}}),Ke=k(()=>{let l,u,_=0,x=1;const H=oe.value!==null?oe.value.values:void 0;S.value==="hour"?F.value===!0?(l=0,u=23):(l=0,u=11,M.value===!1&&(_=12)):(l=0,u=55,x=5);const U=[];for(let A=l,$=l;A<=u;A+=x,$++){const Q=A+_,it=H!==void 0&&H.includes(Q)===!1,ut=S.value==="hour"&&A===0?F.value===!0?"00":"12":A;U.push({val:Q,index:$,disable:it,label:ut})}return U}),We=k(()=>[[St,Xe,void 0,{stop:!0,prevent:!0,mouse:!0}]]);Oe(()=>e.modelValue,l=>{const u=de(l,C.value,T.value,e.calendar,E.value);(u.dateHash!==g.value.dateHash||u.timeHash!==g.value.timeHash)&&(g.value=u,u.hour===null?S.value="hour":M.value=u.hour<12)}),Oe([C,T],()=>{gt(()=>{Se()})});function Ie(){const l={...v(),...$t()};Se(l),Object.assign(g.value,l),S.value="hour"}function se(l,u,_){const x=Array.apply(null,{length:u+1}).map((H,U)=>{const A=U+l;return{index:A,val:_(A)===!0}}).filter(H=>H.val===!0).map(H=>H.index);return{min:x[0],max:x[x.length-1],values:x,threshold:u+1}}function Ee(l,u,_){const x=Math.abs(l-u);return Math.min(x,_-x)}function ve(l,{min:u,max:_,values:x,threshold:H}){if(l===u)return u;if(l<u||l>_)return Ee(l,u,H)<=Ee(l,_,H)?u:_;const U=x.findIndex(Q=>l<=Q),A=x[U-1],$=x[U];return l-A<=$-l?A:$}function ze(){return e.calendar!=="persian"&&e.mask!==null?e.mask:`HH:mm${e.withSeconds===!0?":ss":""}`}function Ge(){if(typeof e.defaultDate!="string"){const l=v(!0);return l.dateHash=Mt(l),l}return de(e.defaultDate,"YYYY/MM/DD",void 0,e.calendar)}function _e(){return yt(n)===!0||oe.value!==null&&(oe.value.values.length===0||S.value==="hour"&&F.value!==!0&&j.value[M.value===!0?"am":"pm"].values.length===0)}function be(){const l=w.value,{top:u,left:_,width:x}=l.getBoundingClientRect(),H=x/2;return{top:u+H,left:_+H,dist:H*.7}}function Xe(l){if(_e()!==!0){if(l.isFirst===!0){r=be(),b=re(l.evt,r);return}b=re(l.evt,r,b),l.isFinal===!0&&(r=!1,b=null,He())}}function He(){S.value==="hour"?S.value="minute":e.withSeconds&&S.value==="minute"&&(S.value="second")}function re(l,u,_){const x=ht(l),H=Math.abs(x.top-u.top),U=Math.sqrt(Math.pow(Math.abs(x.top-u.top),2)+Math.pow(Math.abs(x.left-u.left),2));let A,$=Math.asin(H/U)*(180/Math.PI);if(x.top<u.top?$=u.left<x.left?90-$:270+$:$=u.left<x.left?$+90:270-$,S.value==="hour"){if(A=$/30,j.value!==null){const Q=F.value!==!0?M.value===!0:j.value.am.values.length!==0&&j.value.pm.values.length!==0?U>=u.dist:j.value.am.values.length!==0;A=ve(A+(Q===!0?0:12),j.value[Q===!0?"am":"pm"])}else A=Math.round(A),F.value===!0?U<u.dist?A<12&&(A+=12):A===12&&(A=0):M.value===!0&&A===12?A=0:M.value===!1&&A!==12&&(A+=12);F.value===!0&&(M.value=A<12)}else A=Math.round($/6)%60,S.value==="minute"&&J.value!==null?A=ve(A,J.value):S.value==="second"&&Z.value!==null&&(A=ve(A,Z.value));return _!==A&&ot[S.value](A),A}const we={hour(){S.value="hour"},minute(){S.value="minute"},second(){S.value="second"}};function Je(l){l.keyCode===13&&Me()}function Ze(l){l.keyCode===13&&ke()}function et(l){_e()!==!0&&(m.platform.is.desktop!==!0&&re(l,be()),He())}function tt(l){_e()!==!0&&re(l,be())}function at(l){if(l.keyCode===13)S.value="hour";else if([37,39].includes(l.keyCode)){const u=l.keyCode===37?-1:1;if(j.value!==null){const _=F.value===!0?j.value.values:j.value[M.value===!0?"am":"pm"].values;if(_.length===0)return;if(g.value.hour===null)ie(_[0]);else{const x=(_.length+_.indexOf(g.value.hour)+u)%_.length;ie(_[x])}}else{const _=F.value===!0?24:12,x=F.value!==!0&&M.value===!1?12:0,H=g.value.hour===null?-u:g.value.hour;ie(x+(24+H+u)%_)}}}function nt(l){if(l.keyCode===13)S.value="minute";else if([37,39].includes(l.keyCode)){const u=l.keyCode===37?-1:1;if(J.value!==null){const _=J.value.values;if(_.length===0)return;if(g.value.minute===null)ue(_[0]);else{const x=(_.length+_.indexOf(g.value.minute)+u)%_.length;ue(_[x])}}else{const _=g.value.minute===null?-u:g.value.minute;ue((60+_+u)%60)}}}function lt(l){if(l.keyCode===13)S.value="second";else if([37,39].includes(l.keyCode)){const u=l.keyCode===37?-1:1;if(Z.value!==null){const _=Z.value.values;if(_.length===0)return;if(g.value.seconds===null)ce(_[0]);else{const x=(_.length+_.indexOf(g.value.second)+u)%_.length;ce(_[x])}}else{const _=g.value.second===null?-u:g.value.second;ce((60+_+u)%60)}}}function ie(l){g.value.hour!==l&&(g.value.hour=l,ee())}function ue(l){g.value.minute!==l&&(g.value.minute=l,ee())}function ce(l){g.value.second!==l&&(g.value.second=l,ee())}const ot={hour:ie,minute:ue,second:ce};function Me(){M.value===!1&&(M.value=!0,g.value.hour!==null&&(g.value.hour-=12,ee()))}function ke(){M.value===!0&&(M.value=!1,g.value.hour!==null&&(g.value.hour+=12,ee()))}function De(l){const u=e.modelValue;S.value!==l&&u!==void 0&&u!==null&&u!==""&&typeof u!="string"&&(S.value=l)}function ee(){if(X.value!==null&&X.value(g.value.hour)!==!0){g.value=de(),De("hour");return}if(ne.value!==null&&ne.value(g.value.minute)!==!0){g.value.minute=null,g.value.second=null,De("minute");return}if(e.withSeconds===!0&&le.value!==null&&le.value(g.value.second)!==!0){g.value.second=null,De("second");return}g.value.hour===null||g.value.minute===null||e.withSeconds===!0&&g.value.second===null||Se()}function Se(l){const u=Object.assign({...g.value},l),_=e.calendar==="persian"?K(u.hour)+":"+K(u.minute)+(e.withSeconds===!0?":"+K(u.second):""):kt(new Date(u.year,u.month===null?null:u.month-1,u.day,u.hour,u.minute,u.second,u.millisecond),C.value,T.value,u.year,u.timezoneOffset);u.changed=_!==e.modelValue,a("update:modelValue",_,u)}function st(){const l=[I("div",{class:"q-time__link "+(S.value==="hour"?"q-time__link--active":"cursor-pointer"),tabindex:f.value,onClick:we.hour,onKeyup:at},G.value.hour),I("div",":"),I("div",Ce.value===!0?{class:"q-time__link "+(S.value==="minute"?"q-time__link--active":"cursor-pointer"),tabindex:f.value,onKeyup:nt,onClick:we.minute}:{class:"q-time__link"},G.value.minute)];e.withSeconds===!0&&l.push(I("div",":"),I("div",Ye.value===!0?{class:"q-time__link "+(S.value==="second"?"q-time__link--active":"cursor-pointer"),tabindex:f.value,onKeyup:lt,onClick:we.second}:{class:"q-time__link"},G.value.second));const u=[I("div",{class:"q-time__header-label row items-center no-wrap",dir:"ltr"},l)];return F.value===!1&&u.push(I("div",{class:"q-time__header-ampm column items-between no-wrap"},[I("div",{class:"q-time__link "+(M.value===!0?"q-time__link--active":"cursor-pointer"),tabindex:f.value,onClick:Me,onKeyup:Je},"AM"),I("div",{class:"q-time__link "+(M.value!==!0?"q-time__link--active":"cursor-pointer"),tabindex:f.value,onClick:ke,onKeyup:Ze},"PM")])),I("div",{class:"q-time__header flex flex-center no-wrap "+i.value},u)}function rt(){const l=g.value[S.value];return I("div",{class:"q-time__content col relative-position"},[I(pt,{name:"q-transition--scale"},()=>I("div",{key:"clock"+S.value,class:"q-time__container-parent absolute-full"},[I("div",{ref:w,class:"q-time__container-child fit overflow-hidden"},[Y(I("div",{class:"q-time__clock cursor-pointer non-selectable",onClick:et,onMousedown:tt},[I("div",{class:"q-time__clock-circle fit"},[I("div",{class:"q-time__clock-pointer"+(g.value[S.value]===null?" hidden":e.color!==void 0?` text-${e.color}`:""),style:Qe.value}),Ke.value.map(u=>I("div",{class:`q-time__clock-position row flex-center q-time__clock-pos-${u.index}`+(u.val===l?" q-time__clock-position--active "+i.value:u.disable===!0?" q-time__clock-position--disable":"")},[I("span",u.label)]))])]),We.value)])])),e.nowBtn===!0?I(R,{class:"q-time__now-button absolute",icon:m.iconSet.datetime.now,unelevated:!0,size:"sm",round:!0,color:e.color,textColor:e.textColor,tabindex:f.value,onClick:Ie}):null])}return n.proxy.setNow=Ie,()=>{const l=[rt()],u=mt(t.default);return u!==void 0&&l.push(I("div",{class:"q-time__actions"},u)),e.name!==void 0&&e.disable!==!0&&s(l,"push"),I("div",{class:xe.value,tabindex:-1},[st(),I("div",{class:"q-time__main col overflow-auto"},l)])}}});const Vt={key:0,class:"!tw-h-min !tw-w-4/12 !tw-max-w-full tw-bg-white tw-p-6"},Pt={class:"tw-grid tw-gap-7"},Ft={class:"tw-text-3xl tw-font-extrabold tw-flex tw-justify-between"},Nt={class:"tw-flex tw-justify-between"},Lt={class:"row items-center justify-end q-gutter-sm"},Ut={class:"row items-center justify-end q-gutter-sm"},jt={key:1},Bt={__name:"ViewAttendance",props:["rows","column","columns","qBtnLabel","qBtnClass"],setup(e){const t=je(),a=N(!1),n=N(null),m=N(null),c=N(null);function f(d,s,r){m.value=i(r,s),n.value=d.row.attendance[m.value-1],a.value=!0,c.value=o(n),console.log(c.value),t.attendanceID=n.value.id,t.attendanceDate=n.value.date,t.attendanceRemarks=n.value.remarks,t.attendanceTimeIn=n.value.time_in,t.attendanceTimeOut=n.value.time_out,t.attendanceEmployeeID=n.value.employee_id,t.attendanceType=n.value.attendance_type_id,t.attendanceAdjustmentSalaryID=n.value.adjustment_salary_id}function i(d,s){return d.findIndex(r=>r.name===s.name&&r.align===s.align&&r.label===s.label&&r.sortable===s.sortable&&r.__iconClass===s.__iconClass&&r.__thClass===s.__thClass)}function o(d){const s=new Date;if(new Date(d.date)>=s)return"N/A";let b;const w=d.time_in?new Date(d.time_in):null,C=d.time_out?new Date(d.time_out):null;if(C===null&&w!==null)return"No Time Out";if(d.attendance_type_id!==1&&d.attendance_type_id!==void 0)return v(d.attendance_type.attendance_type_name);if(w){const T=new Date(w);T.setHours(8,0,0,0),w<T&&w.setHours(8,0,0,0)}if(C){const T=new Date(C);if(T.setHours(17,0,0,0),C>T&&C.setHours(17,0,0,0),w&&C){b=((C-w)/(1e3*60*60)).toFixed(2);const E=new Date(C);E.setHours(13,0,0,0),C>E&&(b=(parseFloat(b)-1).toFixed(2))}else b="No Time Out"}else b="No Time Out";return b}function v(d){return d.replace(/\b\w/g,s=>s.toUpperCase())}return(d,s)=>(B(),me(bt,null,[h(R,{unelevated:"",padding:"none",label:e.qBtnLabel,onClick:s[0]||(s[0]=r=>f(e.rows,e.column,e.columns)),class:vt(e.qBtnClass)},null,8,["label","class"]),h(wt,{modelValue:a.value,"onUpdate:modelValue":s[10]||(s[10]=r=>a.value=r),persistent:""},{default:y(()=>[n.value.id!=null&&n.value.attendance_type_id==1?(B(),me("div",Vt,[h(Ot,{onSubmit:s[9]||(s[9]=_t(r=>p(t).updateAttendance(),["prevent"]))},{default:y(()=>[D("div",Pt,[D("div",Ft,[D("div",null,"Attendance ID: "+V(n.value.id),1),D("div",null,V(e.column.label),1)]),D("div",null," Employee: "+V(n.value.employee.company_employee_id)+" - "+V(n.value.employee.last_name)+", "+V(n.value.employee.first_name),1),D("div",null,[q(" Remarks: "),h(ae,{rounded:"",standout:"bg-teal text-white",modelValue:p(t).attendanceRemarks,"onUpdate:modelValue":s[1]||(s[1]=r=>p(t).attendanceRemarks=r),type:"textarea",autogrow:"",disable:!p(t).is_editing},null,8,["modelValue","disable"])]),D("div",Nt,[D("div",null,[q(" Time In: "),h(R,{rounded:"",standout:"bg-teal text-white",icon:"access_time",label:p(t).getFormattedTimeIn,disable:!p(t).is_editing},{default:y(()=>[h(qe,{onBeforeShow:s[4]||(s[4]=r=>p(t).updateProxy(d.isTimeIn=!0)),cover:"","transition-show":"scale","transition-hide":"scale"},{default:y(()=>[h(Pe,{modelValue:p(t).attendanceTimeInProxy,"onUpdate:modelValue":s[3]||(s[3]=r=>p(t).attendanceTimeInProxy=r),mask:"YYYY-MM-DDTHH:mm:ss","hour-options":p(t).hourOptions},{default:y(()=>[D("div",Lt,[Y(h(R,{label:"Cancel",color:"primary",flat:""},null,512),[[W]]),Y(h(R,{label:"OK",color:"primary",flat:"",onClick:s[2]||(s[2]=r=>p(t).saveProxy(d.isTimeIn=!0))},null,512),[[W]])])]),_:1},8,["modelValue","hour-options"])]),_:1})]),_:1},8,["label","disable"])]),D("div",null,[q(" Time Out: "),h(R,{rounded:"",standout:"bg-teal text-white",icon:"access_time",label:p(t).getFormattedTimeOut,disable:!p(t).is_editing},{default:y(()=>[h(qe,{onBeforeShow:s[7]||(s[7]=r=>p(t).updateProxy(d.isTimeIn=!1)),cover:"","transition-show":"scale","transition-hide":"scale"},{default:y(()=>[h(Pe,{modelValue:p(t).attendanceTimeOutProxy,"onUpdate:modelValue":s[6]||(s[6]=r=>p(t).attendanceTimeOutProxy=r),mask:"YYYY-MM-DDTHH:mm:ss","hour-options":p(t).hourOptions},{default:y(()=>[D("div",Ut,[Y(h(R,{label:"Cancel",color:"primary",flat:""},null,512),[[W]]),Y(h(R,{label:"OK",color:"primary",flat:"",onClick:s[5]||(s[5]=r=>p(t).saveProxy(d.isTimeIn=!1))},null,512),[[W]])])]),_:1},8,["modelValue","hour-options"])]),_:1})]),_:1},8,["label","disable"])])])]),h($e,{align:"right",class:"text-primary noPrint"},{default:y(()=>[p(t).is_editing==!1?(B(),z(R,{key:0,flat:"",class:"tw-bg-green-400",icon:p(t).is_editing?"save":"edit",label:p(t).is_editing?"Save":"Edit",onClick:s[8]||(s[8]=r=>p(t).is_editing=!0)},null,8,["icon","label"])):(B(),z(R,{key:1,flat:"",type:"submit",class:"tw-bg-green-400",icon:p(t).is_editing?"save":"edit",label:p(t).is_editing?"Save":"Edit"},null,8,["icon","label"])),Y(h(R,{flat:"",label:"CLOSE",onClick:p(t).resetForm},null,8,["onClick"]),[[W]])]),_:1})]),_:1})])):(B(),me("div",jt,[q(V(n.value)+" ",1),h($e,{align:"right",class:"text-primary noPrint"},{default:y(()=>[Y(h(R,{flat:"",label:"Cancel"},null,512),[[W]])]),_:1})]))]),_:1},8,["modelValue"])],64))}},Qt=D("div",{class:"tw-text-xl, tw-font-bold"},"Attendance Report",-1),Yt=D("div",{class:"tw-w-3"},null,-1),Kt=D("div",{class:"tw-flex tw-items-center tw-ml-5"},[D("div",{class:"tw-flex tw-items-center tw-mr-3"},[D("div",{class:"tw-rounded-lg tw-w-3 tw-h-6 !tw-bg-[#4ade80]"}),D("div",{class:"tw-ml-2"},"Present")]),D("div",{class:"tw-flex tw-items-center tw-mr-3"},[D("div",{class:"tw-rounded-lg tw-w-3 tw-h-6 !tw-bg-[#f87171]"}),D("div",{class:"tw-ml-2"},"Absent")]),D("div",{class:"tw-flex tw-items-center tw-mr-3"},[D("div",{class:"tw-rounded-lg tw-w-3 tw-h-6 !tw-bg-[#fb923c]"}),D("div",{class:"tw-ml-2"},"Late")]),D("div",{class:"tw-flex tw-items-center tw-mr-3"},[D("div",{class:"tw-rounded-lg tw-w-3 tw-h-6 !tw-bg-[#ec4899]"}),D("div",{class:"tw-ml-2"},"Undertime")]),D("div",{class:"tw-flex tw-items-center tw-mr-3"},[D("div",{class:"tw-rounded-lg tw-w-3 tw-h-6 !tw-bg-[#3b82f6]"}),D("div",{class:"tw-ml-2"},"Leave")]),D("div",{class:"tw-flex tw-items-center tw-mr-3"},[D("div",{class:"tw-rounded-lg tw-w-3 tw-h-6 !tw-bg-[#fef08a]"}),D("div",{class:"tw-ml-2"},"Holiday")])],-1),Wt={__name:"AttendanceTable",setup(e){je().fetchAttendanceType();const a=Ue(),n=N("");function m(d){const s=new Date(d),r={year:"numeric",month:"short",day:"numeric"};return s.toLocaleDateString("en-US",r)}function c(d){const s=document.getElementById(d);let r="";r+=Array.from(s.querySelectorAll("th")).map(M=>M.innerText.replace(/arrow_upward/g,"")).join(",")+`
`,Array.from(s.querySelectorAll("tr")).slice(1).forEach(M=>{r+=Array.from(M.querySelectorAll("td")).map(G=>G.innerText).join(",")+`
`});const C=new Date,T={month:"short",day:"2-digit",year:"numeric"},E=C.toLocaleDateString("en-US",T).replace(",","").replace(/\s+/g,"-"),L=new Blob([r],{type:"text/csv;charset=utf-8;"}),S=URL.createObjectURL(L),g=document.createElement("a");g.setAttribute("href",S),g.setAttribute("download",`Attendance-Report-${E}.csv`),document.body.appendChild(g),g.click(),document.body.removeChild(g),URL.revokeObjectURL(S)}a.fetchAttendanceReports();function f(d,s){return d.findIndex(r=>r.name===s.name&&r.align===s.align&&r.label===s.label&&r.sortable===s.sortable&&r.__iconClass===s.__iconClass&&r.__thClass===s.__thClass)}function i(d,s,r){const b=f(d,s),w=r.row.attendance[b-1];return w.attendance_type_id===2?"LEAVE":o(w)}function o(d){if(d.attendance_type==null)return 0;if(d.attendance_type.id!==1)return 8;let s=new Date(d.time_in);s.setMilliseconds(0);let r=new Date(d.time_out);r.setMilliseconds(0);const b=new Date(s);b.setHours(8,0,0),s<b&&s.setHours(8,0,0);const w=new Date(r);w.setHours(17,0,0),r>w&&r.setHours(17,0,0);let C=(r-s)/(1e3*60);const T=new Date(r);T.setHours(13,0,0);const E=new Date(r);E.setHours(12,0,0),r>T&&s<E&&(C-=60);const L=Math.floor(C/60)+C%60/60;return v(L)}function v(d){const s=Math.floor(d),r=Math.floor((d-s)*60);return s+"."+r}return(d,s)=>(B(),z(ye,{id:"attendance-table",class:"tw-border tw-rounded-3xl tw-shadow-lg",flat:"",bordered:"",dense:"",title:"Attendance Report","title-class":["tw-text-xl","tw-font-bold"],filter:n.value,columns:p(a).attendanceColumns.columns,rows:p(a).rows,"rows-per-page-options":[0],separator:"cell","row-key":"name"},{"top-right":y(()=>[h(R,{color:"blue","icon-right":"archive",label:"Export to CSV","no-caps":"",onClick:s[0]||(s[0]=r=>c("attendance-table")),class:"tw-mr-16"}),h(ae,{borderless:"",dense:"",debounce:"300",modelValue:n.value,"onUpdate:modelValue":s[1]||(s[1]=r=>n.value=r),placeholder:"Search"},{append:y(()=>[h(fe,{name:"search"})]),_:1},8,["modelValue"])]),"body-cell-actions":y(r=>[h(P,{key:"actions",class:"!tw-w-20 !tw-p-0",props:r},{default:y(()=>[h(Bt,{rows:r,columns:r.cols,qBtnLabel:i(r.cols,r.col,r),column:r.col},null,8,["rows","columns","qBtnLabel","column"])]),_:2},1032,["props"])]),"top-left":y(()=>[Qt,Yt,h(ge,{rounded:"",standout:"",modelValue:p(a).selectedDate,"onUpdate:modelValue":[s[2]||(s[2]=r=>p(a).selectedDate=r),s[3]||(s[3]=r=>p(a).fetchAttendanceReports())],"use-input":"","hide-selected":"","fill-input":"","hide-bottom-space":"","input-debounce":"0",options:p(a).selectedDateOptions,"option-label":r=>m(r.date_start)+" - "+m(r.date_end),class:"!tw-pb-0"},{"no-option":y(()=>[h(he,null,{default:y(()=>[h(pe,{class:"text-grey"},{default:y(()=>[q(" No results ")]),_:1})]),_:1})]),_:1},8,["modelValue","options","option-label"])]),bottom:y(()=>[Kt]),_:1},8,["filter","columns","rows"]))}};function Fe(e){return e.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}const zt=te("philhealthTable",{state:()=>({rows:[],columns:[{name:"employeeId",required:!0,label:"Emp. Id",field:e=>e.employee.company_employee_id,align:"left",sortable:!0},{name:"employeeName",align:"center",label:"Name",field:e=>e.employee.last_name+" "+e.employee.first_name+" "+e.employee.middle_name,sortable:!0,classes:"!tw-bg-neutral-300"},{name:"philhealthNumber",align:"center",label:"PhilHealth No.",field:e=>e.employee.phil_health_number,sortable:!0,classes:"!tw-bg-neutral-300"},{name:"employeeShare",align:"center",label:"Employee Share",field:e=>Fe(e.amount),sortable:!0,classes:"!tw-bg-neutral-300"},{name:"employerShare",align:"center",label:"Employer Share",field:e=>Fe(e.amount),sortable:!0,classes:"!tw-bg-neutral-300"}],selectedDate:null,selectedDateOptions:null,employeeIds:[],philhealthAudit:[],philhealthContributionTableAudit:[]}),getters:{getSelectedDate(){return this.selectedDate},getTotalEmployeeShare(){let e=0;return this.philhealthAudit.forEach(t=>{e+=t.amount}),e}},actions:{capitalizeFirstLetterOfEachWord(e){return e.split(" ").map(t=>t.charAt(0).toUpperCase()+t.slice(1)).join(" ")},formatDate(e){const t=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0"),n=String(e.getDate()).padStart(2,"0");return`${t}-${a}-${n}`},getEmployeeIds(e){return e.map(t=>t.employee_id)},getAndCheckDateRangesForCurrentMonth(){const e=new Date,t=e.getFullYear(),a=e.getMonth(),n=new Date(t,a,1),m=new Date(t,a,15),c=new Date(t,a,16),f=new Date(t,a+1,0),i={firstHalf:{start:this.formatDate(n),end:this.formatDate(m)},secondHalf:{start:this.formatDate(c),end:this.formatDate(f)}},o=this.formatDate(e),v=new Date(i.firstHalf.start),d=new Date(i.firstHalf.end),s=new Date(i.secondHalf.start),r=new Date(i.secondHalf.end);let b,w;return e>=v&&e<=d?(b=this.formatDate(v),w=this.formatDate(d)):e>=s&&e<=r?(b=this.formatDate(s),w=this.formatDate(r)):(b="out of range",w="out of range"),{todayDate:o,startDate:b,endDate:w}},async getSalaryHistory(){try{const{data:e,error:t}=await O.from("salary_history").select();t&&console.error(t),this.selectedDateOptions=e.sort((a,n)=>new Date(a.date_start)-new Date(n.date_start))}catch(e){console.error(e)}},filterHighestAuditId(e){const t=e.reduce((a,n)=>{const{employee_id:m,audit_id:c}=n;return(!a[m]||a[m].audit_id<c)&&(a[m]=n),a},{});return Object.values(t)},getHighestAuditId(e){return e.length===0?null:e.reduce((a,n)=>n.audit_id>a.audit_id?n:a)},async fetchEmployeeInRange(e=this.selectedDate.date_end){try{const{data:t,error:a}=await O.from("employee_audit").select("*").lte("change_date",e).eq("is_archive",!1);a&&console.error(a),this.rows=this.filterHighestAuditId(t),this.employeeIds=this.getEmployeeIds(this.rows)}catch(t){console.error(t)}},async fetchPhilhealthContribAudit(e=this.selectedDate.date_end){try{const{data:t,error:a}=await O.from("emp_philhealth_contrib_audit").select("*, employee!emp_philhealth_contrib_audit_employee_id_fkey(last_name, first_name, middle_name, company_employee_id, phil_health_number, is_archive)").lte("change_date",e).eq("employee.is_archive",!1).in("employee_id",this.employeeIds);a&&console.error(a),this.philhealthAudit=this.filterHighestAuditId(t.filter(n=>n.employee!==null))}catch(t){console.error(t)}},async fetchPhilhealthContributionTableAudit(e=this.selectedDate.date_end){try{const{data:t,error:a}=await O.from("philhealth_contribution_table_audit").select("*").lte("change_date",e);a&&console.error(a),this.philhealthContributionTableAudit=this.getHighestAuditId(t)}catch(t){console.error(t)}},getNearestDateRange(){if(this.selectedDate!=null)return;const e=new Date;function t(c){return new Date(c)}function a(c){return Math.abs(e-c)}let n=null,m=1/0;for(const c of this.selectedDateOptions){const f=t(c.date_start),i=t(c.date_end),o=a(f),v=a(i),d=Math.min(o,v);d<m&&(m=d,n=c)}this.selectedDate=n},async fetchEmployeeReports(){await this.getSalaryHistory(),await this.getNearestDateRange(),await this.fetchEmployeeInRange(),await this.fetchPhilhealthContribAudit(),await this.fetchPhilhealthContributionTableAudit()}}}),Gt=D("div",{class:"tw-text-xl, tw-font-bold"},"PhilHealth Report",-1),Xt=D("div",{class:"tw-w-3"},null,-1),Jt={__name:"PhilhealthTable",setup(e){const t=zt(),a=N("");function n(f){return f.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}function m(f){const i=new Date(f),o={year:"numeric",month:"short",day:"numeric"};return i.toLocaleDateString("en-US",o)}function c(f){const i=document.getElementById(f);let o="";o+=Array.from(i.querySelectorAll("th")).map(E=>E.innerText.replace(/arrow_upward/g,"")).join(",")+`
`,Array.from(i.querySelectorAll("tr")).slice(1).forEach(E=>{o+=Array.from(E.querySelectorAll("td")).map(S=>S.innerText).join(",")+`
`});const s=new Date,r={month:"short",day:"2-digit",year:"numeric"},b=s.toLocaleDateString("en-US",r).replace(",","").replace(/\s+/g,"-"),w=new Blob([o],{type:"text/csv;charset=utf-8;"}),C=URL.createObjectURL(w),T=document.createElement("a");T.setAttribute("href",C),T.setAttribute("download",`Philhealth-Report-${b}.csv`),document.body.appendChild(T),T.click(),document.body.removeChild(T),URL.revokeObjectURL(C)}return t.fetchEmployeeReports(),(f,i)=>(B(),z(ye,{id:"philhealth-table",class:"tw-border tw-rounded-3xl tw-shadow-lg",flat:"",bordered:"",dense:"",title:"Attendance Report","title-class":["tw-text-xl","tw-font-bold"],filter:a.value,columns:p(t).columns,rows:p(t).philhealthAudit,"rows-per-page-options":[0],separator:"cell","row-key":"name"},{"top-right":y(()=>[h(R,{color:"blue","icon-right":"archive",label:"Export to CSV","no-caps":"",onClick:i[0]||(i[0]=o=>c("philhealth-table")),class:"tw-mr-16"}),h(ae,{borderless:"",dense:"",debounce:"300",modelValue:a.value,"onUpdate:modelValue":i[1]||(i[1]=o=>a.value=o),placeholder:"Search"},{append:y(()=>[h(fe,{name:"search"})]),_:1},8,["modelValue"])]),"top-left":y(()=>[Gt,Xt,h(ge,{rounded:"",standout:"",modelValue:p(t).selectedDate,"onUpdate:modelValue":[i[2]||(i[2]=o=>p(t).selectedDate=o),i[3]||(i[3]=o=>p(t).fetchEmployeeReports())],"use-input":"","hide-selected":"","fill-input":"","hide-bottom-space":"","input-debounce":"0",options:p(t).selectedDateOptions,"option-label":o=>m(o.date_start)+" - "+m(o.date_end),class:"!tw-pb-0"},{"no-option":y(()=>[h(he,null,{default:y(()=>[h(pe,{class:"text-grey"},{default:y(()=>[q(" No results ")]),_:1})]),_:1})]),_:1},8,["modelValue","options","option-label"])]),"bottom-row":y(()=>[h(Te,null,{default:y(()=>[h(P,{colspan:"3"}),h(P,{class:"tw-text-center"},{default:y(()=>[q(" Total Employee Share: "+V(n(p(t).getTotalEmployeeShare)),1)]),_:1}),h(P,{class:"tw-text-center"},{default:y(()=>[q(" Total Employer Share: "+V(n(p(t).getTotalEmployeeShare)),1)]),_:1})]),_:1})]),bottom:y(()=>[]),_:1},8,["filter","columns","rows"]))}};function Be(e){var t=e.toString().match(/^-?\d+(?:\.\d{0,2})?/)[0];return parseFloat(t)}function Ne(e){return e.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}function Zt(e,t=30){return Be(e*t)}function Le(e){const t=Zt(e);let a,n;return t<=1500?(a=.01,n=Math.min(t,1e4)*a):(a=.02,n=Math.min(t,1e4)*a),Be(n)}const ea=te("pagibigTable",{state:()=>({rows:[],columns:[{name:"employeeId",required:!0,label:"Emp. Id",field:e=>e.employee.company_employee_id,align:"left",sortable:!0},{name:"employeeName",align:"center",label:"Name",field:e=>e.employee.last_name+" "+e.employee.first_name+" "+e.employee.middle_name,sortable:!0,classes:"!tw-bg-neutral-300"},{name:"pagibigNumber",align:"center",label:"Pagibig No.",field:e=>e.employee.pag_ibig_number,sortable:!0,classes:"!tw-bg-neutral-300"},{name:"employeeShare",align:"center",label:"Employee Share",field:e=>Ne(e.amount),sortable:!0,classes:"!tw-bg-neutral-300"},{name:"employerShare",align:"center",label:"Employer Share",field:e=>Ne(Le(e.employee.rate_per_day)),sortable:!0,classes:"!tw-bg-neutral-300"}],selectedDate:null,selectedDateOptions:null,employeeIds:[],pagibigAudit:[],pagibigContributionTableAudit:[]}),getters:{getSelectedDate(){return this.selectedDate},getTotalEmployerShare(){let e=0;return this.pagibigAudit.forEach(t=>{e+=Le(t.amount)}),e},getTotalEmployeeShare(){let e=0;return this.pagibigAudit.forEach(t=>{e+=t.amount}),e}},actions:{capitalizeFirstLetterOfEachWord(e){return e.split(" ").map(t=>t.charAt(0).toUpperCase()+t.slice(1)).join(" ")},formatDate(e){const t=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0"),n=String(e.getDate()).padStart(2,"0");return`${t}-${a}-${n}`},getEmployeeIds(e){return e.map(t=>t.employee_id)},getAndCheckDateRangesForCurrentMonth(){const e=new Date,t=e.getFullYear(),a=e.getMonth(),n=new Date(t,a,1),m=new Date(t,a,15),c=new Date(t,a,16),f=new Date(t,a+1,0),i={firstHalf:{start:this.formatDate(n),end:this.formatDate(m)},secondHalf:{start:this.formatDate(c),end:this.formatDate(f)}},o=this.formatDate(e),v=new Date(i.firstHalf.start),d=new Date(i.firstHalf.end),s=new Date(i.secondHalf.start),r=new Date(i.secondHalf.end);let b,w;return e>=v&&e<=d?(b=this.formatDate(v),w=this.formatDate(d)):e>=s&&e<=r?(b=this.formatDate(s),w=this.formatDate(r)):(b="out of range",w="out of range"),{todayDate:o,startDate:b,endDate:w}},async getSalaryHistory(){try{const{data:e,error:t}=await O.from("salary_history").select();t&&console.error(t),this.selectedDateOptions=e.sort((a,n)=>new Date(a.date_start)-new Date(n.date_start))}catch(e){console.error(e)}},filterHighestAuditId(e){const t=e.reduce((a,n)=>{const{employee_id:m,audit_id:c}=n;return(!a[m]||a[m].audit_id<c)&&(a[m]=n),a},{});return Object.values(t)},getHighestAuditId(e){return e.length===0?null:e.reduce((a,n)=>n.audit_id>a.audit_id?n:a)},async fetchEmployeeInRange(e=this.selectedDate.date_end){try{const{data:t,error:a}=await O.from("employee_audit").select("*").lte("change_date",e).eq("is_archive",!1);a&&console.error(a),this.rows=this.filterHighestAuditId(t),this.employeeIds=this.getEmployeeIds(this.rows)}catch(t){console.error(t)}},async fetchPagibigContribAudit(e=this.selectedDate.date_end){try{const{data:t,error:a}=await O.from("emp_pagibig_contrib_audit").select("*, employee!emp_pagibig_contrib_audit_employee_id_fkey(last_name, first_name, middle_name, company_employee_id, pag_ibig_number, rate_per_day, is_archive)").lte("change_date",e).eq("employee.is_archive",!1).in("employee_id",this.employeeIds);a&&console.error(a),this.pagibigAudit=this.filterHighestAuditId(t.filter(n=>n.employee!==null)),console.log(t)}catch(t){console.error(t)}},async fetchPagibigContributionTableAudit(e=this.selectedDate.date_end){try{const{data:t,error:a}=await O.from("pagibig_contribution_table_audit").select("*").lte("change_date",e);a&&console.error(a),this.pagibigContributionTableAudit=this.getHighestAuditId(t)}catch(t){console.error(t)}},getNearestDateRange(){if(this.selectedDate!=null)return;const e=new Date;function t(c){return new Date(c)}function a(c){return Math.abs(e-c)}let n=null,m=1/0;for(const c of this.selectedDateOptions){const f=t(c.date_start),i=t(c.date_end),o=a(f),v=a(i),d=Math.min(o,v);d<m&&(m=d,n=c)}this.selectedDate=n},async fetchEmployeeReports(){await this.getSalaryHistory(),await this.getNearestDateRange(),await this.fetchEmployeeInRange(),await this.fetchPagibigContribAudit(),await this.fetchPagibigContributionTableAudit()}}}),ta=D("div",{class:"tw-text-xl, tw-font-bold"},"Pag-IBIG Report",-1),aa=D("div",{class:"tw-w-3"},null,-1),na={__name:"PagibigTable",setup(e){function t(f){return f.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}function a(f){const i=new Date(f),o={year:"numeric",month:"short",day:"numeric"};return i.toLocaleDateString("en-US",o)}const n=ea(),m=N("");function c(f){const i=document.getElementById(f);let o="";o+=Array.from(i.querySelectorAll("th")).map(E=>E.innerText.replace(/arrow_upward/g,"")).join(",")+`
`,Array.from(i.querySelectorAll("tr")).slice(1).forEach(E=>{o+=Array.from(E.querySelectorAll("td")).map(S=>S.innerText).join(",")+`
`});const s=new Date,r={month:"short",day:"2-digit",year:"numeric"},b=s.toLocaleDateString("en-US",r).replace(",","").replace(/\s+/g,"-"),w=new Blob([o],{type:"text/csv;charset=utf-8;"}),C=URL.createObjectURL(w),T=document.createElement("a");T.setAttribute("href",C),T.setAttribute("download",`Pag-IBIG-Report-${b}.csv`),document.body.appendChild(T),T.click(),document.body.removeChild(T),URL.revokeObjectURL(C)}return n.fetchEmployeeReports(),(f,i)=>(B(),z(ye,{id:"pagibig-table",class:"tw-border tw-rounded-3xl tw-shadow-lg",flat:"",bordered:"",dense:"",title:"Attendance Report","title-class":["tw-text-xl","tw-font-bold"],filter:m.value,columns:p(n).columns,rows:p(n).pagibigAudit,"rows-per-page-options":[0],separator:"cell","row-key":"name"},{"top-right":y(()=>[h(R,{color:"blue","icon-right":"archive",label:"Export to CSV","no-caps":"",onClick:i[0]||(i[0]=o=>c("pagibig-table")),class:"tw-mr-16"}),h(ae,{borderless:"",dense:"",debounce:"300",modelValue:m.value,"onUpdate:modelValue":i[1]||(i[1]=o=>m.value=o),placeholder:"Search"},{append:y(()=>[h(fe,{name:"search"})]),_:1},8,["modelValue"])]),"top-left":y(()=>[ta,aa,h(ge,{rounded:"",standout:"",modelValue:p(n).selectedDate,"onUpdate:modelValue":[i[2]||(i[2]=o=>p(n).selectedDate=o),i[3]||(i[3]=o=>p(n).fetchEmployeeReports())],"use-input":"","hide-selected":"","fill-input":"","hide-bottom-space":"","input-debounce":"0",options:p(n).selectedDateOptions,"option-label":o=>a(o.date_start)+" - "+a(o.date_end),class:"!tw-pb-0"},{"no-option":y(()=>[h(he,null,{default:y(()=>[h(pe,{class:"text-grey"},{default:y(()=>[q(" No results ")]),_:1})]),_:1})]),_:1},8,["modelValue","options","option-label"])]),"bottom-row":y(()=>[h(Te,null,{default:y(()=>[h(P,{colspan:"3"}),h(P,{class:"tw-text-center"},{default:y(()=>[q(" Total Employee Share: "+V(t(p(n).getTotalEmployeeShare)),1)]),_:1}),h(P,{class:"tw-text-center"},{default:y(()=>[q(" Total Employer Share: "+V(t(p(n).getTotalEmployerShare)),1)]),_:1})]),_:1})]),bottom:y(()=>[]),_:1},8,["filter","columns","rows"]))}};function Ae(e){return e.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}const la=te("sssTable",{state:()=>({rows:[],columns:[],selectedDate:null,selectedDateOptions:null,employeeIds:[],sssAudit:[],sssContributionTableAudit:[]}),getters:{getSelectedDate(){return this.selectedDate},getTotalEmployeeShare(){let e=0;return this.sssAudit.forEach(t=>{e+=t.amount}),e},getTotalEmployerShare(){let e=0;return this.sssAudit.forEach(t=>{e+=typeof this.getEmployerShare(t.amount)=="number"?this.getEmployerShare(t.amount):0}),e},getTotalECEmployerShare(){let e=0;return this.sssAudit.forEach(t=>{e+=typeof this.getECER(t.amount)=="number"?this.getECER(t.amount):0}),e}},actions:{setColumns(){this.columns=[{name:"employeeId",required:!0,label:"Emp. Id",field:e=>e.employee.company_employee_id,align:"left",sortable:!0},{name:"employeeName",align:"center",label:"Name",field:e=>e.employee.last_name+" "+e.employee.first_name+" "+e.employee.middle_name,sortable:!0,classes:"!tw-bg-neutral-300"},{name:"sssNumber",align:"center",label:"SSS No.",field:e=>e.employee.sss_number,sortable:!0,classes:"!tw-bg-neutral-300"},{name:"employeeShare",align:"center",label:"Employee Share",field:e=>Ae(e.amount),sortable:!0,classes:"!tw-bg-neutral-300"},{name:"employerShare",align:"center",label:"Employer Share",field:e=>Ae(this.getEmployerShare(e.amount)),sortable:!0,classes:"!tw-bg-neutral-300"},{name:"ecEmployerShare",align:"center",label:"EC Employer Share",field:e=>Ae(this.getECER(e.amount)),sortable:!0,classes:"!tw-bg-neutral-300"}]},getEmployerShare(e){console.log(e,this.sssContributionTableAudit);for(const t of this.sssContributionTableAudit)if(e==t.ee_share)return t.er_share;return"Out of range"},getECER(e){for(const t of this.sssContributionTableAudit)if(e==t.ee_share)return t.ec_er_share;return"Out of range"},capitalizeFirstLetterOfEachWord(e){return e.split(" ").map(t=>t.charAt(0).toUpperCase()+t.slice(1)).join(" ")},formatDate(e){const t=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0"),n=String(e.getDate()).padStart(2,"0");return`${t}-${a}-${n}`},getEmployeeIds(e){return e.map(t=>t.employee_id)},getAndCheckDateRangesForCurrentMonth(){const e=new Date,t=e.getFullYear(),a=e.getMonth(),n=new Date(t,a,1),m=new Date(t,a,15),c=new Date(t,a,16),f=new Date(t,a+1,0),i={firstHalf:{start:this.formatDate(n),end:this.formatDate(m)},secondHalf:{start:this.formatDate(c),end:this.formatDate(f)}},o=this.formatDate(e),v=new Date(i.firstHalf.start),d=new Date(i.firstHalf.end),s=new Date(i.secondHalf.start),r=new Date(i.secondHalf.end);let b,w;return e>=v&&e<=d?(b=this.formatDate(v),w=this.formatDate(d)):e>=s&&e<=r?(b=this.formatDate(s),w=this.formatDate(r)):(b="out of range",w="out of range"),{todayDate:o,startDate:b,endDate:w}},async getSalaryHistory(){try{const{data:e,error:t}=await O.from("salary_history").select();t&&console.error(t),this.selectedDateOptions=e.sort((a,n)=>new Date(a.date_start)-new Date(n.date_start))}catch(e){console.error(e)}},filterHighestAuditId(e){const t=e.reduce((a,n)=>{const{employee_id:m,audit_id:c}=n;return(!a[m]||a[m].audit_id<c)&&(a[m]=n),a},{});return Object.values(t)},getHighestAuditId(e){return e.length===0?null:e.reduce((a,n)=>n.audit_id>a.audit_id?n:a)},async fetchEmployeeInRange(e=this.selectedDate.date_end){try{const{data:t,error:a}=await O.from("employee_audit").select("*").lte("change_date",e).eq("is_archive",!1);a&&console.error(a),this.rows=this.filterHighestAuditId(t),this.employeeIds=this.getEmployeeIds(this.rows)}catch(t){console.error(t)}},async fetchSssContribAudit(e=this.selectedDate.date_end){try{const{data:t,error:a}=await O.from("emp_sss_contrib_audit").select("*, employee!emp_sss_contrib_audit_employee_id_fkey(last_name, first_name, middle_name, company_employee_id, sss_number, is_archive)").lte("change_date",e).eq("employee.is_archive",!1).in("employee_id",this.employeeIds);a&&console.error(a),this.sssAudit=this.filterHighestAuditId(t.filter(n=>n.employee!==null))}catch(t){console.error(t)}},async fetchSssContributionTableAudit(e=this.selectedDate.date_end){try{const{data:t,error:a}=await O.from("sss_contribution_table_audit").select("*").lte("change_date",e);a&&console.error(a),this.sssContributionTableAudit=this.getHighestAuditId(t),this.sssContributionTableAudit=this.sssContributionTableAudit.data.map(n=>{const m=n.combinedValue;let c,f,i,o,v;if(i=parseFloat(n.values[4].replace(",","")),o=parseFloat(n.values[3].replace(",","")),v=parseFloat(n.values[6].replace(",","")),m.startsWith("Below"))c=0,f=parseFloat(m.split(" ")[1].replace(",",""));else if(m.includes("Over"))c=parseFloat(m.split(" ")[0].replace(",","")),f=null;else{const[d,s]=m.split(" - ");c=parseFloat(d.replace(",","")),f=parseFloat(s.replace(",",""))}return{min:c,max:f,ee_share:i,er_share:o,ec_er_share:v}}),this.setColumns()}catch(t){console.error(t)}},getNearestDateRange(){if(this.selectedDate!=null)return;const e=new Date;function t(c){return new Date(c)}function a(c){return Math.abs(e-c)}let n=null,m=1/0;for(const c of this.selectedDateOptions){const f=t(c.date_start),i=t(c.date_end),o=a(f),v=a(i),d=Math.min(o,v);d<m&&(m=d,n=c)}this.selectedDate=n},async fetchEmployeeReports(){await this.getSalaryHistory(),await this.getNearestDateRange(),await this.fetchSssContributionTableAudit(),await this.fetchEmployeeInRange(),await this.fetchSssContribAudit()}}}),oa=D("div",{class:"tw-text-xl, tw-font-bold"},"SSS Report",-1),sa=D("div",{class:"tw-w-3"},null,-1),ra={__name:"SssTable",setup(e){function t(f){return typeof f!="number"||isNaN(f)?f:f.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}const a=la();function n(f){const i=new Date(f),o={year:"numeric",month:"short",day:"numeric"};return i.toLocaleDateString("en-US",o)}const m=N("");function c(f){const i=document.getElementById(f);let o="";o+=Array.from(i.querySelectorAll("th")).map(E=>E.innerText.replace(/arrow_upward/g,"")).join(",")+`
`,Array.from(i.querySelectorAll("tr")).slice(1).forEach(E=>{o+=Array.from(E.querySelectorAll("td")).map(S=>S.innerText).join(",")+`
`});const s=new Date,r={month:"short",day:"2-digit",year:"numeric"},b=s.toLocaleDateString("en-US",r).replace(",","").replace(/\s+/g,"-"),w=new Blob([o],{type:"text/csv;charset=utf-8;"}),C=URL.createObjectURL(w),T=document.createElement("a");T.setAttribute("href",C),T.setAttribute("download",`SSS-Report-${b}.csv`),document.body.appendChild(T),T.click(),document.body.removeChild(T),URL.revokeObjectURL(C)}return a.fetchEmployeeReports(),(f,i)=>(B(),z(ye,{id:"sss-table",class:"tw-border tw-rounded-3xl tw-shadow-lg",flat:"",bordered:"",dense:"",title:"Attendance Report",filter:m.value,columns:p(a).columns,rows:p(a).sssAudit,"rows-per-page-options":[0],separator:"cell","row-key":"name"},{"top-right":y(()=>[h(R,{color:"blue","icon-right":"archive",label:"Export to CSV","no-caps":"",onClick:i[0]||(i[0]=o=>c("sss-table")),class:"tw-mr-16"}),h(ae,{borderless:"",dense:"",debounce:"300",modelValue:m.value,"onUpdate:modelValue":i[1]||(i[1]=o=>m.value=o),placeholder:"Search"},{append:y(()=>[h(fe,{name:"search"})]),_:1},8,["modelValue"])]),"top-left":y(()=>[oa,sa,h(ge,{rounded:"",standout:"",modelValue:p(a).selectedDate,"onUpdate:modelValue":[i[2]||(i[2]=o=>p(a).selectedDate=o),i[3]||(i[3]=o=>p(a).fetchEmployeeReports())],"use-input":"","hide-selected":"","fill-input":"","hide-bottom-space":"","input-debounce":"0",options:p(a).selectedDateOptions,"option-label":o=>n(o.date_start)+" - "+n(o.date_end),class:"!tw-pb-0"},{"no-option":y(()=>[h(he,null,{default:y(()=>[h(pe,{class:"text-grey"},{default:y(()=>[q(" No results ")]),_:1})]),_:1})]),_:1},8,["modelValue","options","option-label"])]),"bottom-row":y(()=>[h(Te,null,{default:y(()=>[h(P),h(P),h(P),h(P,{class:"tw-text-center"},{default:y(()=>[q(" Total EE Share: "+V(t(p(a).getTotalEmployeeShare)),1)]),_:1}),h(P,{class:"tw-text-center"},{default:y(()=>[q(" Total ER Share: "+V(t(p(a).getTotalEmployerShare)),1)]),_:1}),h(P,{class:"tw-text-center"},{default:y(()=>[q(" Total EC ER Share: "+V(t(p(a).getTotalECEmployerShare)),1)]),_:1})]),_:1})]),bottom:y(()=>[]),_:1},8,["filter","columns","rows"]))}},ia={class:"tw-w-12/12 tw-max-w-full tw-mx-auto tw-bg-white tw-shadow-lg tw-border tw-rounded-3xl tw-border-collapse tw-p-4 tw-mt-0"},ua=D("br",null,null,-1),ca=D("br",null,null,-1),da=D("br",null,null,-1),ma=D("br",null,null,-1),Ha={__name:"AdminReportsPage",setup(e){const t=ct();return t.currentPage="Reports",(a,n)=>(B(),me("div",ia,[D("div",null,[h(Wt),ua,h(Jt),ca,h(na),da,h(ra),ma])]))}};export{Ha as default};
