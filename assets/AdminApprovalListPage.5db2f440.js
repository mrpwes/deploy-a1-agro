import{Q as S}from"./QTd.51e0046c.js";import{r as f,o as h,c as g,d as e,Q as p,w as s,a as r,e as n,G as A,V as _,a7 as v,u as I,ar as L,as as w,aH as U,f as y}from"./index.15824037.js";import{Q as m}from"./QInput.97164f39.js";import{Q as R,a as q}from"./QTable.651292d7.js";import{d as x}from"./date.ba044ebc.js";import{u as k}from"./pageHeader.0d890997.js";import{u as Q,_ as C}from"./ViewApprovalButton.7af9ae74.js";import{Q as O,C as b}from"./ClosePopup.5de5c96a.js";import{Q as j,E as V,D}from"./position-engine.85dc6960.js";import{Q as $}from"./QCardSection.24d98c36.js";import{Q as F}from"./QForm.808c4aa5.js";import{Q as P}from"./QCard.c5d3f01b.js";import"./use-key-composition.28aa7500.js";import"./focus-manager.8e091e03.js";const Y={class:"!tw-h-min !tw-w-8/12 !tw-max-w-full tw-bg-white tw-p-6"},E=r("div",{class:"tw-col-span-4 tw-text-3xl tw-font-extrabold tw-pb-3"}," Archived Approval ",-1),M={__name:"ArchivedApprovalButton",setup(i){const l=Q(),d=f(!1),c=f(""),a=[{name:"Request ID",required:!0,label:"Request ID",align:"left",field:t=>t.id,format:t=>`${t}`,sortable:!0},{name:"Request Date",align:"center",label:"Request Date",field:t=>t.request_confirmation.application_date,format:t=>x.formatDate(t,"MMM D, YYYY"),sortable:!0},{name:"Subject",align:"center",label:"Subject",field:"subject",sortable:!0},{name:"Description",align:"center",label:"Description",field:"description",sortable:!0},{name:"Recipient",align:"center",label:"Recipient",field:t=>t.recipient.last_name+" "+t.recipient.first_name,sortable:!0},{name:"actions",align:"center",label:"",field:""}];return(t,o)=>(h(),g(v,null,[e(p,{icon:"mdi-archive",label:"Archived Request",onClick:o[0]||(o[0]=u=>d.value=!0),class:"tw-bg-white"}),e(j,{modelValue:d.value,"onUpdate:modelValue":o[2]||(o[2]=u=>d.value=u),persistent:""},{default:s(()=>[r("div",Y,[E,e(R,{class:"my-sticky-header-table tw-w-11/12 tw-mx-auto tw-mt-6 tw-bg-white tw-shadow-lg tw-border tw-rounded-3xl tw-border-collapse",flat:"",bordered:"",filter:c.value,columns:a,rows:n(l).getArchivedApprovalList,"rows-per-page-options":[10,20,0],"row-key":"name"},{"body-cell-actions":s(u=>[e(S,{props:u},{default:s(()=>[r("div",null,[e(C,{rows:u.row},null,8,["rows"])])]),_:2},1032,["props"])]),"top-right":s(()=>[e(m,{borderless:"",dense:"",debounce:"300",modelValue:c.value,"onUpdate:modelValue":o[1]||(o[1]=u=>c.value=u),placeholder:"Search"},{append:s(()=>[e(A,{name:"search"})]),_:1},8,["modelValue"])]),_:1},8,["filter","rows"]),e(O,{align:"right",class:"text-primary"},{default:s(()=>[_(e(p,{flat:"",label:"Cancel"},null,512),[[b]])]),_:1})])]),_:1},8,["modelValue"])],64))}},T=I(),z=L("addApproval",{state:()=>({recipient:null,recipientOptions:null,issuer:null,issuerOptions:null,type:null,typeOptions:["LeaveTODO!!!!","Other"],subject:null,description:null,current_user_id:T.getEmployeeId,insertRequestConfirmationID:null}),getters:{},actions:{async fetchEmployeeOptions(){try{const{data:i,error:l}=await w.from("employee").select("id, company_employee_id, first_name, middle_name, last_name");if(l)throw l;this.recipientOptions=i,this.issuerOptions=i}catch(i){console.log(i)}},insertRequestForm(){this.insertRequestConfirmation().then(()=>this.insertRequestFormToRequest()).catch(i=>{console.error("An error occurred:",i)})},async insertRequestFormToRequest(){try{const{error:i}=await w.from("request").insert([{employee_id:this.recipient.id,request_type_id:3,request_confirmation_id:this.insertRequestConfirmationID,request_date:new Date().toLocaleDateString("en-US"),subject:this.subject,description:this.description,remarks:"Pending",is_archive:!1}]);if(i)throw i}catch(i){console.log(i)}},async insertRequestConfirmation(){try{const{data:i,error:l}=await w.from("request_confirmation").insert([{employee_id:this.current_user_id,application_date:new Date().toLocaleDateString("en-US"),request_confirmation_date:new Date().toLocaleDateString("en-US"),status:"Pending",remarks:"Pending",is_archive:!1}]).select("id");if(l)throw l;console.log(i[0].id),this.insertRequestConfirmationID=i[0].id}catch(i){alert(i+"line 81"),console.log(i)}}}}),B={class:"tw-m-4"},N=r("div",{class:"tw-text-3xl tw-font-extrabold tw-pb-3"}," Add Request Form ",-1),H={class:"tw-flex tw-mb-3"},G=r("div",{class:"tw-content-center tw-mr-3"},"Employee Name:",-1),J={class:"tw-flex tw-mb-3"},K=r("div",{class:"tw-content-center tw-mr-3"},"Type:",-1),W={class:"tw-mb-3"},X=r("div",null,"Subject:",-1),Z={class:"tw-pb-3 tw-px-2"},ee={class:"tw-mb-3"},te=r("div",null,"Description:",-1),oe={class:"tw-pb-3 tw-px-2"},le={__name:"AddApprovalButton",setup(i){const l=z(),d=f(!1);l.fetchEmployeeOptions();function c(a,t){t(()=>{console.log(a);const o=a.toLowerCase();l.selectorRecipientOptions=l.recipientOptions.filter(u=>String(u.company_employee_id).toLowerCase().indexOf(o)>-1)})}return(a,t)=>(h(),g(v,null,[e(p,{icon:"mdi-plus",label:"Add Request",onClick:t[0]||(t[0]=o=>d.value=!0),class:"tw-bg-white"}),e(j,{modelValue:d.value,"onUpdate:modelValue":t[5]||(t[5]=o=>d.value=o),persistent:""},{default:s(()=>[e(P,{class:"min-width: 500px"},{default:s(()=>[e(F,{onSubmit:U(n(l).insertRequestForm,["prevent"]),autofocus:""},{default:s(()=>[r("div",B,[e($,{class:"tw-pt-0 tw-pl-0"},{default:s(()=>[N]),_:1}),r("div",H,[G,e(q,{filled:"",modelValue:n(l).recipient,"onUpdate:modelValue":t[1]||(t[1]=o=>n(l).recipient=o),"use-input":"","hide-selected":"","fill-input":"","hide-bottom-space":"","input-debounce":"0",options:n(l).selectorRecipientOptions,"option-label":o=>"first_name"in o?o.company_employee_id+" - "+o.last_name:"","option-value":a.id,onFilter:c,class:"!tw-pb-0; tw-capitalize","popup-content-class":"tw-capitalize"},{"no-option":s(()=>[e(V,null,{default:s(()=>[e(D,{class:"text-grey"},{default:s(()=>[y(" No results ")]),_:1})]),_:1})]),_:1},8,["modelValue","options","option-label","option-value"])]),r("div",J,[K,e(q,{filled:"",modelValue:n(l).type,"onUpdate:modelValue":t[2]||(t[2]=o=>n(l).type=o),"use-input":"","hide-selected":"","fill-input":"","hide-bottom-space":"","input-debounce":"0",options:n(l).typeOptions,class:"!tw-pb-0; tw-capitalize;","popup-content-class":"tw-capitalize"},{"no-option":s(()=>[e(V,null,{default:s(()=>[e(D,{class:"text-grey"},{default:s(()=>[y(" No results ")]),_:1})]),_:1})]),_:1},8,["modelValue","options"])]),r("div",W,[X,r("div",Z,[e(m,{modelValue:n(l).subject,"onUpdate:modelValue":t[3]||(t[3]=o=>n(l).subject=o),filled:"",autogrow:"",class:"tw-max-w-full","lazy-rules":""},null,8,["modelValue"])])]),r("div",ee,[te,r("div",oe,[e(m,{modelValue:n(l).description,"onUpdate:modelValue":t[4]||(t[4]=o=>n(l).description=o),filled:"",autogrow:"",class:"tw-max-w-full","lazy-rules":""},null,8,["modelValue"])])]),e(O,{align:"right",class:"text-primary"},{default:s(()=>[_(e(p,{flat:"",label:"Cancel"},null,512),[[b]]),_(e(p,{flat:"",class:"tw-bg-green-400",label:"Add Loan",type:"submit"},null,512),[[b]])]),_:1})])]),_:1},8,["onSubmit"])]),_:1})]),_:1},8,["modelValue"])],64))}},ae={class:"tw-w-11/12 tw-mx-auto tw-flex tw-justify-end tw-mb-5 tw-gap-4"},ge={__name:"AdminApprovalListPage",setup(i){const l=k();l.currentPage="Approval List";const d=Q();d.getApprovalList();const c=[{name:"Request ID",required:!0,label:"Request ID",align:"left",field:a=>a.id,format:a=>`${a}`,sortable:!0},{name:"Request Date",align:"center",label:"Request Date",field:a=>a.request_confirmation.application_date,format:a=>x.formatDate(a,"MMM D, YYYY"),sortable:!0},{name:"Subject",align:"center",label:"Subject",field:"subject",sortable:!0},{name:"Description",align:"center",label:"Description",field:"description",sortable:!0},{name:"Recipient",align:"center",label:"Recipient",field:a=>a.recipient.last_name+" "+a.recipient.first_name,sortable:!0},{name:"actions",align:"center",label:"",field:""}];return(a,t)=>(h(),g(v,null,[r("div",ae,[e(M),e(le)]),e(R,{class:"my-sticky-header-table tw-w-11/12 tw-mx-auto tw-mt-6 tw-bg-white tw-shadow-lg tw-border tw-rounded-3xl tw-border-collapse",flat:"",bordered:"",filter:a.tableSearch,columns:c,rows:n(d).getUnarchivedApprovalList,"rows-per-page-options":[10,20,0],"row-key":"name"},{"body-cell-actions":s(o=>[e(S,{key:"actions",class:"tw-w-2/12",props:o},{default:s(()=>[e(C,{rows:o.row},null,8,["rows"])]),_:2},1032,["props"])]),"top-right":s(()=>[e(m,{borderless:"",dense:"",debounce:"300",modelValue:a.tableSearch,"onUpdate:modelValue":t[0]||(t[0]=o=>a.tableSearch=o),placeholder:"Search"},{append:s(()=>[e(A,{name:"search"})]),_:1},8,["modelValue"])]),_:1},8,["filter","rows"])],64))}};export{ge as default};
