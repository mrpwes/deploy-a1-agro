import{Q as $,a as U,b as I}from"./QTable.4896ec80.js";import{at as k,au as _,r as v,o as V,c as y,d as l,Q as p,w as o,a as i,a5 as m,V as w,n as O,e as r,a9 as D,D as g,aH as P,f as h}from"./index.dd89c0e3.js";import{Q as b}from"./QInput.aa789513.js";import{d as S}from"./date.fb16480c.js";import{u as R}from"./pageHeader.cd0dd81b.js";import{C as A,G as f,Q,E as C,F as Y}from"./ClosePopup.d371907d.js";import{Q as B,a as N}from"./QPopupProxy.31481f0d.js";import{Q as z}from"./QForm.d7ef1a04.js";import{Q as L}from"./QCard.dc62b75e.js";import"./focus-manager.58afa17f.js";const x=k("viewVoucher",{state:()=>({rows:[]}),getters:{getActive(n){return n.rows.filter(t=>t.is_archive===!1)},getInactive(n){return n.rows.filter(t=>t.is_archive===!0)}},actions:{async fetchListOfVouchers(){try{const{data:n,error:t}=await _.from("voucher").select(`
              id,
              employee_id,
              type,
              date_issued,
              recipient:employee_id(first_name, middle_name, last_name),
              issuer:employee_id(first_name, middle_name, last_name), 
              issuer,
              description,
              amount,
              is_archive
            `);if(t)throw t;this.rows=n}catch(n){console.log(n)}},async archivedVoucher(n,t){try{const{data:d,error:a}=await _.from("voucher").update({is_archive:!t}).eq("id",n);if(a)throw a;console.log(d),this.fetchListOfVouchers()}catch(d){console.log(d)}}}});const E={class:"!tw-h-min !tw-w-5/12 !tw-max-w-full tw-bg-white tw-p-6"},q={id:"section-to-print"},F={class:"tw-text-3xl tw-font-extrabold tw-pb-3"},H={class:"tw-w-full tw-table-auto tw-border-collapse"},M={__name:"ViewVoucherButton",props:["rows"],setup(n){const t=x(),d=v(!1),a=v(null);function s(e){a.value=e,d.value=!0}return(e,u)=>(V(),y(D,null,[l(p,{style:{"flex-wrap":"nowrap !important"},icon:"visibility",label:"VIEW",onClick:u[0]||(u[0]=c=>s(n.rows))}),l(Q,{modelValue:d.value,"onUpdate:modelValue":u[2]||(u[2]=c=>d.value=c),persistent:""},{default:o(()=>[i("div",E,[i("div",q,[i("div",F," Voucher ID "+m(a.value.id)+" \xA0 \xA0 \xA0 \xA0 "+m(a.value.employeeName),1),i("table",H,[i("tr",null,[i("td",null," Recipient: "+m(a.value.recipient.last_name+" "+a.value.recipient.first_name),1),i("td",null," Issuer: "+m(a.value.recipient.last_name+" "+a.value.recipient.first_name),1),i("td",null,m(a.value.date),1)]),i("tr",null,[i("td",null,"Description: "+m(a.value.description),1)]),i("tr",null,[i("td",null,"Amount: "+m(a.value.amount),1)])])]),l(A,{align:"right",class:"text-primary noPrint"},{default:o(()=>[w(l(p,{flat:"",label:"Cancel"},null,512),[[f]]),w(l(p,{flat:"",class:O(a.value.is_archive?"tw-bg-green-400":"tw-bg-red-400"),icon:"mdi-archive",label:a.value.is_archive?"Unarchive":"Archive",onClick:u[1]||(u[1]=c=>r(t).archivedVoucher(a.value.id,a.value.is_archive))},null,8,["class","label"]),[[f]])]),_:1})])]),_:1},8,["modelValue"])],64))}},T={class:"!tw-h-min !tw-w-8/12 !tw-max-w-full tw-bg-white tw-p-6"},j=i("div",{class:"tw-col-span-4 tw-text-3xl tw-font-extrabold tw-pb-3"}," Archived Voucher ",-1),G={__name:"ArchivedVoucherButton",setup(n){const t=x(),d=v(!1),a=v(""),s=[{name:"Voucher Id",required:!0,label:"Voucher Id",align:"left",field:e=>e.id,format:e=>`${e}`,sortable:!0},{name:"Date",align:"center",label:"Date",field:e=>e.date_issued,format:e=>S.formatDate(e,"MMM D, YYYY"),sortable:!0},{name:"Description",align:"center",label:"Description",field:"description",sortable:!0},{name:"Recipient",align:"center",label:"Recipient",field:e=>e.recipient.last_name+" "+e.recipient.first_name,sortable:!0},{name:"Issuer",align:"center",label:"Issuer",field:e=>e.issuer.last_name+" "+e.issuer.first_name,sortable:!0},{name:"Amount",align:"center",label:"Amount",field:"amount",sortable:!0},{name:"actions",align:"center",label:"",field:""}];return(e,u)=>(V(),y(D,null,[l(p,{icon:"mdi-archive",label:"Archived Voucher",onClick:u[0]||(u[0]=c=>d.value=!0),class:"tw-bg-white"}),l(Q,{modelValue:d.value,"onUpdate:modelValue":u[2]||(u[2]=c=>d.value=c),persistent:""},{default:o(()=>[i("div",T,[j,l($,{class:"my-sticky-header-table tw-w-11/12 tw-mx-auto tw-mt-6 tw-bg-white tw-shadow-lg tw-border tw-rounded-3xl tw-border-collapse",flat:"",bordered:"",filter:a.value,columns:s,rows:r(t).getInactive,"rows-per-page-options":[10,20,0],"row-key":"name"},{"body-cell-actions":o(c=>[l(U,{props:c},{default:o(()=>[i("div",null,[l(M,{rows:c.row},null,8,["rows"])])]),_:2},1032,["props"])]),"top-right":o(()=>[l(b,{borderless:"",dense:"",debounce:"300",modelValue:a.value,"onUpdate:modelValue":u[1]||(u[1]=c=>a.value=c),placeholder:"Search"},{append:o(()=>[l(g,{name:"search"})]),_:1},8,["modelValue"])]),_:1},8,["filter","rows"]),l(A,{align:"right",class:"text-primary"},{default:o(()=>[w(l(p,{flat:"",label:"Cancel"},null,512),[[f]])]),_:1})])]),_:1},8,["modelValue"])],64))}},W=x(),J=k("addVoucher",{state:()=>({employee_id:null,type:null,date_issued:null,recipient:null,recipientOptions:[],issuer:null,issuerOptions:[],description:null,amount:null,is_archive:null,loading:!1}),getters:{},actions:{addVoucher(){Promise.all([this.getCurrentUser()]).then(()=>{this.addVoucherData(),this.reset()})},async addVoucherData(){this.loading=!0;try{const{data:n,error:t}=await _.from("voucher").insert([{employee_id:this.employee_id,type:this.type,date_issued:this.date_issued,recipient:this.recipient.id,issuer:this.issuer.id,description:this.description,amount:this.amount,is_archive:!1}]);if(t)throw t;console.log(n),this.loading=!1,this.success(),W.fetchListOfVouchers()}catch(n){console.log(n),this.loading=!1}},async getCurrentUser(){const{data:{user:n}}=await _.auth.getUser();this.employee_id=n.id},async fetchReferenceData(){try{const{data:n,error:t}=await _.from("employee").select("id, first_name, middle_name, last_name");if(t)throw t;this.recipientOptions=n,this.issuerOptions=n}catch(n){console.log(n)}},success(){P.create({icon:"done",color:"positive",message:"Added Voucher Successfully!"})},reset(){this.employee_id=null,this.type=null,this.date_issued=null,this.recipient=null,this.issuer=null,this.description=null,this.amount=null,this.is_archive=null}}}),K={class:"tw-grid tw-grid-cols-3 tw-gap-3 tw-mb-5"},X=i("div",{class:"tw-col-span-3 tw-text-3xl tw-font-extrabold tw-pb-3"}," Add Voucher ",-1),Z={class:"tw-col-span-1"},ee=i("div",{class:"tw-col-span-1"},null,-1),te={class:"tw-col-span-1"},le=i("div",{class:"tw-col-span-3"},"Description",-1),se={class:"tw-col-span-3"},ae={class:"tw-col-span-1"},ie={class:"row items-center justify-end"},oe=i("div",{class:"tw-col-span-1"},null,-1),ne={class:"tw-col-span-1"},re={__name:"AddVoucherButton",setup(n){const t=J(),d=v(!1);return t.fetchReferenceData(),(a,s)=>(V(),y(D,null,[l(p,{icon:"mdi-plus",label:"Add Voucher",onClick:s[0]||(s[0]=e=>d.value=!0),class:"tw-bg-white"}),l(Q,{modelValue:d.value,"onUpdate:modelValue":s[7]||(s[7]=e=>d.value=e),persistent:""},{default:o(()=>[l(L,{class:"!tw-h-min !tw-w-5/12 !tw-max-w-full tw-bg-white tw-p-6"},{default:o(()=>[l(z,{autofocus:""},{default:o(()=>[i("div",null,[i("div",K,[X,i("div",Z,[h(" Recipient "),l(I,{filled:"",modelValue:r(t).recipient,"onUpdate:modelValue":s[1]||(s[1]=e=>r(t).recipient=e),"use-input":"","hide-selected":"","fill-input":"","hide-bottom-space":"","input-debounce":"0",options:r(t).recipientOptions,"option-label":e=>"first_name"in e?e.first_name+" "+e.last_name:"","option-value":a.id,class:"!tw-pb-0; tw-capitalize","popup-content-class":"tw-capitalize",disable:r(t).loading},{"no-option":o(()=>[l(C,null,{default:o(()=>[l(Y,{class:"text-grey"},{default:o(()=>[h(" No results ")]),_:1})]),_:1})]),_:1},8,["modelValue","options","option-label","option-value","disable"])]),ee,i("div",te,[h(" Issuer "),l(I,{filled:"",modelValue:r(t).issuer,"onUpdate:modelValue":s[2]||(s[2]=e=>r(t).issuer=e),"use-input":"","hide-selected":"","fill-input":"","hide-bottom-space":"","input-debounce":"0",options:r(t).issuerOptions,"option-label":e=>"first_name"in e?e.first_name+" "+e.last_name:"","option-value":a.id,class:"!tw-pb-0; tw-capitalize","popup-content-class":"tw-capitalize",disable:r(t).loading},{"no-option":o(()=>[l(C,null,{default:o(()=>[l(Y,{class:"text-grey"},{default:o(()=>[h(" No results ")]),_:1})]),_:1})]),_:1},8,["modelValue","options","option-label","option-value","disable"])]),le,i("div",se,[l(b,{modelValue:r(t).description,"onUpdate:modelValue":s[3]||(s[3]=e=>r(t).description=e),type:"textarea",filled:"","hide-bottom-space":"",rules:[e=>e.length>=1],disable:r(t).loading},null,8,["modelValue","rules","disable"])]),i("div",ae,[h(" Date: "),l(b,{filled:"",modelValue:r(t).date_issued,"onUpdate:modelValue":s[5]||(s[5]=e=>r(t).date_issued=e),label:"YYYY-MM-DD",rules:[e=>a.date.isValid(e)],"hide-bottom-space":"",disable:r(t).loading},{append:o(()=>[l(g,{name:"event",class:"cursor-pointer"},{default:o(()=>[l(B,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:o(()=>[l(N,{modelValue:r(t).date_issued,"onUpdate:modelValue":s[4]||(s[4]=e=>r(t).date_issued=e),mask:"YYYY-MM-DD"},{default:o(()=>[i("div",ie,[w(l(p,{label:"Close",color:"primary",flat:""},null,512),[[f]])])]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue","rules","disable"])]),oe,i("div",ne,[h(" Amount "),l(b,{filled:"",modelValue:r(t).amount,"onUpdate:modelValue":s[6]||(s[6]=e=>r(t).amount=e),dense:a.dense,rules:[e=>e.length>=1],"hide-bottom-space":"",disable:r(t).loading},{prepend:o(()=>[l(g,{style:{"font-size":"x-large"},name:"mdi-currency-php"})]),_:1},8,["modelValue","dense","rules","disable"])])]),l(A,{align:"right",class:"text-primary"},{default:o(()=>[w(l(p,{flat:"",label:"Cancel"},null,512),[[f]]),w(l(p,{flat:"",class:"tw-bg-green-400",label:"Add Invoice",type:"submit",onclick:r(t).addVoucher,disable:r(t).loading},null,8,["onclick","disable"]),[[f]])]),_:1})])]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}},de={class:"tw-w-11/12 tw-mx-auto tw-flex tw-justify-end tw-mb-5 tw-gap-4"},ge={__name:"AdminVoucherListPage",setup(n){const t=R();t.currentPage="Voucher List";const d=x();d.fetchListOfVouchers();const a=[{name:"Voucher Id",required:!0,label:"Voucher Id",align:"left",field:s=>s.id,format:s=>`${s}`,sortable:!0},{name:"Date",align:"center",label:"Date",field:s=>s.date_issued,format:s=>S.formatDate(s,"MMM D, YYYY"),sortable:!0},{name:"Description",align:"center",label:"Description",field:"description",sortable:!0},{name:"Recipient",align:"center",label:"Recipient",field:s=>s.recipient.last_name+" "+s.recipient.first_name,sortable:!0},{name:"Issuer",align:"center",label:"Issuer",field:s=>s.issuer.last_name+" "+s.issuer.first_name,sortable:!0},{name:"Amount",align:"center",label:"Amount",field:"amount",sortable:!0},{name:"actions",align:"center",label:"",field:""}];return(s,e)=>(V(),y(D,null,[i("div",de,[l(G),l(re)]),l($,{class:"my-sticky-header-table tw-w-11/12 tw-mx-auto tw-mt-6 tw-bg-white tw-shadow-lg tw-border tw-rounded-3xl tw-border-collapse",flat:"",bordered:"",filter:s.tableSearch,columns:a,rows:r(d).getActive,"rows-per-page-options":[10,20,0],"row-key":"name"},{"body-cell-actions":o(u=>[l(U,{key:"actions",class:"tw-w-2/12",props:u},{default:o(()=>[l(M,{rows:u.row},null,8,["rows"])]),_:2},1032,["props"])]),"top-right":o(()=>[l(b,{borderless:"",dense:"",debounce:"300",modelValue:s.tableSearch,"onUpdate:modelValue":e[0]||(e[0]=u=>s.tableSearch=u),placeholder:"Search"},{append:o(()=>[l(g,{name:"search"})]),_:1},8,["modelValue"])]),_:1},8,["filter","rows"])],64))}};export{ge as default};
