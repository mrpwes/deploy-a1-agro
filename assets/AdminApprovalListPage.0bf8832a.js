import{Q as C,a as Q,b as D}from"./QTable.7df256fe.js";import{r as _,o as w,c as g,d as t,Q as c,w as r,a as i,a5 as b,e as d,V as f,a4 as S,g as R,a9 as y,at as j,au as h,D as U,u as O,aI as Y,f as x}from"./index.79bc68ea.js";import{Q as m}from"./QInput.e11a759f.js";import{d as V}from"./date.a8136700.js";import{u as M}from"./pageHeader.7601f112.js";import{C as A,G as v,Q as q,E as k,F as $}from"./ClosePopup.a2287c7d.js";import{Q as P}from"./QCardSection.eb2ae4b6.js";import{Q as B}from"./QForm.e8b11a77.js";import{Q as F}from"./QCard.cebd6c99.js";import"./focus-manager.0f117707.js";const N={class:"!tw-h-min !tw-w-4/12 !tw-max-w-full tw-bg-white tw-p-6"},E={class:"tw-grid tw-grid-cols-3 tw-gap-5 tw-pb-5"},T=i("div",{class:"tw-col-span-3"},"Subject:",-1),z={class:"tw-col-span-3"},H=i("div",{class:"tw-col-span-3"},"Description:",-1),G={class:"tw-col-span-3"},J=i("div",{class:"tw-col-span-3"},"Remarks:",-1),K={class:"tw-col-span-3 !tw-h-2/6"},I={__name:"ViewApprovalButton",props:["rows"],setup(s){const a=_(!1),o=_(null);function u(l){o.value=l,a.value=!0}return(l,e)=>(w(),g(y,null,[t(c,{icon:"visibility",label:"View",onClick:e[0]||(e[0]=n=>u(s.rows))}),t(q,{modelValue:a.value,"onUpdate:modelValue":e[6]||(e[6]=n=>a.value=n)},{default:r(()=>[i("div",N,[i("div",E,[i("div",null,"Request ID: "+b(o.value.id),1),i("div",null," Name: "+b(o.value.recipient.first_name)+" "+b(o.value.recipient.last_name),1),i("div",null," Application Date: "+b(d(V).formatDate(o.value.request_confirmation.application_date,"MMM D, YYYY")),1),T,i("div",z,[t(m,{dense:l.dense,modelValue:o.value.subject,"onUpdate:modelValue":e[1]||(e[1]=n=>o.value.subject=n),disable:"",autogrow:"",filled:"","hide-bottom-space":""},null,8,["dense","modelValue"])]),H,i("div",G,[t(m,{dense:l.dense,modelValue:o.value.description,"onUpdate:modelValue":e[2]||(e[2]=n=>o.value.description=n),disable:"",autogrow:"",filled:"","hide-bottom-space":""},null,8,["dense","modelValue"])]),J,i("div",K,[t(m,{modelValue:o.value.remarks,"onUpdate:modelValue":e[3]||(e[3]=n=>o.value.remarks=n),filled:"",autogrow:"",disable:!!o.value.isArchive,readonly:!!o.value.isArchive},null,8,["modelValue","disable","readonly"])])]),t(A,{align:"right",class:"text-primary"},{default:r(()=>[f(t(c,{flat:"",label:"Cancel"},null,512),[[v]]),o.value.isArchive==!1?f((w(),S(c,{key:0,flat:"",class:"tw-bg-red-500",icon:"mdi-close",label:"Disapprove",onClick:e[4]||(e[4]=n=>{o.value.isApproved=!1,o.value.isArchive=!0})},null,512)),[[v]]):R("",!0),o.value.isArchive==!1?f((w(),S(c,{key:1,flat:"",class:"tw-bg-green-400",icon:"mdi-check-bold",label:"Approve",onClick:e[5]||(e[5]=n=>{o.value.isApproved=!0,o.value.isArchive=!0})},null,512)),[[v]]):R("",!0)]),_:1})])]),_:1},8,["modelValue"])],64))}},L=j("viewApproval",{state:()=>({rows:[]}),getters:{getArchivedApprovalList(s){return s.rows.filter(a=>a.is_archive===!0)},getUnarchivedApprovalList(s){return s.rows.filter(a=>a.is_archive===!1)}},actions:{async getApprovalList(){try{const{data:s,error:a}=await h.from("request").select(`
            id,
            recipient:employee (id, first_name, middle_name, last_name),
            request_type_id,
            request_date,
            subject,
            description,
            remarks,
            is_archive,
            request_confirmation (
                id,
                employee_id,
                application_date,
                request_confirmation_date,
                status,
                remarks,
                is_archive
            )        
        `).eq("request_type_id",3);if(a)throw a;this.rows=s}catch(s){console.log(s)}}}}),W={class:"!tw-h-min !tw-w-8/12 !tw-max-w-full tw-bg-white tw-p-6"},X=i("div",{class:"tw-col-span-4 tw-text-3xl tw-font-extrabold tw-pb-3"}," Archived Approval ",-1),Z={__name:"ArchivedApprovalButton",setup(s){const a=L(),o=_(!1),u=_(""),l=[{name:"Request ID",required:!0,label:"Request ID",align:"left",field:e=>e.id,format:e=>`${e}`,sortable:!0},{name:"Request Date",align:"center",label:"Request Date",field:e=>e.request_confirmation.application_date,format:e=>V.formatDate(e,"MMM D, YYYY"),sortable:!0},{name:"Subject",align:"center",label:"Subject",field:"subject",sortable:!0},{name:"Description",align:"center",label:"Description",field:"description",sortable:!0},{name:"Recipient",align:"center",label:"Recipient",field:e=>e.recipient.last_name+" "+e.recipient.first_name,sortable:!0},{name:"actions",align:"center",label:"",field:""}];return(e,n)=>(w(),g(y,null,[t(c,{icon:"mdi-archive",label:"Archived Request",onClick:n[0]||(n[0]=p=>o.value=!0),class:"tw-bg-white"}),t(q,{modelValue:o.value,"onUpdate:modelValue":n[2]||(n[2]=p=>o.value=p),persistent:""},{default:r(()=>[i("div",W,[X,t(C,{class:"my-sticky-header-table tw-w-11/12 tw-mx-auto tw-mt-6 tw-bg-white tw-shadow-lg tw-border tw-rounded-3xl tw-border-collapse",flat:"",bordered:"",filter:u.value,columns:l,rows:d(a).getArchivedApprovalList,"rows-per-page-options":[10,20,0],"row-key":"name"},{"body-cell-actions":r(p=>[t(Q,{props:p},{default:r(()=>[i("div",null,[t(I,{rows:p.row},null,8,["rows"])])]),_:2},1032,["props"])]),"top-right":r(()=>[t(m,{borderless:"",dense:"",debounce:"300",modelValue:u.value,"onUpdate:modelValue":n[1]||(n[1]=p=>u.value=p),placeholder:"Search"},{append:r(()=>[t(U,{name:"search"})]),_:1},8,["modelValue"])]),_:1},8,["filter","rows"]),t(A,{align:"right",class:"text-primary"},{default:r(()=>[f(t(c,{flat:"",label:"Cancel"},null,512),[[v]])]),_:1})])]),_:1},8,["modelValue"])],64))}},ee=O(),te=j("addApproval",{state:()=>({recipient:null,recipientOptions:null,issuer:null,issuerOptions:null,type:null,typeOptions:["LeaveTODO!!!!","Other"],subject:null,description:null,current_user_id:ee.getEmployeeId,insertRequestConfirmationID:null}),getters:{},actions:{async fetchEmployeeOptions(){try{const{data:s,error:a}=await h.from("employee").select("id, first_name, middle_name, last_name");if(a)throw a;this.recipientOptions=s,this.issuerOptions=s}catch(s){console.log(s)}},insertRequestForm(){this.insertRequestConfirmation().then(()=>this.insertRequestFormToRequest()).catch(s=>{console.error("An error occurred:",s)})},async insertRequestFormToRequest(){try{const{error:s}=await h.from("request").insert([{employee_id:this.recipient.id,request_type_id:3,request_confirmation_id:this.insertRequestConfirmationID,request_date:new Date().toLocaleDateString("en-US"),subject:this.subject,description:this.description,remarks:"Pending",is_archive:!1}]);if(s)throw s}catch(s){console.log(s)}},async insertRequestConfirmation(){try{const{data:s,error:a}=await h.from("request_confirmation").insert([{employee_id:this.current_user_id,application_date:new Date().toLocaleDateString("en-US"),request_confirmation_date:new Date().toLocaleDateString("en-US"),status:"Pending",remarks:"Pending",is_archive:!1}]).select("id");if(a)throw a;console.log(s[0].id),this.insertRequestConfirmationID=s[0].id}catch(s){alert(s+"line 81"),console.log(s)}}}}),le={class:"tw-m-4"},ae=i("div",{class:"tw-text-3xl tw-font-extrabold tw-pb-3"}," Add Request Form ",-1),se={class:"tw-flex tw-mb-3"},oe=i("div",{class:"tw-content-center tw-mr-3"},"Employee Name:",-1),ie={class:"tw-flex tw-mb-3"},re=i("div",{class:"tw-content-center tw-mr-3"},"Type:",-1),ne={class:"tw-mb-3"},de=i("div",null,"Subject:",-1),ue={class:"tw-pb-3 tw-px-2"},ce={class:"tw-mb-3"},pe=i("div",null,"Description:",-1),me={class:"tw-pb-3 tw-px-2"},we={__name:"AddApprovalButton",setup(s){const a=te(),o=_(!1);return a.fetchEmployeeOptions(),(u,l)=>(w(),g(y,null,[t(c,{icon:"mdi-plus",label:"Add Request",onClick:l[0]||(l[0]=e=>o.value=!0),class:"tw-bg-white"}),t(q,{modelValue:o.value,"onUpdate:modelValue":l[5]||(l[5]=e=>o.value=e),persistent:""},{default:r(()=>[t(F,{class:"min-width: 500px"},{default:r(()=>[t(B,{onSubmit:Y(d(a).insertRequestForm,["prevent"]),autofocus:""},{default:r(()=>[i("div",le,[t(P,{class:"tw-pt-0 tw-pl-0"},{default:r(()=>[ae]),_:1}),i("div",se,[oe,t(D,{filled:"",modelValue:d(a).recipient,"onUpdate:modelValue":l[1]||(l[1]=e=>d(a).recipient=e),"use-input":"","hide-selected":"","fill-input":"","hide-bottom-space":"","input-debounce":"0",options:d(a).recipientOptions,"option-label":e=>"first_name"in e?e.first_name+" "+e.last_name:"","option-value":u.id,class:"!tw-pb-0; tw-capitalize","popup-content-class":"tw-capitalize"},{"no-option":r(()=>[t(k,null,{default:r(()=>[t($,{class:"text-grey"},{default:r(()=>[x(" No results ")]),_:1})]),_:1})]),_:1},8,["modelValue","options","option-label","option-value"])]),i("div",ie,[re,t(D,{filled:"",modelValue:d(a).type,"onUpdate:modelValue":l[2]||(l[2]=e=>d(a).type=e),"use-input":"","hide-selected":"","fill-input":"","hide-bottom-space":"","input-debounce":"0",options:d(a).typeOptions,class:"!tw-pb-0; tw-capitalize;","popup-content-class":"tw-capitalize"},{"no-option":r(()=>[t(k,null,{default:r(()=>[t($,{class:"text-grey"},{default:r(()=>[x(" No results ")]),_:1})]),_:1})]),_:1},8,["modelValue","options"])]),i("div",ne,[de,i("div",ue,[t(m,{modelValue:d(a).subject,"onUpdate:modelValue":l[3]||(l[3]=e=>d(a).subject=e),filled:"",autogrow:"",class:"tw-max-w-full","lazy-rules":""},null,8,["modelValue"])])]),i("div",ce,[pe,i("div",me,[t(m,{modelValue:d(a).description,"onUpdate:modelValue":l[4]||(l[4]=e=>d(a).description=e),filled:"",autogrow:"",class:"tw-max-w-full","lazy-rules":""},null,8,["modelValue"])])]),t(A,{align:"right",class:"text-primary"},{default:r(()=>[f(t(c,{flat:"",label:"Cancel"},null,512),[[v]]),f(t(c,{flat:"",class:"tw-bg-green-400",label:"Add Loan",type:"submit"},null,512),[[v]])]),_:1})])]),_:1},8,["onSubmit"])]),_:1})]),_:1},8,["modelValue"])],64))}},fe={class:"tw-w-11/12 tw-mx-auto tw-flex tw-justify-end tw-mb-5 tw-gap-4"},Se={__name:"AdminApprovalListPage",setup(s){const a=M();a.currentPage="Approval List";const o=L();o.getApprovalList();const u=[{name:"Request ID",required:!0,label:"Request ID",align:"left",field:l=>l.id,format:l=>`${l}`,sortable:!0},{name:"Request Date",align:"center",label:"Request Date",field:l=>l.request_confirmation.application_date,format:l=>V.formatDate(l,"MMM D, YYYY"),sortable:!0},{name:"Subject",align:"center",label:"Subject",field:"subject",sortable:!0},{name:"Description",align:"center",label:"Description",field:"description",sortable:!0},{name:"Recipient",align:"center",label:"Recipient",field:l=>l.recipient.last_name+" "+l.recipient.first_name,sortable:!0},{name:"actions",align:"center",label:"",field:""}];return(l,e)=>(w(),g(y,null,[i("div",fe,[t(Z),t(we)]),t(C,{class:"my-sticky-header-table tw-w-11/12 tw-mx-auto tw-mt-6 tw-bg-white tw-shadow-lg tw-border tw-rounded-3xl tw-border-collapse",flat:"",bordered:"",filter:l.tableSearch,columns:u,rows:d(o).getUnarchivedApprovalList,"rows-per-page-options":[10,20,0],"row-key":"name"},{"body-cell-actions":r(n=>[t(Q,{key:"actions",class:"tw-w-2/12",props:n},{default:r(()=>[t(I,{rows:n.row},null,8,["rows"])]),_:2},1032,["props"])]),"top-right":r(()=>[t(m,{borderless:"",dense:"",debounce:"300",modelValue:l.tableSearch,"onUpdate:modelValue":e[0]||(e[0]=n=>l.tableSearch=n),placeholder:"Search"},{append:r(()=>[t(U,{name:"search"})]),_:1},8,["modelValue"])]),_:1},8,["filter","rows"])],64))}};export{Se as default};
