import{g as H,Q as M}from"./position-engine.24d5c4ea.js";import{Q as R,c as k}from"./QSelect.06471d4e.js";import{u as A}from"./pageHeader.76fa7086.js";import{u as L,at as F,au as D,a5 as N,o as T,c as W,a as t,a8 as p,d as v,w as S,e as r,aT as O,f as E,aR as V,aS as B}from"./index.c0f9d41d.js";import"./focus-manager.90a99338.js";import"./QDialog.7c9c19ff.js";import"./use-key-composition.d0293a0f.js";const G=L(),Q=F("payslip",{state:()=>({payrollColumns:{columns:[{name:"employeeId",required:!0,label:"Emp. Id",align:"left",sortable:!0},{name:"employeeName",align:"center",label:"Name",sortable:!0,classes:"!tw-bg-neutral-300"},{name:"noDaysWorked",align:"center",label:"Days Worked",sortable:!0},{name:"ratePerDay",align:"center",label:"Rate/Day",classes:"!tw-bg-neutral-300"},{name:"total",align:"center",label:"Total",sortable:!0},{name:"sss",align:"center",label:"SSS",sortable:!0,classes:"!tw-bg-neutral-300"},{name:"philHealth",align:"center",label:"PhilHealth",sortable:!0},{name:"pagIbig",align:"center",label:"PagIBIG",sortable:!0,classes:"!tw-bg-neutral-300"},{name:"sssCalamityLoan",align:"center",label:"SSS Calamity Loan",sortable:!0},{name:"sssLoan",align:"center",label:"SSS  Loan",sortable:!0,classes:"!tw-bg-neutral-300"},{name:"pagIbigLoan",align:"center",label:"Pag-IBIG Loan",sortable:!0,headerStyle:"width: 0px"},{name:"NetPay",align:"center",label:"NetPay",sortable:!0,classes:"!tw-bg-neutral-300"},{name:"actions",align:"center",label:""}]},rows:[{id:null,company_employee_id:null,employment_type_id:null,first_name:null,middle_name:null,last_name:null,date_of_birth:null,gender:null,martial_status:null,department:null,position:null,phil_health_number:null,pag_ibig_number:null,sss_number:null,bir_tin:null,hired_date:null,rate_per_day:null,is_archive:null,emp_id_modified_by:null,change_date:null,attendance:[],emp_sss_contrib_audit:[],emp_philhealth_contrib_audit:[],emp_pagibig_contrib_audit:[],vale_audit:null,employee_audit:[{gender:null,bir_tin:null,audit_id:null,position:null,last_name:null,department:null,first_name:null,hired_date:null,is_archive:null,sss_number:null,change_date:null,employee_id:null,middle_name:null,rate_per_day:null,date_of_birth:null,martial_status:null,operation_type:null,pag_ibig_number:null,emp_id_modified_by:null,employment_type_id:null},{gender:null,bir_tin:null,audit_id:null,position:null,last_name:null,department:null,first_name:null,hired_date:null,is_archive:null,sss_number:null,change_date:null,employee_id:null,middle_name:null,rate_per_day:null,date_of_birth:null,martial_status:null,operation_type:null,pag_ibig_number:null,emp_id_modified_by:null,employment_type_id:null},{gender:null,bir_tin:null,audit_id:null,position:null,last_name:null,department:null,first_name:null,hired_date:null,is_archive:null,sss_number:null,change_date:null,employee_id:null,middle_name:null,rate_per_day:null,date_of_birth:null,martial_status:null,operation_type:null,pag_ibig_number:null,emp_id_modified_by:null,employment_type_id:null}],partial_to_ar_audit:null}],selectedDate:null,selectedDateOptions:null,currentUser:G.getEmployeeId}),getters:{},actions:{formatDate(a){const e=a.getFullYear(),n=String(a.getMonth()+1).padStart(2,"0"),o=String(a.getDate()).padStart(2,"0");return`${e}-${n}-${o}`},getAndCheckDateRangesForCurrentMonth(){const a=new Date,e=a.getFullYear(),n=a.getMonth(),o=new Date(e,n,1),s=new Date(e,n,15),l=new Date(e,n,16),c=new Date(e,n+1,0),i={firstHalf:{start:this.formatDate(o),end:this.formatDate(s)},secondHalf:{start:this.formatDate(l),end:this.formatDate(c)}},d=this.formatDate(a),_=new Date(i.firstHalf.start),m=new Date(i.firstHalf.end),b=new Date(i.secondHalf.start),f=new Date(i.secondHalf.end);let h,g;return a>=_&&a<=m?(h=this.formatDate(_),g=this.formatDate(m)):a>=b&&a<=f?(h=this.formatDate(b),g=this.formatDate(f)):(h="out of range",g="out of range"),{todayDate:d,startDate:h,endDate:g}},async getSalaryHistory(){try{const{data:a,error:e}=await D.from("salary_history").select();e&&console.error(e),this.selectedDateOptions=a.sort((n,o)=>new Date(n.date_start)-new Date(o.date_start))}catch(a){console.error(a)}},customLogic(a,e){return!(a&&e)},async fetchAttendanceInRange(a=this.selectedDate.date_start,e=this.selectedDate.date_end){try{const{data:n,error:o}=await D.from("employee").select(`*,
            attendance(*, attendance_type(*)),
            employee_audit!employee_audit_employee_id_fkey(*),
            emp_sss_contrib_audit!emp_sss_contrib_audit_employee_id_fkey(*),
            emp_philhealth_contrib_audit!emp_philhealth_contrib_audit_employee_id_fkey(*),
            emp_pagibig_contrib_audit!emp_pagibig_contrib_audit_employee_id_fkey(*),
            vale_audit!vale_audit_employee_id_fkey(*),
            partial_to_ar_audit!partial_to_ar_audit_employee_id_fkey(*)
            `).eq("is_archive",!1).gte("attendance.date",a).lte("attendance.date",e).lte("emp_sss_contrib_audit.change_date",e).lte("emp_philhealth_contrib_audit.change_date",e).lte("emp_pagibig_contrib_audit.change_date",e).lte("vale_audit.change_date",e).eq("id",this.currentUser);n.forEach(s=>{const l=s.emp_sss_contrib_audit;if(l.length>0){const c=l[l.length-1];c.half_month_indicator==!0&&[28,29,30,31].includes(parseInt(e.split("-")[2]))?console.log("is true."):c.half_month_indicator==!1&&[15].includes(parseInt(e.split("-")[2]))?console.log("is true 2."):(console.log("EMPLOYEE SSS is false."),s.emp_sss_contrib_audit=[])}else console.log("emp_sss_contrib_audit array is empty.")}),n.forEach(s=>{const l=s.emp_philhealth_contrib_audit;if(l.length>0){const c=l[l.length-1];c.half_month_indicator==!0&&[28,29,30,31].includes(parseInt(e.split("-")[2]))?console.log("Philhealth is true."):c.half_month_indicator==!1&&[15].includes(parseInt(e.split("-")[2]))?console.log("Philhealth is true 2."):s.emp_philhealth_contrib_audit=[]}else console.log("emp_philhealth_contrib_audit array is empty.")}),n.forEach(s=>{const l=s.emp_pagibig_contrib_audit;if(l.length>0){const c=l[l.length-1];c.half_month_indicator==!0&&[28,29,30,31].includes(parseInt(e.split("-")[2]))?console.log("Pagibig is true."):c.half_month_indicator==!1&&[15].includes(parseInt(e.split("-")[2]))?console.log("Pagibig is true 2."):s.emp_pagibig_contrib_audit=[]}else console.log("emp_pagibig_contrib_audit array is empty.")}),o&&console.error(o),this.rows=n}catch(n){console.error(n)}},getNearestDateRange(){if(this.selectedDate!=null)return;const a=new Date;function e(l){return new Date(l)}function n(l){return Math.abs(a-l)}let o=null,s=1/0;for(const l of this.selectedDateOptions){const c=e(l.date_start),i=e(l.date_end),d=n(c),_=n(i),m=Math.min(d,_);m<s&&(s=m,o=l)}this.selectedDate=o},async fetchAttendanceReports(){await this.getSalaryHistory(),await this.getNearestDateRange(),await this.fetchAttendanceInRange()}}}),U=F("payslipFormatter",{state:()=>({payrollData:[],sssContributionTableRanges:[],philhealthContributionRate:null,pagibigContributionRate:null,totalHours:0}),getters:{formattedPayrollData:a=>a.payrollData.map(e=>({...e,formattedDate:new Date(e.date).toLocaleDateString()}))},actions:{twoDecimalWithoutRounding(a){var e=a.toString().match(/^-?\d+(?:\.\d{0,2})?/)[0];return parseFloat(e)},capitalizeFirstLetterOfEachWord(a){return a.split(" ").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" ")},noDaysWorkedFormatter(a){let e=0;a.forEach(o=>{if(o.time_out===null&&o.time_in!==null)e+=0;else if(o.attendance_type_id!==1&&o.attendance_type_id!==void 0)e+=480;else if(o.time_in&&o.time_out){const s=new Date(o.time_in),l=new Date(o.time_out),c=new Date(s);c.setHours(8,0,0,0),s<c&&s.setHours(8,0,0,0);const i=new Date(l);i.setHours(17,0,0,0),l>i&&l.setHours(17,0,0,0);let d=(l-s)/(1e3*60);const _=new Date(l);_.setHours(13,0,0,0),l>_&&(d-=60),e+=d}});const n=e/60;return this.totalHours=this.twoDecimalWithoutRounding(n),(this.twoDecimalWithoutRounding(n)/8).toFixed(2)},grossIncomeFormatter(a,e){const n=this.noDaysWorkedFormatter(e);return a*n},monthlyIncomeFormatter(a,e=30){return this.twoDecimalWithoutRounding(a*e)},async fetchSssContributionTable(){try{const{data:a,error:e}=await D.from("sss_contribution_table_audit").select("*").order("audit_id",{ascending:!1}).limit(1);if(e)throw console.error(e),e;this.sssContributionTableRanges=a[0].data.map(n=>{const o=n.combinedValue;let s,l,c;if(c=parseFloat(n.values[4].replace(",","")),o.startsWith("Below"))s=0,l=parseFloat(o.split(" ")[1].replace(",",""));else if(o.includes("Over"))s=parseFloat(o.split(" ")[0].replace(",","")),l=null;else{const[i,d]=o.split(" - ");s=parseFloat(i.replace(",","")),l=parseFloat(d.replace(",",""))}return{min:s,max:l,sss_bracket:c}})}catch(a){console.error(a)}},findSSSRange(a){for(const e of this.sssContributionTableRanges)if(a>=e.min&&a<e.max)return e.sss_bracket;return"Value is out of range"},async fetchPhilhealthContributionTable(){try{const{data:a,error:e}=await D.from("philhealth_contribution_table_audit").select("*").order("audit_id",{ascending:!1}).limit(1);if(e)throw console.error(e),e;this.philhealthContributionRate=a[0].data.value}catch(a){console.error(a)}},async fetchPagibigContributionTable(){try{const{data:a,error:e}=await D.from("pagibig_contribution_table_audit").select("*").order("audit_id",{ascending:!1}).limit(1);if(e)throw console.error(e),e;this.pagibigContributionRate=a}catch(a){console.error(a)}},calculatePagibigContribution(a){const e=this.monthlyIncomeFormatter(a);let n,o;return e<=1500?(n=.01,o=Math.min(e,1e4)*n):(n=.02,o=Math.min(e,1e4)*n),this.twoDecimalWithoutRounding(o)}}});const u=a=>(V("data-v-0027abc0"),a=a(),B(),a),$={class:"noScreen"},j=O('<div class="tw-flex tw-flex-row tw-justify-between tw-mb-10" data-v-0027abc0><div class="tw-flex tw-flex-row" data-v-0027abc0><img class="tw-size-28 tw-mt-3" src="src/assets/logo.png" data-v-0027abc0><div class="tw-text-1xl tw-w-1/6 tw-content-center tw-ml-2 tw-text-nowrap tw-mt-3" data-v-0027abc0> A1 Agro Fertilizer and<br data-v-0027abc0> Chemical Supply <br data-v-0027abc0><br data-v-0027abc0><text class="tw-text-nowrap" data-v-0027abc0>+63 123 456 7890</text></div></div><div data-v-0027abc0><div class="tw-font-bold tw-text-3xl tw-text-right" data-v-0027abc0>Payslip</div><div class="tw-text-lg tw-text-right" data-v-0027abc0>#123123</div></div></div>',1),q={class:"tw-pl-10"},z={class:"tw-py-2"},Y=u(()=>t("div",{class:"tw-flex tw-flex-row"},[t("div",{class:"tw-pr-8"},"MARAAN, ARNIENO P."),t("div",null,"20190149350")],-1)),J={class:"tw-rounded-3xl tw-text-nowrap tw-w-6/12 tw-mx-auto tw-mb-3 tw-bg-white tw-shadow-lg noPrint"},K={class:"tw-justify-evenly"},X=u(()=>t("td",{class:"tw-text-center"},null,-1)),Z={class:"tw-text-end tw-pr-3"},tt=u(()=>t("thead",null,[t("tr",null,[t("th",{colspan:"3"},[t("div",null,"Gross Income")]),t("th",{colspan:"3"},[t("div",null,"Deductions")])])],-1)),et=u(()=>t("td",{colspan:"1"},[t("div",null,"Rate Per Day:")],-1)),at={colspan:"1"},nt=u(()=>t("td",{colspan:"1"},null,-1)),lt=u(()=>t("td",{colspan:"2"},[t("div",null,"SSS Contribution:")],-1)),ot=u(()=>t("td",{colspan:"1"},[t("div",null,"Days Worked:")],-1)),st={colspan:"1"},it=u(()=>t("td",{colspan:"2"},[t("div",null,"PhilHealth Contribution:")],-1)),rt=u(()=>t("td",null,[t("div")],-1)),ct=u(()=>t("td",{colspan:"2"},[t("div")],-1)),dt=u(()=>t("td",{colspan:"2"},[t("div",null,"Pag-IBIG Contribution:")],-1)),ut=u(()=>t("tr",null,[t("td",{colspan:"3"},[t("br")]),t("td",{colspan:"3"},[t("br")])],-1)),_t=u(()=>t("tr",null,[t("td",{colspan:"3"},[t("div")]),t("td",{colspan:"2"},[t("div",null,"SSS Calamity Loan:")]),t("td",null,[t("div",null,"---")])],-1)),pt=u(()=>t("tr",null,[t("td",{colspan:"3"},[t("div")]),t("td",{colspan:"2"},[t("div",null,"SSS Loan:")]),t("td",null,[t("div",null,"---")])],-1)),mt=u(()=>t("tr",null,[t("td",{colspan:"3"},[t("div")]),t("td",{colspan:"2"},[t("div",null,"Pag-IBIG Loan:")]),t("td",null,[t("div",null,"---")])],-1)),ht=u(()=>t("tr",null,[t("td",{colspan:"3"},[t("br")]),t("td",{colspan:"3"},[t("br")])],-1)),gt=u(()=>t("td",{colspan:"2"},"Total Gross Income:",-1)),bt=u(()=>t("td",{colspan:"2"},"Total Deductions:",-1)),ft=u(()=>t("td",{colspan:"3"},null,-1)),yt=u(()=>t("td",{colspan:"2"},"Total Net Pay:",-1)),wt={__name:"PayslipPage",setup(a){const e=A();e.currentPage="Payslip";const n=Q(),o=U();n.fetchAttendanceReports();function s(i){var d=i.toString().match(/^-?\d+(?:\.\d{0,2})?/)[0];return parseFloat(d)}function l(i){var d,_,m,b,f,h,g,y,w;return((_=(d=i.emp_sss_contrib_audit[0])==null?void 0:d.amount)!=null?_:0)+((b=(m=i.emp_philhealth_contrib_audit[0])==null?void 0:m.amount)!=null?b:0)+((h=(f=i.emp_pagibig_contrib_audit[0])==null?void 0:f.amount)!=null?h:0)+((g=i.sssCalamityLoan)!=null?g:0)+((y=i.sssLoan)!=null?y:0)+((w=i.pagIbigLoan)!=null?w:0)}function c(i){try{return s(o.grossIncomeFormatter(i.rate_per_day,i.attendance)-l(i))}catch(d){return console.error("Error calculating payroll:",d),i}}return(i,d)=>(T(),W("div",null,[t("div",$,[j,t("div",q,[t("div",z,p(i.model),1),Y])]),t("table",J,[t("tr",K,[t("td",null,[t("div",null,[v(R,{rounded:"",standout:"","use-input":"",modelValue:r(n).selectedDate,"onUpdate:modelValue":[d[0]||(d[0]=_=>r(n).selectedDate=_),d[1]||(d[1]=_=>r(n).fetchAttendanceReports())],options:r(n).selectedDateOptions,"option-label":_=>_.date_start+" "+_.date_end,"hide-selected":"","fill-input":"","hide-bottom-space":"","input-debounce":"0",class:"!tw-pb-0"},{"no-option":S(()=>[v(H,null,{default:S(()=>[v(M,{class:"text-grey"},{default:S(()=>[E(" No results ")]),_:1})]),_:1})]),_:1},8,["modelValue","options","option-label"])])]),X,t("td",Z,p(r(n).rows[0].last_name)+", "+p(r(n).rows[0].first_name)+" "+p(r(n).rows[0].middle_name),1)])]),v(k,{separator:"cell",class:"tw-rounded-3xl tw-w-6/12 tw-mx-auto tw-mb-3 tw-bg-white tw-shadow-lg"},{default:S(()=>{var _,m,b,f,h,g,y,w,I,P,x,C;return[tt,t("tbody",null,[t("tr",null,[et,t("td",at,[t("div",null,"\u20B1"+p(r(n).rows[0].rate_per_day),1)]),nt,lt,t("td",null,[t("div",null," \u20B1 "+p((f=(b=(m=(_=r(n).rows[0])==null?void 0:_.emp_sss_contrib_audit)==null?void 0:m[r(n).rows[0].emp_sss_contrib_audit.length-1])==null?void 0:b.amount)!=null?f:0),1)])]),t("tr",null,[ot,t("td",st,[t("div",null,p(r(o).noDaysWorkedFormatter(r(n).rows[0].attendance)),1)]),t("td",null," \u20B1"+p(r(o).grossIncomeFormatter(r(n).rows[0].rate_per_day,r(n).rows[0].attendance)),1),it,t("td",null,[t("div",null," \u20B1 "+p((w=(y=(g=(h=r(n).rows[0])==null?void 0:h.emp_philhealth_contrib_audit)==null?void 0:g[r(n).rows[0].emp_philhealth_contrib_audit.length-1])==null?void 0:y.amount)!=null?w:0),1)])]),t("tr",null,[rt,ct,dt,t("td",null,[t("div",null," \u20B1 "+p((C=(x=(P=(I=r(n).rows[0])==null?void 0:I.emp_pagibig_contrib_audit)==null?void 0:P[r(n).rows[0].emp_pagibig_contrib_audit.length-1])==null?void 0:x.amount)!=null?C:0),1)])]),ut,_t,pt,mt,ht,t("tr",null,[gt,t("td",null," \u20B1"+p(r(o).grossIncomeFormatter(r(n).rows[0].rate_per_day,r(n).rows[0].attendance)),1),bt,t("td",null,"\u20B1"+p(l(r(n).rows[0])),1)]),t("tr",null,[ft,yt,t("td",null,"\u20B1"+p(c(r(n).rows[0])),1)])])]}),_:1})]))}};var Ft=N(wt,[["__scopeId","data-v-0027abc0"]]);export{Ft as default};
