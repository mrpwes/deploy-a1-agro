import{u as rt}from"./pageHeader.76fa7086.js";import{at as ae,au as R,k as it,r as U,j as k,h as Re,I as ut,p as I,t as ct,ax as dt,T as mt,S as K,Q as q,i as ft,ai as ht,o as Q,c as fe,d as p,n as pt,w as v,aA as gt,e as y,a as S,a8 as F,f as $,a7 as X,aa as yt,G as he}from"./index.c0f9d41d.js";import{Q as ne}from"./QInput.5bafdbfb.js";import{Q as N}from"./QTd.2ad6e5e1.js";import{h as z,g as pe,Q as ge}from"./position-engine.24d5c4ea.js";import{Q as ye}from"./QSelect.06471d4e.js";import{Q as _e}from"./QTable.773d47ad.js";import{u as _t}from"./globalNotification.774fdc7b.js";import{T as vt}from"./TouchPan.44ec56ab.js";import{b as wt,u as bt}from"./focus-manager.90a99338.js";import{a as Dt,h as St,i as At}from"./use-key-composition.d0293a0f.js";import{u as Oe,a as Tt,b as Ct,g as xt,Q as qe}from"./QPopupProxy.546b63db.js";import{_ as me,f as Ht}from"./date.99dbe89d.js";import{C as G,Q as $e}from"./ClosePopup.7d22d6d7.js";import{Q as Et}from"./QForm.fe34396f.js";import{Q as It}from"./QDialog.7c9c19ff.js";import{Q as Ce}from"./QTr.49fd6e8b.js";import"./QList.0b4dd11e.js";const Ne=ae("attendanceTable",{state:()=>({rows:[],selectedDate:null,selectedDateOptions:null,attendanceColumns:{columns:[]}}),getters:{getSelectedDate(){return this.selectedDate}},actions:{convertDecimalToTime(e){const t=Math.floor(e),a=Math.round((e-t)*60);return`${t}:${a}`},calculateTotalHours(e){const t=new Date;if(new Date(e.date)>=t)return"N/A";var n;if(e.time_out===null&&e.time_in!==null)n="No Time Out";else if(e.attendance_type_id!==1&&e.attendance_type_id!==void 0)n=capitalizeFirstLetterOfEachWord(e.attendance_type.attendance_type_name);else{var d=new Date(e.time_in),l=new Date(e.time_out);console.log(d,l);const r=new Date(d);r.setHours(8,0,0,0),d<r&&(d=r);const w=new Date(l);w.setHours(17,0,0,0),l>w&&(l=w);const h=new Date(l);h.setHours(13,0,0,0);const g=new Date(l);return g.setHours(12,0,0,0),l>h&&d<g&&(l=new Date(l.getTime()-36e5)),(l-d)/1e3/60/60}return n},capitalizeFirstLetterOfEachWord(e){return e.split(" ").map(t=>t.charAt(0).toUpperCase()+t.slice(1)).join(" ")},formatDate(e){const t=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0"),n=String(e.getDate()).padStart(2,"0");return`${t}-${a}-${n}`},getAndCheckDateRangesForCurrentMonth(){const e=new Date,t=e.getFullYear(),a=e.getMonth(),n=new Date(t,a,1),d=new Date(t,a,15),l=new Date(t,a,16),r=new Date(t,a+1,0),w={firstHalf:{start:this.formatDate(n),end:this.formatDate(d)},secondHalf:{start:this.formatDate(l),end:this.formatDate(r)}},h=this.formatDate(e),g=new Date(w.firstHalf.start),f=new Date(w.firstHalf.end),m=new Date(w.secondHalf.start),i=new Date(w.secondHalf.end);let c,s;return e>=g&&e<=f?(c=this.formatDate(g),s=this.formatDate(f)):e>=m&&e<=i?(c=this.formatDate(m),s=this.formatDate(i)):(c="out of range",s="out of range"),{todayDate:h,startDate:c,endDate:s}},async getSalaryHistory(){try{const{data:e,error:t}=await R.from("salary_history").select();t&&console.error(t),this.selectedDateOptions=e.sort((a,n)=>new Date(a.date_start)-new Date(n.date_start))}catch(e){console.error(e)}},fillMissingDates(e,t,a){console.log("FILLING MISSING DATES"+t+" "+a);const n=r=>{const w=r.getFullYear(),h=String(r.getMonth()+1).padStart(2,"0"),g=String(r.getDate()).padStart(2,"0");return`${w}-${h}-${g}`},d=new Date(t),l=new Date(a);return l.setDate(l.getDate()+1),e.forEach(r=>{const w=new Set(r.attendance.map(h=>h.date));for(let h=new Date(d);h<=l;h.setDate(h.getDate()+1)){const g=n(h);w.has(g)||r.attendance.push({id:null,date:g,employee:{first_name:r.first_name,last_name:r.first_name},remarks:null,time_in:null,time_out:null,employee_id:r.id,adjustment_salary_id:null})}r.attendance.sort((h,g)=>new Date(h.date)-new Date(g.date))}),e},calculateTotalAttendanceHours(e){let t=0;return e.forEach(n=>{if(n.time_in&&n.time_out){const d=new Date(n.time_in);t+=(new Date(n.time_out)-d)/(1e3*60)}}),t/60},async fetchAttendanceInRange(e=this.selectedDate.date_start,t=this.selectedDate.date_end){try{const{data:a,error:n}=await R.from("employee").select(`*,
             is_archive,
              attendance(*, attendance_type(*), employee(first_name, last_name, company_employee_id))`).gte("attendance.date",e).lte("attendance.date",t).eq("is_archive",!1);n&&console.error(n),this.rows=Object.values(this.fillMissingDates(a,e,t))}catch(a){console.error(a)}},columns(e=this.selectedDate.date_start,t=this.selectedDate.date_end){const a=new Date(e),n=new Date(t),d=[],l={day:"numeric",month:"numeric"},r=["S","M","T","W","TH","F","S"];for(let h=new Date(a);h<=n;h.setDate(h.getDate()+1)){h.getDate();const g=new Intl.DateTimeFormat("en-US",l).format(h),f=h.getDay(),m=`${g} ${r[f]}`;d.push((()=>({name:"actions",align:"center",label:`${m}`,sortable:!0}))())}const w=[{name:"employeeName",align:"center",label:"Name",sortable:!0,field:h=>h.company_employee_id+" - "+h.last_name+", "+h.first_name,format:h=>`${h}`},...d,{name:"totalHours",align:"center",label:"Total Hours",sortable:!0,field:h=>{let g=0;return h.attendance.forEach(m=>{if(m.time_out===null&&m.time_in!==null)g+=0;else if(m.attendance_type_id!==1&&m.attendance_type_id!==void 0)g+=480;else if(m.time_in&&m.time_out){const i=new Date(m.time_in),c=new Date(m.time_out),s=new Date(i);s.setHours(8,0,0,0),i<s&&i.setHours(8,0,0,0);const b=new Date(c);b.setHours(17,0,0,0),c>b&&c.setHours(17,0,0,0);let T=(c-i)/(1e3*60);const C=new Date(c);C.setHours(13,0,0,0),c>C&&(T-=60),g+=T}}),(g/60).toFixed(2)}},{name:"totalAbsent",align:"center",label:"A",sortable:!0,field:h=>{let g=0;const f=new Date;for(let m=0;m<h.attendance.length;m++)new Date(h.attendance[m].date)<=f&&(!h.attendance[m].time_in||!h.attendance[m].time_out)&&g++;return g}},{name:"totalLeave",align:"center",label:"LVE",field:h=>{let g=0;for(let f=0;f<h.attendance.length;f++)h.attendance[f].attendance_type_id==2&&g++;return g}}];this.attendanceColumns.columns.push(...w)},getNearestDateRange(){if(this.selectedDate!=null)return;const e=new Date;function t(l){return new Date(l)}function a(l){return Math.abs(e-l)}let n=null,d=1/0;for(const l of this.selectedDateOptions){const r=t(l.date_start),w=t(l.date_end),h=a(r),g=a(w),f=Math.min(h,g);f<d&&(d=f,n=l)}this.selectedDate=n},async fetchAttendanceReports(){this.attendanceColumns.columns=[],await this.getSalaryHistory(),this.getNearestDateRange(),this.columns(),this.fetchAttendanceInRange()}}}),Pe=_t(),Mt=Ne(),Le=ae("reportsViewAttendanceTable",{state:()=>({attendanceID:null,attendanceDate:null,attendanceRemarks:null,attendanceTimeIn:null,attendanceTimeInProxy:null,attendanceTimeOut:null,attendanceTimeOutProxy:null,attendanceEmployeeID:null,attendanceType:null,attendanceAdjustmentSalaryID:null,listOfAttendanceType:[],listOfAdjustmentSalary:[],hourOptions:[8,9,10,11,12,13,14,15,16,17],is_editing:!1}),getters:{getIsEditing(e){return e.is_editing},getFormattedTimeIn(e){if(e.attendanceTimeOut===null)return null;const t=new Date(e.attendanceTimeIn);let a=t.getHours();const n=t.getMinutes(),d=a>=12?"PM":"AM";a=a%12,a=a||12;const l=n<10?"0"+n:n;return`${a}:${l} ${d}`},getFormattedTimeOut(e){if(e.attendanceTimeOut===null)return null;const t=new Date(e.attendanceTimeOut);let a=t.getHours();const n=t.getMinutes(),d=a>=12?"PM":"AM";a=a%12,a=a||12;const l=n<10?"0"+n:n;return`${a}:${l} ${d}`}},actions:{updateProxy(e){e==!0?this.attendanceTimeInProxy=this.attendanceTimeIn:this.attendanceTimeOutProxy=this.attendanceTimeOut},saveProxy(e){e==!0?this.attendanceTimeIn=this.attendanceTimeInProxy:this.attendanceTimeOut=this.attendanceTimeOutProxy},async fetchAttendanceTable(){const{data:e,error:t}=await R.from("attendance").select("*").eq("id");if(t)console.log(t);else return e},async fetchAttendanceType(){const{data:e,error:t}=await R.from("attendance_type").select("*");t?console.log(t):this.listOfAttendanceType=e},async fetchAdjustmentSalary(){const{data:e,error:t}=await R.from("adjustment_salary").select("*");t?console.log(t):this.listOfAdjustmentSalary=e},async updateAttendance(){const{error:e}=await R.from("attendance").update({date:this.attendanceDate,remarks:this.attendanceRemarks,time_in:this.attendanceTimeIn,time_out:this.attendanceTimeOut,employee_id:this.attendanceEmployeeID,attendance_type_id:this.attendanceType,adjustment_salary_id:this.attendanceAdjustmentSalaryID}).eq("id",this.attendanceID);e?Pe.showErrorNotification("Failed to update attendance"):(Mt.fetchAttendanceReports(),Pe.showSuccessNotification("Attendance updated successfully"),this.is_editing=!1)},resetForm(){this.attendanceID=null,this.attendanceDate=null,this.attendanceRemarks=null,this.attendanceTimeIn=null,this.attendanceTimeInProxy=null,this.attendanceTimeOut=null,this.attendanceTimeOutProxy=null,this.attendanceEmployeeID=null,this.attendanceType=null,this.attendanceAdjustmentSalaryID=null,this.is_editing=!1}}});function kt(e,t){if(e.hour!==null){if(e.minute===null)return"minute";if(t===!0&&e.second===null)return"second"}return"hour"}function Rt(){const e=new Date;return{hour:e.getHours(),minute:e.getMinutes(),second:e.getSeconds(),millisecond:e.getMilliseconds()}}var Ve=it({name:"QTime",props:{...wt,...Dt,...Oe,modelValue:{required:!0,validator:e=>typeof e=="string"||e===null},mask:{...Oe.mask,default:null},format24h:{type:Boolean,default:null},defaultDate:{type:String,validator:e=>/^-?[\d]+\/[0-1]\d\/[0-3]\d$/.test(e)},options:Function,hourOptions:Array,minuteOptions:Array,secondOptions:Array,withSeconds:Boolean,nowBtn:Boolean},emits:Tt,setup(e,{slots:t,emit:a}){const n=ct(),{$q:d}=n.proxy,l=bt(e,d),{tabindex:r,headerClass:w,getLocale:h,getCurrentDate:g}=Ct(e,d),f=St(e),m=At(f);let i,c;const s=U(null),b=k(()=>Ye()),T=k(()=>h()),C=k(()=>We()),O=me(e.modelValue,b.value,T.value,e.calendar,C.value),A=U(kt(O)),_=U(O),E=U(O.hour===null||O.hour<12),L=k(()=>`q-time q-time--${e.landscape===!0?"landscape":"portrait"}`+(l.value===!0?" q-time--dark q-dark":"")+(e.disable===!0?" disabled":e.readonly===!0?" q-time--readonly":"")+(e.bordered===!0?" q-time--bordered":"")+(e.square===!0?" q-time--square no-border-radius":"")+(e.flat===!0?" q-time--flat no-shadow":"")),Y=k(()=>{const o=_.value;return{hour:o.hour===null?"--":V.value===!0?z(o.hour):String(E.value===!0?o.hour===0?12:o.hour:o.hour>12?o.hour-12:o.hour),minute:o.minute===null?"--":z(o.minute),second:o.second===null?"--":z(o.second)}}),V=k(()=>e.format24h!==null?e.format24h:d.lang.date.format24h),ve=k(()=>{const o=A.value==="hour",u=o===!0?12:60,D=_.value[A.value];let M=`rotate(${Math.round(D*(360/u))-180}deg) translateX(-50%)`;return o===!0&&V.value===!0&&_.value.hour>=12&&(M+=" scale(.7)"),{transform:M}}),xe=k(()=>_.value.hour!==null),je=k(()=>xe.value===!0&&_.value.minute!==null),J=k(()=>e.hourOptions!==void 0?o=>e.hourOptions.includes(o):e.options!==void 0?o=>e.options(o,null,null):null),le=k(()=>e.minuteOptions!==void 0?o=>e.minuteOptions.includes(o):e.options!==void 0?o=>e.options(_.value.hour,o,null):null),oe=k(()=>e.secondOptions!==void 0?o=>e.secondOptions.includes(o):e.options!==void 0?o=>e.options(_.value.hour,_.value.minute,o):null),B=k(()=>{if(J.value===null)return null;const o=re(0,11,J.value),u=re(12,11,J.value);return{am:o,pm:u,values:o.values.concat(u.values)}}),Z=k(()=>le.value!==null?re(0,59,le.value):null),ee=k(()=>oe.value!==null?re(0,59,oe.value):null),se=k(()=>{switch(A.value){case"hour":return B.value;case"minute":return Z.value;case"second":return ee.value}}),Be=k(()=>{let o,u,D=0,H=1;const M=se.value!==null?se.value.values:void 0;A.value==="hour"?V.value===!0?(o=0,u=23):(o=0,u=11,E.value===!1&&(D=12)):(o=0,u=55,H=5);const j=[];for(let x=o,P=o;x<=u;x+=H,P++){const W=x+D,ot=M!==void 0&&M.includes(W)===!1,st=A.value==="hour"&&x===0?V.value===!0?"00":"12":x;j.push({val:W,index:P,disable:ot,label:st})}return j}),Qe=k(()=>[[vt,Ke,void 0,{stop:!0,prevent:!0,mouse:!0}]]);Re(()=>e.modelValue,o=>{const u=me(o,b.value,T.value,e.calendar,C.value);(u.dateHash!==_.value.dateHash||u.timeHash!==_.value.timeHash)&&(_.value=u,u.hour===null?A.value="hour":E.value=u.hour<12)}),Re([b,T],()=>{ft(()=>{Te()})});function He(){const o={...g(),...Rt()};Te(o),Object.assign(_.value,o),A.value="hour"}function re(o,u,D){const H=Array.apply(null,{length:u+1}).map((M,j)=>{const x=j+o;return{index:x,val:D(x)===!0}}).filter(M=>M.val===!0).map(M=>M.index);return{min:H[0],max:H[H.length-1],values:H,threshold:u+1}}function Ee(o,u,D){const H=Math.abs(o-u);return Math.min(H,D-H)}function we(o,{min:u,max:D,values:H,threshold:M}){if(o===u)return u;if(o<u||o>D)return Ee(o,u,M)<=Ee(o,D,M)?u:D;const j=H.findIndex(W=>o<=W),x=H[j-1],P=H[j];return o-x<=P-o?x:P}function Ye(){return e.calendar!=="persian"&&e.mask!==null?e.mask:`HH:mm${e.withSeconds===!0?":ss":""}`}function We(){if(typeof e.defaultDate!="string"){const o=g(!0);return o.dateHash=xt(o),o}return me(e.defaultDate,"YYYY/MM/DD",void 0,e.calendar)}function be(){return ht(n)===!0||se.value!==null&&(se.value.values.length===0||A.value==="hour"&&V.value!==!0&&B.value[E.value===!0?"am":"pm"].values.length===0)}function De(){const o=s.value,{top:u,left:D,width:H}=o.getBoundingClientRect(),M=H/2;return{top:u+M,left:D+M,dist:M*.7}}function Ke(o){if(be()!==!0){if(o.isFirst===!0){i=De(),c=ie(o.evt,i);return}c=ie(o.evt,i,c),o.isFinal===!0&&(i=!1,c=null,Ie())}}function Ie(){A.value==="hour"?A.value="minute":e.withSeconds&&A.value==="minute"&&(A.value="second")}function ie(o,u,D){const H=dt(o),M=Math.abs(H.top-u.top),j=Math.sqrt(Math.pow(Math.abs(H.top-u.top),2)+Math.pow(Math.abs(H.left-u.left),2));let x,P=Math.asin(M/j)*(180/Math.PI);if(H.top<u.top?P=u.left<H.left?90-P:270+P:P=u.left<H.left?P+90:270-P,A.value==="hour"){if(x=P/30,B.value!==null){const W=V.value!==!0?E.value===!0:B.value.am.values.length!==0&&B.value.pm.values.length!==0?j>=u.dist:B.value.am.values.length!==0;x=we(x+(W===!0?0:12),B.value[W===!0?"am":"pm"])}else x=Math.round(x),V.value===!0?j<u.dist?x<12&&(x+=12):x===12&&(x=0):E.value===!0&&x===12?x=0:E.value===!1&&x!==12&&(x+=12);V.value===!0&&(E.value=x<12)}else x=Math.round(P/6)%60,A.value==="minute"&&Z.value!==null?x=we(x,Z.value):A.value==="second"&&ee.value!==null&&(x=we(x,ee.value));return D!==x&&at[A.value](x),x}const Se={hour(){A.value="hour"},minute(){A.value="minute"},second(){A.value="second"}};function ze(o){o.keyCode===13&&Me()}function Ge(o){o.keyCode===13&&ke()}function Xe(o){be()!==!0&&(d.platform.is.desktop!==!0&&ie(o,De()),Ie())}function Je(o){be()!==!0&&ie(o,De())}function Ze(o){if(o.keyCode===13)A.value="hour";else if([37,39].includes(o.keyCode)){const u=o.keyCode===37?-1:1;if(B.value!==null){const D=V.value===!0?B.value.values:B.value[E.value===!0?"am":"pm"].values;if(D.length===0)return;if(_.value.hour===null)ue(D[0]);else{const H=(D.length+D.indexOf(_.value.hour)+u)%D.length;ue(D[H])}}else{const D=V.value===!0?24:12,H=V.value!==!0&&E.value===!1?12:0,M=_.value.hour===null?-u:_.value.hour;ue(H+(24+M+u)%D)}}}function et(o){if(o.keyCode===13)A.value="minute";else if([37,39].includes(o.keyCode)){const u=o.keyCode===37?-1:1;if(Z.value!==null){const D=Z.value.values;if(D.length===0)return;if(_.value.minute===null)ce(D[0]);else{const H=(D.length+D.indexOf(_.value.minute)+u)%D.length;ce(D[H])}}else{const D=_.value.minute===null?-u:_.value.minute;ce((60+D+u)%60)}}}function tt(o){if(o.keyCode===13)A.value="second";else if([37,39].includes(o.keyCode)){const u=o.keyCode===37?-1:1;if(ee.value!==null){const D=ee.value.values;if(D.length===0)return;if(_.value.seconds===null)de(D[0]);else{const H=(D.length+D.indexOf(_.value.second)+u)%D.length;de(D[H])}}else{const D=_.value.second===null?-u:_.value.second;de((60+D+u)%60)}}}function ue(o){_.value.hour!==o&&(_.value.hour=o,te())}function ce(o){_.value.minute!==o&&(_.value.minute=o,te())}function de(o){_.value.second!==o&&(_.value.second=o,te())}const at={hour:ue,minute:ce,second:de};function Me(){E.value===!1&&(E.value=!0,_.value.hour!==null&&(_.value.hour-=12,te()))}function ke(){E.value===!0&&(E.value=!1,_.value.hour!==null&&(_.value.hour+=12,te()))}function Ae(o){const u=e.modelValue;A.value!==o&&u!==void 0&&u!==null&&u!==""&&typeof u!="string"&&(A.value=o)}function te(){if(J.value!==null&&J.value(_.value.hour)!==!0){_.value=me(),Ae("hour");return}if(le.value!==null&&le.value(_.value.minute)!==!0){_.value.minute=null,_.value.second=null,Ae("minute");return}if(e.withSeconds===!0&&oe.value!==null&&oe.value(_.value.second)!==!0){_.value.second=null,Ae("second");return}_.value.hour===null||_.value.minute===null||e.withSeconds===!0&&_.value.second===null||Te()}function Te(o){const u=Object.assign({..._.value},o),D=e.calendar==="persian"?z(u.hour)+":"+z(u.minute)+(e.withSeconds===!0?":"+z(u.second):""):Ht(new Date(u.year,u.month===null?null:u.month-1,u.day,u.hour,u.minute,u.second,u.millisecond),b.value,T.value,u.year,u.timezoneOffset);u.changed=D!==e.modelValue,a("update:modelValue",D,u)}function nt(){const o=[I("div",{class:"q-time__link "+(A.value==="hour"?"q-time__link--active":"cursor-pointer"),tabindex:r.value,onClick:Se.hour,onKeyup:Ze},Y.value.hour),I("div",":"),I("div",xe.value===!0?{class:"q-time__link "+(A.value==="minute"?"q-time__link--active":"cursor-pointer"),tabindex:r.value,onKeyup:et,onClick:Se.minute}:{class:"q-time__link"},Y.value.minute)];e.withSeconds===!0&&o.push(I("div",":"),I("div",je.value===!0?{class:"q-time__link "+(A.value==="second"?"q-time__link--active":"cursor-pointer"),tabindex:r.value,onKeyup:tt,onClick:Se.second}:{class:"q-time__link"},Y.value.second));const u=[I("div",{class:"q-time__header-label row items-center no-wrap",dir:"ltr"},o)];return V.value===!1&&u.push(I("div",{class:"q-time__header-ampm column items-between no-wrap"},[I("div",{class:"q-time__link "+(E.value===!0?"q-time__link--active":"cursor-pointer"),tabindex:r.value,onClick:Me,onKeyup:ze},"AM"),I("div",{class:"q-time__link "+(E.value!==!0?"q-time__link--active":"cursor-pointer"),tabindex:r.value,onClick:ke,onKeyup:Ge},"PM")])),I("div",{class:"q-time__header flex flex-center no-wrap "+w.value},u)}function lt(){const o=_.value[A.value];return I("div",{class:"q-time__content col relative-position"},[I(mt,{name:"q-transition--scale"},()=>I("div",{key:"clock"+A.value,class:"q-time__container-parent absolute-full"},[I("div",{ref:s,class:"q-time__container-child fit overflow-hidden"},[K(I("div",{class:"q-time__clock cursor-pointer non-selectable",onClick:Xe,onMousedown:Je},[I("div",{class:"q-time__clock-circle fit"},[I("div",{class:"q-time__clock-pointer"+(_.value[A.value]===null?" hidden":e.color!==void 0?` text-${e.color}`:""),style:ve.value}),Be.value.map(u=>I("div",{class:`q-time__clock-position row flex-center q-time__clock-pos-${u.index}`+(u.val===o?" q-time__clock-position--active "+w.value:u.disable===!0?" q-time__clock-position--disable":"")},[I("span",u.label)]))])]),Qe.value)])])),e.nowBtn===!0?I(q,{class:"q-time__now-button absolute",icon:d.iconSet.datetime.now,unelevated:!0,size:"sm",round:!0,color:e.color,textColor:e.textColor,tabindex:r.value,onClick:He}):null])}return n.proxy.setNow=He,()=>{const o=[lt()],u=ut(t.default);return u!==void 0&&o.push(I("div",{class:"q-time__actions"},u)),e.name!==void 0&&e.disable!==!0&&m(o,"push"),I("div",{class:L.value,tabindex:-1},[nt(),I("div",{class:"q-time__main col overflow-auto"},o)])}}});const Ot={key:0,class:"!tw-h-min !tw-w-4/12 !tw-max-w-full tw-bg-white tw-p-6"},qt={class:"tw-grid tw-gap-7"},$t={class:"tw-text-3xl tw-font-extrabold tw-flex tw-justify-between"},Pt={class:"tw-flex tw-justify-between"},Vt={class:"row items-center justify-end q-gutter-sm"},Ft={class:"row items-center justify-end q-gutter-sm"},Nt={key:1},Lt={__name:"ViewAttendance",props:["rows","column","columns","qBtnLabel","qBtnClass"],setup(e){const t=Le(),a=U(!1),n=U(null),d=U(null),l=U(null);function r(f,m,i){d.value=w(i,m),n.value=f.row.attendance[d.value-1],a.value=!0,l.value=h(n),console.log(l.value),t.attendanceID=n.value.id,t.attendanceDate=n.value.date,t.attendanceRemarks=n.value.remarks,t.attendanceTimeIn=n.value.time_in,t.attendanceTimeOut=n.value.time_out,t.attendanceEmployeeID=n.value.employee_id,t.attendanceType=n.value.attendance_type_id,t.attendanceAdjustmentSalaryID=n.value.adjustment_salary_id}function w(f,m){return f.findIndex(i=>i.name===m.name&&i.align===m.align&&i.label===m.label&&i.sortable===m.sortable&&i.__iconClass===m.__iconClass&&i.__thClass===m.__thClass)}function h(f){const m=new Date;if(new Date(f.date)>=m)return"N/A";let c;const s=f.time_in?new Date(f.time_in):null,b=f.time_out?new Date(f.time_out):null;if(b===null&&s!==null)return"No Time Out";if(f.attendance_type_id!==1&&f.attendance_type_id!==void 0)return g(f.attendance_type.attendance_type_name);if(s){const T=new Date(s);T.setHours(8,0,0,0),s<T&&s.setHours(8,0,0,0)}if(b){const T=new Date(b);if(T.setHours(17,0,0,0),b>T&&b.setHours(17,0,0,0),s&&b){c=((b-s)/(1e3*60*60)).toFixed(2);const C=new Date(b);C.setHours(13,0,0,0),b>C&&(c=(parseFloat(c)-1).toFixed(2))}else c="No Time Out"}else c="No Time Out";return c}function g(f){return f.replace(/\b\w/g,m=>m.toUpperCase())}return(f,m)=>(Q(),fe(yt,null,[p(q,{unelevated:"",padding:"none",label:e.qBtnLabel,onClick:m[0]||(m[0]=i=>r(e.rows,e.column,e.columns)),class:pt(e.qBtnClass)},null,8,["label","class"]),p(It,{modelValue:a.value,"onUpdate:modelValue":m[10]||(m[10]=i=>a.value=i),persistent:""},{default:v(()=>[n.value.id!=null&&n.value.attendance_type_id==1?(Q(),fe("div",Ot,[p(Et,{onSubmit:m[9]||(m[9]=gt(i=>y(t).updateAttendance(),["prevent"]))},{default:v(()=>[S("div",qt,[S("div",$t,[S("div",null,"Attendance ID: "+F(n.value.id),1),S("div",null,F(e.column.label),1)]),S("div",null," Employee: "+F(n.value.employee.company_employee_id)+" - "+F(n.value.employee.last_name)+", "+F(n.value.employee.first_name),1),S("div",null,[$(" Remarks: "),p(ne,{rounded:"",standout:"bg-teal text-white",modelValue:y(t).attendanceRemarks,"onUpdate:modelValue":m[1]||(m[1]=i=>y(t).attendanceRemarks=i),type:"textarea",autogrow:"",disable:!y(t).is_editing},null,8,["modelValue","disable"])]),S("div",Pt,[S("div",null,[$(" Time In: "),p(q,{rounded:"",standout:"bg-teal text-white",icon:"access_time",label:y(t).getFormattedTimeIn,disable:!y(t).is_editing},{default:v(()=>[p(qe,{onBeforeShow:m[4]||(m[4]=i=>y(t).updateProxy(f.isTimeIn=!0)),cover:"","transition-show":"scale","transition-hide":"scale"},{default:v(()=>[p(Ve,{modelValue:y(t).attendanceTimeInProxy,"onUpdate:modelValue":m[3]||(m[3]=i=>y(t).attendanceTimeInProxy=i),mask:"YYYY-MM-DDTHH:mm:ss","hour-options":y(t).hourOptions},{default:v(()=>[S("div",Vt,[K(p(q,{label:"Cancel",color:"primary",flat:""},null,512),[[G]]),K(p(q,{label:"OK",color:"primary",flat:"",onClick:m[2]||(m[2]=i=>y(t).saveProxy(f.isTimeIn=!0))},null,512),[[G]])])]),_:1},8,["modelValue","hour-options"])]),_:1})]),_:1},8,["label","disable"])]),S("div",null,[$(" Time Out: "),p(q,{rounded:"",standout:"bg-teal text-white",icon:"access_time",label:y(t).getFormattedTimeOut,disable:!y(t).is_editing},{default:v(()=>[p(qe,{onBeforeShow:m[7]||(m[7]=i=>y(t).updateProxy(f.isTimeIn=!1)),cover:"","transition-show":"scale","transition-hide":"scale"},{default:v(()=>[p(Ve,{modelValue:y(t).attendanceTimeOutProxy,"onUpdate:modelValue":m[6]||(m[6]=i=>y(t).attendanceTimeOutProxy=i),mask:"YYYY-MM-DDTHH:mm:ss","hour-options":y(t).hourOptions},{default:v(()=>[S("div",Ft,[K(p(q,{label:"Cancel",color:"primary",flat:""},null,512),[[G]]),K(p(q,{label:"OK",color:"primary",flat:"",onClick:m[5]||(m[5]=i=>y(t).saveProxy(f.isTimeIn=!1))},null,512),[[G]])])]),_:1},8,["modelValue","hour-options"])]),_:1})]),_:1},8,["label","disable"])])])]),p($e,{align:"right",class:"text-primary noPrint"},{default:v(()=>[y(t).is_editing==!1?(Q(),X(q,{key:0,flat:"",class:"tw-bg-green-400",icon:y(t).is_editing?"save":"edit",label:y(t).is_editing?"Save":"Edit",onClick:m[8]||(m[8]=i=>y(t).is_editing=!0)},null,8,["icon","label"])):(Q(),X(q,{key:1,flat:"",type:"submit",class:"tw-bg-green-400",icon:y(t).is_editing?"save":"edit",label:y(t).is_editing?"Save":"Edit"},null,8,["icon","label"])),K(p(q,{flat:"",label:"CLOSE",onClick:y(t).resetForm},null,8,["onClick"]),[[G]])]),_:1})]),_:1})])):(Q(),fe("div",Nt,[$(F(n.value)+" ",1),p($e,{align:"right",class:"text-primary noPrint"},{default:v(()=>[K(p(q,{flat:"",label:"Cancel"},null,512),[[G]])]),_:1})]))]),_:1},8,["modelValue"])],64))}},Ut=S("div",{class:"tw-text-xl, tw-font-bold"},"Attendance Report",-1),jt=S("div",{class:"tw-w-3"},null,-1),Bt=S("div",{class:"tw-flex tw-items-center tw-ml-5"},[S("div",{class:"tw-flex tw-items-center tw-mr-3"},[S("div",{class:"tw-rounded-lg tw-w-3 tw-h-6 !tw-bg-[#4ade80]"}),S("div",{class:"tw-ml-2"},"Present")]),S("div",{class:"tw-flex tw-items-center tw-mr-3"},[S("div",{class:"tw-rounded-lg tw-w-3 tw-h-6 !tw-bg-[#f87171]"}),S("div",{class:"tw-ml-2"},"Absent")]),S("div",{class:"tw-flex tw-items-center tw-mr-3"},[S("div",{class:"tw-rounded-lg tw-w-3 tw-h-6 !tw-bg-[#fb923c]"}),S("div",{class:"tw-ml-2"},"Late")]),S("div",{class:"tw-flex tw-items-center tw-mr-3"},[S("div",{class:"tw-rounded-lg tw-w-3 tw-h-6 !tw-bg-[#ec4899]"}),S("div",{class:"tw-ml-2"},"Undertime")]),S("div",{class:"tw-flex tw-items-center tw-mr-3"},[S("div",{class:"tw-rounded-lg tw-w-3 tw-h-6 !tw-bg-[#3b82f6]"}),S("div",{class:"tw-ml-2"},"Leave")]),S("div",{class:"tw-flex tw-items-center tw-mr-3"},[S("div",{class:"tw-rounded-lg tw-w-3 tw-h-6 !tw-bg-[#fef08a]"}),S("div",{class:"tw-ml-2"},"Holiday")])],-1),Qt={__name:"AttendanceTable",setup(e){Le().fetchAttendanceType();const a=Ne(),n=U("");function d(i){const c=document.getElementById(i);let s="";s+=Array.from(c.querySelectorAll("th")).map(Y=>Y.innerText.replace(/arrow_upward/g,"")).join(",")+`
`,Array.from(c.querySelectorAll("tr")).slice(1).forEach(Y=>{s+=Array.from(Y.querySelectorAll("td")).map(ve=>ve.innerText).join(",")+`
`});const C=new Date,O={month:"short",day:"2-digit",year:"numeric"},A=C.toLocaleDateString("en-US",O).replace(",","").replace(/\s+/g,"-"),_=new Blob([s],{type:"text/csv;charset=utf-8;"}),E=URL.createObjectURL(_),L=document.createElement("a");L.setAttribute("href",E),L.setAttribute("download",`Attendance-Report-${A}.csv`),document.body.appendChild(L),L.click(),document.body.removeChild(L),URL.revokeObjectURL(E)}a.fetchAttendanceReports();function l(i,c,s){const b=w(i,c),T=s.row.attendance[b-1];return m(T)}function r(i){return i.replace(/\b\w/g,c=>c.toUpperCase())}function w(i,c){return i.findIndex(s=>s.name===c.name&&s.align===c.align&&s.label===c.label&&s.sortable===c.sortable&&s.__iconClass===c.__iconClass&&s.__thClass===c.__thClass)}function h(i,c,s){const b=w(i,c),T=s.row.attendance[b-1];return g(T)}function g(i){const c=new Date;if(new Date(i.date)>=c)return"N/A";var b;if(i.time_out===null&&i.time_in!==null)b="No Time Out";else if(i.attendance_type_id!==1&&i.attendance_type_id!==void 0)b=r(i.attendance_type.attendance_type_name);else{var T=new Date(i.time_in),C=new Date(i.time_out);console.log(T,C);const O=new Date(T);O.setHours(8,0,0,0),T<O&&(T=O);const A=new Date(C);A.setHours(17,0,0,0),C>A&&(C=A);const _=new Date(C);_.setHours(13,0,0,0);const E=new Date(C);E.setHours(12,0,0,0),C>_&&T<E&&(C=new Date(C.getTime()-36e5));const L=(C-T)/1e3/60/60;return f(L)}return b}function f(i){const c=Math.floor(i),s=Math.round((i-c)*60);return`${c}:${s}`}function m(i){const c=new Date;if(new Date(i.date)>=c)return"N/A";var b,T;if(i.time_out===null&&i.time_in!==null)b="No Time Out",T="!tw-bg-[#e11d48]";else if(i.attendance_type_id!==1&&i.attendance_type_id!==void 0)T="!tw-bg-[#3b82f6]";else{const C=new Date(i.time_in),O=new Date(i.time_out),A=new Date(C);A.setHours(8,0,0,0),C<A&&C.setHours(8,0,0,0);const _=new Date(O);_.setHours(17,0,0,0),O>_&&O.setHours(17,0,0,0),b=((O-C)/(1e3*60*60)).toFixed(2);const E=new Date(O);E.setHours(13,0,0,0),O>E&&(b=(parseFloat(b)-1).toFixed(2));const L=new Date(C);L.setHours(8,10,0,0),parseFloat(b)>=8?T="!tw-bg-[#4ade80]":parseFloat(b)==0?T="!tw-bg-[#f87171]":C>L&&(T="!tw-bg-[#fb923c]",parseFloat(b)<5&&(T="!tw-bg-[#ec4899]"))}return console.log(T+" !tw-w-[50px] !tw-h-[50px] tw-rounded"),T+" !tw-w-[50px] !tw-h-auto tw-rounded"}return(i,c)=>(Q(),X(_e,{id:"attendance-table",class:"tw-border tw-rounded-3xl tw-shadow-lg",flat:"",bordered:"",dense:"",title:"Attendance Report","title-class":["tw-text-xl","tw-font-bold"],filter:n.value,columns:y(a).attendanceColumns.columns,rows:y(a).rows,"rows-per-page-options":[0],separator:"cell","row-key":"name"},{"top-right":v(()=>[p(q,{color:"blue","icon-right":"archive",label:"Export to CSV","no-caps":"",onClick:c[0]||(c[0]=s=>d("attendance-table")),class:"tw-mr-16"}),p(ne,{borderless:"",dense:"",debounce:"300",modelValue:n.value,"onUpdate:modelValue":c[1]||(c[1]=s=>n.value=s),placeholder:"Search"},{append:v(()=>[p(he,{name:"search"})]),_:1},8,["modelValue"])]),"body-cell-actions":v(s=>[p(N,{key:"actions",class:"!tw-w-20 !tw-p-0",props:s},{default:v(()=>[p(Lt,{rows:s,columns:s.cols,qBtnLabel:h(s.cols,s.col,s),qBtnClass:l(s.cols,s.col,s),column:s.col},null,8,["rows","columns","qBtnLabel","qBtnClass","column"])]),_:2},1032,["props"])]),"top-left":v(()=>[Ut,jt,p(ye,{rounded:"",standout:"",modelValue:y(a).selectedDate,"onUpdate:modelValue":[c[2]||(c[2]=s=>y(a).selectedDate=s),c[3]||(c[3]=s=>y(a).fetchAttendanceReports())],"use-input":"","hide-selected":"","fill-input":"","hide-bottom-space":"","input-debounce":"0",options:y(a).selectedDateOptions,"option-label":s=>s.date_start+" "+s.date_end,class:"!tw-pb-0"},{"no-option":v(()=>[p(pe,null,{default:v(()=>[p(ge,{class:"text-grey"},{default:v(()=>[$(" No results ")]),_:1})]),_:1})]),_:1},8,["modelValue","options","option-label"])]),bottom:v(()=>[Bt]),_:1},8,["filter","columns","rows"]))}},Yt=ae("philhealthTable",{state:()=>({rows:[],columns:[{name:"employeeId",required:!0,label:"Emp. Id",field:e=>e.employee.company_employee_id,align:"left",sortable:!0},{name:"employeeName",align:"center",label:"Name",field:e=>e.employee.last_name+" "+e.employee.first_name+" "+e.employee.middle_name,sortable:!0,classes:"!tw-bg-neutral-300"},{name:"philhealthNumber",align:"center",label:"PhilHealth No.",field:e=>e.employee.phil_health_number,sortable:!0,classes:"!tw-bg-neutral-300"},{name:"employeeShare",align:"center",label:"Employee Share",field:e=>e.amount,sortable:!0,classes:"!tw-bg-neutral-300"},{name:"employerShare",align:"center",label:"Employer Share",field:e=>e.amount,sortable:!0,classes:"!tw-bg-neutral-300"}],selectedDate:null,selectedDateOptions:null,employeeIds:[],philhealthAudit:[],philhealthContributionTableAudit:[]}),getters:{getSelectedDate(){return this.selectedDate},getTotalEmployeeShare(){let e=0;return this.philhealthAudit.forEach(t=>{e+=t.amount}),e}},actions:{capitalizeFirstLetterOfEachWord(e){return e.split(" ").map(t=>t.charAt(0).toUpperCase()+t.slice(1)).join(" ")},formatDate(e){const t=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0"),n=String(e.getDate()).padStart(2,"0");return`${t}-${a}-${n}`},getEmployeeIds(e){return e.map(t=>t.employee_id)},getAndCheckDateRangesForCurrentMonth(){const e=new Date,t=e.getFullYear(),a=e.getMonth(),n=new Date(t,a,1),d=new Date(t,a,15),l=new Date(t,a,16),r=new Date(t,a+1,0),w={firstHalf:{start:this.formatDate(n),end:this.formatDate(d)},secondHalf:{start:this.formatDate(l),end:this.formatDate(r)}},h=this.formatDate(e),g=new Date(w.firstHalf.start),f=new Date(w.firstHalf.end),m=new Date(w.secondHalf.start),i=new Date(w.secondHalf.end);let c,s;return e>=g&&e<=f?(c=this.formatDate(g),s=this.formatDate(f)):e>=m&&e<=i?(c=this.formatDate(m),s=this.formatDate(i)):(c="out of range",s="out of range"),{todayDate:h,startDate:c,endDate:s}},async getSalaryHistory(){try{const{data:e,error:t}=await R.from("salary_history").select();t&&console.error(t),this.selectedDateOptions=e.sort((a,n)=>new Date(a.date_start)-new Date(n.date_start))}catch(e){console.error(e)}},filterHighestAuditId(e){const t=e.reduce((a,n)=>{const{employee_id:d,audit_id:l}=n;return(!a[d]||a[d].audit_id<l)&&(a[d]=n),a},{});return Object.values(t)},getHighestAuditId(e){return e.length===0?null:e.reduce((a,n)=>n.audit_id>a.audit_id?n:a)},async fetchEmployeeInRange(e=this.selectedDate.date_end){try{const{data:t,error:a}=await R.from("employee_audit").select("*").lte("change_date",e).eq("is_archive",!1);a&&console.error(a),this.rows=this.filterHighestAuditId(t),this.employeeIds=this.getEmployeeIds(this.rows)}catch(t){console.error(t)}},async fetchPhilhealthContribAudit(e=this.selectedDate.date_end){try{const{data:t,error:a}=await R.from("emp_philhealth_contrib_audit").select("*, employee!emp_philhealth_contrib_audit_employee_id_fkey(last_name, first_name, middle_name, company_employee_id, phil_health_number, is_archive)").lte("change_date",e).eq("employee.is_archive",!1).in("employee_id",this.employeeIds);a&&console.error(a),this.philhealthAudit=this.filterHighestAuditId(t.filter(n=>n.employee!==null))}catch(t){console.error(t)}},async fetchPhilhealthContributionTableAudit(e=this.selectedDate.date_end){try{const{data:t,error:a}=await R.from("philhealth_contribution_table_audit").select("*").lte("change_date",e);a&&console.error(a),this.philhealthContributionTableAudit=this.getHighestAuditId(t)}catch(t){console.error(t)}},getNearestDateRange(){if(this.selectedDate!=null)return;const e=new Date;function t(l){return new Date(l)}function a(l){return Math.abs(e-l)}let n=null,d=1/0;for(const l of this.selectedDateOptions){const r=t(l.date_start),w=t(l.date_end),h=a(r),g=a(w),f=Math.min(h,g);f<d&&(d=f,n=l)}this.selectedDate=n},async fetchEmployeeReports(){await this.getSalaryHistory(),await this.getNearestDateRange(),await this.fetchEmployeeInRange(),await this.fetchPhilhealthContribAudit(),await this.fetchPhilhealthContributionTableAudit()}}}),Wt=S("div",{class:"tw-text-xl, tw-font-bold"},"PhilHealth Report",-1),Kt=S("div",{class:"tw-w-3"},null,-1),zt={__name:"PhilhealthTable",setup(e){const t=Yt(),a=U("");function n(d){const l=document.getElementById(d);let r="";r+=Array.from(l.querySelectorAll("th")).map(b=>b.innerText.replace(/arrow_upward/g,"")).join(",")+`
`,Array.from(l.querySelectorAll("tr")).slice(1).forEach(b=>{r+=Array.from(b.querySelectorAll("td")).map(C=>C.innerText).join(",")+`
`});const g=new Date,f={month:"short",day:"2-digit",year:"numeric"},m=g.toLocaleDateString("en-US",f).replace(",","").replace(/\s+/g,"-"),i=new Blob([r],{type:"text/csv;charset=utf-8;"}),c=URL.createObjectURL(i),s=document.createElement("a");s.setAttribute("href",c),s.setAttribute("download",`Philhealth-Report-${m}.csv`),document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(c)}return t.fetchEmployeeReports(),(d,l)=>(Q(),X(_e,{id:"philhealth-table",class:"tw-border tw-rounded-3xl tw-shadow-lg",flat:"",bordered:"",dense:"",title:"Attendance Report","title-class":["tw-text-xl","tw-font-bold"],filter:a.value,columns:y(t).columns,rows:y(t).philhealthAudit,"rows-per-page-options":[0],separator:"cell","row-key":"name"},{"top-right":v(()=>[p(q,{color:"blue","icon-right":"archive",label:"Export to CSV","no-caps":"",onClick:l[0]||(l[0]=r=>n("philhealth-table")),class:"tw-mr-16"}),p(ne,{borderless:"",dense:"",debounce:"300",modelValue:a.value,"onUpdate:modelValue":l[1]||(l[1]=r=>a.value=r),placeholder:"Search"},{append:v(()=>[p(he,{name:"search"})]),_:1},8,["modelValue"])]),"top-left":v(()=>[Wt,Kt,p(ye,{rounded:"",standout:"",modelValue:y(t).selectedDate,"onUpdate:modelValue":[l[2]||(l[2]=r=>y(t).selectedDate=r),l[3]||(l[3]=r=>y(t).fetchEmployeeReports())],"use-input":"","hide-selected":"","fill-input":"","hide-bottom-space":"","input-debounce":"0",options:y(t).selectedDateOptions,"option-label":r=>r.date_start+" "+r.date_end,class:"!tw-pb-0"},{"no-option":v(()=>[p(pe,null,{default:v(()=>[p(ge,{class:"text-grey"},{default:v(()=>[$(" No results ")]),_:1})]),_:1})]),_:1},8,["modelValue","options","option-label"])]),"bottom-row":v(()=>[p(Ce,null,{default:v(()=>[p(N,{colspan:"3"}),p(N,{class:"tw-text-center"},{default:v(()=>[$(" Total Employee Share: "+F(y(t).getTotalEmployeeShare),1)]),_:1}),p(N,{class:"tw-text-center"},{default:v(()=>[$(" Total Employer Share: "+F(y(t).getTotalEmployeeShare),1)]),_:1})]),_:1})]),bottom:v(()=>[]),_:1},8,["filter","columns","rows"]))}};function Ue(e){var t=e.toString().match(/^-?\d+(?:\.\d{0,2})?/)[0];return parseFloat(t)}function Gt(e,t=30){return Ue(e*t)}function Fe(e){const t=Gt(e);let a,n;return t<=1500?(a=.01,n=Math.min(t,1e4)*a):(a=.02,n=Math.min(t,1e4)*a),Ue(n)}const Xt=ae("pagibigTable",{state:()=>({rows:[],columns:[{name:"employeeId",required:!0,label:"Emp. Id",field:e=>e.employee.company_employee_id,align:"left",sortable:!0},{name:"employeeName",align:"center",label:"Name",field:e=>e.employee.last_name+" "+e.employee.first_name+" "+e.employee.middle_name,sortable:!0,classes:"!tw-bg-neutral-300"},{name:"pagibigNumber",align:"center",label:"Pagibig No.",field:e=>e.employee.pag_ibig_number,sortable:!0,classes:"!tw-bg-neutral-300"},{name:"employeeShare",align:"center",label:"Employee Share",field:e=>e.amount,sortable:!0,classes:"!tw-bg-neutral-300"},{name:"employerShare",align:"center",label:"Employer Share",field:e=>Fe(e.employee.rate_per_day),sortable:!0,classes:"!tw-bg-neutral-300"}],selectedDate:null,selectedDateOptions:null,employeeIds:[],pagibigAudit:[],pagibigContributionTableAudit:[]}),getters:{getSelectedDate(){return this.selectedDate},getTotalEmployerShare(){let e=0;return this.pagibigAudit.forEach(t=>{e+=Fe(t.amount)}),e},getTotalEmployeeShare(){let e=0;return this.pagibigAudit.forEach(t=>{e+=t.amount}),e}},actions:{capitalizeFirstLetterOfEachWord(e){return e.split(" ").map(t=>t.charAt(0).toUpperCase()+t.slice(1)).join(" ")},formatDate(e){const t=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0"),n=String(e.getDate()).padStart(2,"0");return`${t}-${a}-${n}`},getEmployeeIds(e){return e.map(t=>t.employee_id)},getAndCheckDateRangesForCurrentMonth(){const e=new Date,t=e.getFullYear(),a=e.getMonth(),n=new Date(t,a,1),d=new Date(t,a,15),l=new Date(t,a,16),r=new Date(t,a+1,0),w={firstHalf:{start:this.formatDate(n),end:this.formatDate(d)},secondHalf:{start:this.formatDate(l),end:this.formatDate(r)}},h=this.formatDate(e),g=new Date(w.firstHalf.start),f=new Date(w.firstHalf.end),m=new Date(w.secondHalf.start),i=new Date(w.secondHalf.end);let c,s;return e>=g&&e<=f?(c=this.formatDate(g),s=this.formatDate(f)):e>=m&&e<=i?(c=this.formatDate(m),s=this.formatDate(i)):(c="out of range",s="out of range"),{todayDate:h,startDate:c,endDate:s}},async getSalaryHistory(){try{const{data:e,error:t}=await R.from("salary_history").select();t&&console.error(t),this.selectedDateOptions=e.sort((a,n)=>new Date(a.date_start)-new Date(n.date_start))}catch(e){console.error(e)}},filterHighestAuditId(e){const t=e.reduce((a,n)=>{const{employee_id:d,audit_id:l}=n;return(!a[d]||a[d].audit_id<l)&&(a[d]=n),a},{});return Object.values(t)},getHighestAuditId(e){return e.length===0?null:e.reduce((a,n)=>n.audit_id>a.audit_id?n:a)},async fetchEmployeeInRange(e=this.selectedDate.date_end){try{const{data:t,error:a}=await R.from("employee_audit").select("*").lte("change_date",e).eq("is_archive",!1);a&&console.error(a),this.rows=this.filterHighestAuditId(t),this.employeeIds=this.getEmployeeIds(this.rows)}catch(t){console.error(t)}},async fetchPagibigContribAudit(e=this.selectedDate.date_end){try{const{data:t,error:a}=await R.from("emp_pagibig_contrib_audit").select("*, employee!emp_pagibig_contrib_audit_employee_id_fkey(last_name, first_name, middle_name, company_employee_id, pag_ibig_number, rate_per_day, is_archive)").lte("change_date",e).eq("employee.is_archive",!1).in("employee_id",this.employeeIds);a&&console.error(a),this.pagibigAudit=this.filterHighestAuditId(t.filter(n=>n.employee!==null)),console.log(t)}catch(t){console.error(t)}},async fetchPagibigContributionTableAudit(e=this.selectedDate.date_end){try{const{data:t,error:a}=await R.from("pagibig_contribution_table_audit").select("*").lte("change_date",e);a&&console.error(a),this.pagibigContributionTableAudit=this.getHighestAuditId(t)}catch(t){console.error(t)}},getNearestDateRange(){if(this.selectedDate!=null)return;const e=new Date;function t(l){return new Date(l)}function a(l){return Math.abs(e-l)}let n=null,d=1/0;for(const l of this.selectedDateOptions){const r=t(l.date_start),w=t(l.date_end),h=a(r),g=a(w),f=Math.min(h,g);f<d&&(d=f,n=l)}this.selectedDate=n},async fetchEmployeeReports(){await this.getSalaryHistory(),await this.getNearestDateRange(),await this.fetchEmployeeInRange(),await this.fetchPagibigContribAudit(),await this.fetchPagibigContributionTableAudit()}}}),Jt=S("div",{class:"tw-text-xl, tw-font-bold"},"Pag-IBIG Report",-1),Zt=S("div",{class:"tw-w-3"},null,-1),ea={__name:"PagibigTable",setup(e){const t=Xt(),a=U("");function n(d){const l=document.getElementById(d);let r="";r+=Array.from(l.querySelectorAll("th")).map(b=>b.innerText.replace(/arrow_upward/g,"")).join(",")+`
`,Array.from(l.querySelectorAll("tr")).slice(1).forEach(b=>{r+=Array.from(b.querySelectorAll("td")).map(C=>C.innerText).join(",")+`
`});const g=new Date,f={month:"short",day:"2-digit",year:"numeric"},m=g.toLocaleDateString("en-US",f).replace(",","").replace(/\s+/g,"-"),i=new Blob([r],{type:"text/csv;charset=utf-8;"}),c=URL.createObjectURL(i),s=document.createElement("a");s.setAttribute("href",c),s.setAttribute("download",`Pag-IBIG-Report-${m}.csv`),document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(c)}return t.fetchEmployeeReports(),(d,l)=>(Q(),X(_e,{id:"pagibig-table",class:"tw-border tw-rounded-3xl tw-shadow-lg",flat:"",bordered:"",dense:"",title:"Attendance Report","title-class":["tw-text-xl","tw-font-bold"],filter:a.value,columns:y(t).columns,rows:y(t).pagibigAudit,"rows-per-page-options":[0],separator:"cell","row-key":"name"},{"top-right":v(()=>[p(q,{color:"blue","icon-right":"archive",label:"Export to CSV","no-caps":"",onClick:l[0]||(l[0]=r=>n("pagibig-table")),class:"tw-mr-16"}),p(ne,{borderless:"",dense:"",debounce:"300",modelValue:a.value,"onUpdate:modelValue":l[1]||(l[1]=r=>a.value=r),placeholder:"Search"},{append:v(()=>[p(he,{name:"search"})]),_:1},8,["modelValue"])]),"top-left":v(()=>[Jt,Zt,p(ye,{rounded:"",standout:"",modelValue:y(t).selectedDate,"onUpdate:modelValue":[l[2]||(l[2]=r=>y(t).selectedDate=r),l[3]||(l[3]=r=>y(t).fetchEmployeeReports())],"use-input":"","hide-selected":"","fill-input":"","hide-bottom-space":"","input-debounce":"0",options:y(t).selectedDateOptions,"option-label":r=>r.date_start+" "+r.date_end,class:"!tw-pb-0"},{"no-option":v(()=>[p(pe,null,{default:v(()=>[p(ge,{class:"text-grey"},{default:v(()=>[$(" No results ")]),_:1})]),_:1})]),_:1},8,["modelValue","options","option-label"])]),"bottom-row":v(()=>[p(Ce,null,{default:v(()=>[p(N,{colspan:"3"}),p(N,{class:"tw-text-center"},{default:v(()=>[$(" Total Employee Share: "+F(y(t).getTotalEmployeeShare),1)]),_:1}),p(N,{class:"tw-text-center"},{default:v(()=>[$(" Total Employer Share: "+F(y(t).getTotalEmployerShare),1)]),_:1})]),_:1})]),bottom:v(()=>[]),_:1},8,["filter","columns","rows"]))}},ta=ae("sssTable",{state:()=>({rows:[],columns:[],selectedDate:null,selectedDateOptions:null,employeeIds:[],sssAudit:[],sssContributionTableAudit:[]}),getters:{getSelectedDate(){return this.selectedDate},getTotalEmployeeShare(){let e=0;return this.sssAudit.forEach(t=>{e+=t.amount}),e},getTotalEmployerShare(){let e=0;return this.sssAudit.forEach(t=>{e+=typeof this.getEmployerShare(t.amount)=="number"?this.getEmployerShare(t.amount):0}),e},getTotalECEmployerShare(){let e=0;return this.sssAudit.forEach(t=>{e+=typeof this.getECER(t.amount)=="number"?this.getECER(t.amount):0}),e}},actions:{setColumns(){this.columns=[{name:"employeeId",required:!0,label:"Emp. Id",field:e=>e.employee.company_employee_id,align:"left",sortable:!0},{name:"employeeName",align:"center",label:"Name",field:e=>e.employee.last_name+" "+e.employee.first_name+" "+e.employee.middle_name,sortable:!0,classes:"!tw-bg-neutral-300"},{name:"sssNumber",align:"center",label:"SSS No.",field:e=>e.employee.sss_number,sortable:!0,classes:"!tw-bg-neutral-300"},{name:"employeeShare",align:"center",label:"Employee Share",field:e=>e.amount,sortable:!0,classes:"!tw-bg-neutral-300"},{name:"employerShare",align:"center",label:"Employer Share",field:e=>this.getEmployerShare(e.amount),sortable:!0,classes:"!tw-bg-neutral-300"},{name:"ecEmployerShare",align:"center",label:"EC Employer Share",field:e=>this.getECER(e.amount),sortable:!0,classes:"!tw-bg-neutral-300"}]},getEmployerShare(e){console.log(e,this.sssContributionTableAudit);for(const t of this.sssContributionTableAudit)if(e==t.ee_share)return t.er_share;return"Out of range"},getECER(e){for(const t of this.sssContributionTableAudit)if(e==t.ee_share)return t.ec_er_share;return"Out of range"},capitalizeFirstLetterOfEachWord(e){return e.split(" ").map(t=>t.charAt(0).toUpperCase()+t.slice(1)).join(" ")},formatDate(e){const t=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0"),n=String(e.getDate()).padStart(2,"0");return`${t}-${a}-${n}`},getEmployeeIds(e){return e.map(t=>t.employee_id)},getAndCheckDateRangesForCurrentMonth(){const e=new Date,t=e.getFullYear(),a=e.getMonth(),n=new Date(t,a,1),d=new Date(t,a,15),l=new Date(t,a,16),r=new Date(t,a+1,0),w={firstHalf:{start:this.formatDate(n),end:this.formatDate(d)},secondHalf:{start:this.formatDate(l),end:this.formatDate(r)}},h=this.formatDate(e),g=new Date(w.firstHalf.start),f=new Date(w.firstHalf.end),m=new Date(w.secondHalf.start),i=new Date(w.secondHalf.end);let c,s;return e>=g&&e<=f?(c=this.formatDate(g),s=this.formatDate(f)):e>=m&&e<=i?(c=this.formatDate(m),s=this.formatDate(i)):(c="out of range",s="out of range"),{todayDate:h,startDate:c,endDate:s}},async getSalaryHistory(){try{const{data:e,error:t}=await R.from("salary_history").select();t&&console.error(t),this.selectedDateOptions=e.sort((a,n)=>new Date(a.date_start)-new Date(n.date_start))}catch(e){console.error(e)}},filterHighestAuditId(e){const t=e.reduce((a,n)=>{const{employee_id:d,audit_id:l}=n;return(!a[d]||a[d].audit_id<l)&&(a[d]=n),a},{});return Object.values(t)},getHighestAuditId(e){return e.length===0?null:e.reduce((a,n)=>n.audit_id>a.audit_id?n:a)},async fetchEmployeeInRange(e=this.selectedDate.date_end){try{const{data:t,error:a}=await R.from("employee_audit").select("*").lte("change_date",e).eq("is_archive",!1);a&&console.error(a),this.rows=this.filterHighestAuditId(t),this.employeeIds=this.getEmployeeIds(this.rows)}catch(t){console.error(t)}},async fetchSssContribAudit(e=this.selectedDate.date_end){try{const{data:t,error:a}=await R.from("emp_sss_contrib_audit").select("*, employee!emp_sss_contrib_audit_employee_id_fkey(last_name, first_name, middle_name, company_employee_id, sss_number, is_archive)").lte("change_date",e).eq("employee.is_archive",!1).in("employee_id",this.employeeIds);a&&console.error(a),this.sssAudit=this.filterHighestAuditId(t.filter(n=>n.employee!==null))}catch(t){console.error(t)}},async fetchSssContributionTableAudit(e=this.selectedDate.date_end){try{const{data:t,error:a}=await R.from("sss_contribution_table_audit").select("*").lte("change_date",e);a&&console.error(a),this.sssContributionTableAudit=this.getHighestAuditId(t),this.sssContributionTableAudit=this.sssContributionTableAudit.data.map(n=>{const d=n.combinedValue;let l,r,w,h,g;if(w=parseFloat(n.values[4].replace(",","")),h=parseFloat(n.values[3].replace(",","")),g=parseFloat(n.values[6].replace(",","")),d.startsWith("Below"))l=0,r=parseFloat(d.split(" ")[1].replace(",",""));else if(d.includes("Over"))l=parseFloat(d.split(" ")[0].replace(",","")),r=null;else{const[f,m]=d.split(" - ");l=parseFloat(f.replace(",","")),r=parseFloat(m.replace(",",""))}return{min:l,max:r,ee_share:w,er_share:h,ec_er_share:g}}),this.setColumns()}catch(t){console.error(t)}},getNearestDateRange(){if(this.selectedDate!=null)return;const e=new Date;function t(l){return new Date(l)}function a(l){return Math.abs(e-l)}let n=null,d=1/0;for(const l of this.selectedDateOptions){const r=t(l.date_start),w=t(l.date_end),h=a(r),g=a(w),f=Math.min(h,g);f<d&&(d=f,n=l)}this.selectedDate=n},async fetchEmployeeReports(){await this.getSalaryHistory(),await this.getNearestDateRange(),await this.fetchSssContributionTableAudit(),await this.fetchEmployeeInRange(),await this.fetchSssContribAudit()}}}),aa=S("div",{class:"tw-text-xl, tw-font-bold"},"SSS Report",-1),na=S("div",{class:"tw-w-3"},null,-1),la={__name:"SssTable",setup(e){const t=ta(),a=U("");function n(d){const l=document.getElementById(d);let r="";r+=Array.from(l.querySelectorAll("th")).map(b=>b.innerText.replace(/arrow_upward/g,"")).join(",")+`
`,Array.from(l.querySelectorAll("tr")).slice(1).forEach(b=>{r+=Array.from(b.querySelectorAll("td")).map(C=>C.innerText).join(",")+`
`});const g=new Date,f={month:"short",day:"2-digit",year:"numeric"},m=g.toLocaleDateString("en-US",f).replace(",","").replace(/\s+/g,"-"),i=new Blob([r],{type:"text/csv;charset=utf-8;"}),c=URL.createObjectURL(i),s=document.createElement("a");s.setAttribute("href",c),s.setAttribute("download",`SSS-Report-${m}.csv`),document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(c)}return t.fetchEmployeeReports(),(d,l)=>(Q(),X(_e,{id:"sss-table",class:"tw-border tw-rounded-3xl tw-shadow-lg",flat:"",bordered:"",dense:"",title:"Attendance Report",filter:a.value,columns:y(t).columns,rows:y(t).sssAudit,"rows-per-page-options":[0],separator:"cell","row-key":"name"},{"top-right":v(()=>[p(q,{color:"blue","icon-right":"archive",label:"Export to CSV","no-caps":"",onClick:l[0]||(l[0]=r=>n("sss-table")),class:"tw-mr-16"}),p(ne,{borderless:"",dense:"",debounce:"300",modelValue:a.value,"onUpdate:modelValue":l[1]||(l[1]=r=>a.value=r),placeholder:"Search"},{append:v(()=>[p(he,{name:"search"})]),_:1},8,["modelValue"])]),"top-left":v(()=>[aa,na,p(ye,{rounded:"",standout:"",modelValue:y(t).selectedDate,"onUpdate:modelValue":[l[2]||(l[2]=r=>y(t).selectedDate=r),l[3]||(l[3]=r=>y(t).fetchEmployeeReports())],"use-input":"","hide-selected":"","fill-input":"","hide-bottom-space":"","input-debounce":"0",options:y(t).selectedDateOptions,"option-label":r=>r.date_start+" "+r.date_end,class:"!tw-pb-0"},{"no-option":v(()=>[p(pe,null,{default:v(()=>[p(ge,{class:"text-grey"},{default:v(()=>[$(" No results ")]),_:1})]),_:1})]),_:1},8,["modelValue","options","option-label"])]),"bottom-row":v(()=>[p(Ce,null,{default:v(()=>[p(N),p(N),p(N),p(N,{class:"tw-text-center"},{default:v(()=>[$(" Total EE Share: "+F(y(t).getTotalEmployeeShare),1)]),_:1}),p(N,{class:"tw-text-center"},{default:v(()=>[$(" Total ER Share: "+F(y(t).getTotalEmployerShare),1)]),_:1}),p(N,{class:"tw-text-center"},{default:v(()=>[$(" Total EC ER Share: "+F(y(t).getTotalECEmployerShare),1)]),_:1})]),_:1})]),bottom:v(()=>[]),_:1},8,["filter","columns","rows"]))}},oa={class:"tw-w-12/12 tw-max-w-full tw-mx-auto tw-bg-white tw-shadow-lg tw-border tw-rounded-3xl tw-border-collapse tw-p-4 tw-mt-0"},sa=S("br",null,null,-1),ra=S("br",null,null,-1),ia=S("br",null,null,-1),ua=S("br",null,null,-1),Ha={__name:"AdminReportsPage",setup(e){const t=rt();return t.currentPage="Reports",(a,n)=>(Q(),fe("div",oa,[S("div",null,[p(Qt),sa,p(zt),ra,p(ea),ia,p(la),ua])]))}};export{Ha as default};
