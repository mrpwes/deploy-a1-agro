import{Q as k}from"./QTd.312e33a5.js";import{r as _,o as b,c as g,d as t,Q as c,w as n,a as s,a8 as v,e as d,S as m,a7 as A,g as x,n as Y,aa as h,G as U,u as I,at as L,au as y,aA as M,f as R}from"./index.4b3c3d71.js";import{Q as f}from"./QInput.0b7d6fff.js";import{Q as j}from"./QTable.7eaf985e.js";import{d as V}from"./date.eeec251e.js";import{u as P}from"./pageHeader.5864d687.js";import{Q as q,C as w}from"./ClosePopup.261790f7.js";import{Q as D}from"./QDialog.f2508d6d.js";import{u as S}from"./viewApproval.a1dbc2ad.js";import{Q as B}from"./QCardSection.d9a1403b.js";import{g as Q,Q as C}from"./position-engine.65eff008.js";import{Q as $}from"./QSelect.719db4c9.js";import{Q as N}from"./QForm.2888d044.js";import{Q as z}from"./QCard.d5066e97.js";import"./use-key-composition.58a46558.js";import"./focus-manager.f3c2b9a5.js";import"./QList.bb366341.js";const F={class:"!tw-h-min !tw-w-4/12 !tw-max-w-full tw-bg-white tw-p-6"},E={class:"tw-grid tw-grid-cols-3 tw-gap-5 tw-pb-5"},T=s("div",{class:"tw-col-span-3"},"Subject:",-1),H={class:"tw-col-span-3"},G=s("div",{class:"tw-col-span-3"},"Description:",-1),J={class:"tw-col-span-3"},K=s("div",{class:"tw-col-span-3"},"Remarks:",-1),W={class:"tw-col-span-3 !tw-h-2/6"},O={__name:"ViewApprovalButton",props:["rows"],setup(u){const a=S(),p=_(!1),o=_(null);function i(l){o.value=l,p.value=!0}return(l,e)=>(b(),g(h,null,[t(c,{icon:"visibility",label:"View",onClick:e[0]||(e[0]=r=>i(u.rows))}),t(D,{modelValue:p.value,"onUpdate:modelValue":e[7]||(e[7]=r=>p.value=r)},{default:n(()=>[s("div",F,[s("div",E,[s("div",null,"Request ID: "+v(o.value.id),1),s("div",null," Name: "+v(o.value.recipient.first_name)+" "+v(o.value.recipient.last_name),1),s("div",null," Application Date: "+v(d(V).formatDate(o.value.request_confirmation.application_date,"MMM D, YYYY")),1),T,s("div",H,[t(f,{dense:l.dense,modelValue:o.value.subject,"onUpdate:modelValue":e[1]||(e[1]=r=>o.value.subject=r),disable:"",autogrow:"",filled:"","hide-bottom-space":""},null,8,["dense","modelValue"])]),G,s("div",J,[t(f,{dense:l.dense,modelValue:o.value.description,"onUpdate:modelValue":e[2]||(e[2]=r=>o.value.description=r),disable:"",autogrow:"",filled:"","hide-bottom-space":""},null,8,["dense","modelValue"])]),K,s("div",W,[t(f,{modelValue:o.value.remarks,"onUpdate:modelValue":e[3]||(e[3]=r=>o.value.remarks=r),filled:"",autogrow:"",disable:!!o.value.isArchive,readonly:!!o.value.isArchive},null,8,["modelValue","disable","readonly"])])]),t(q,{align:"right",class:"text-primary"},{default:n(()=>[m(t(c,{flat:"",label:"Cancel"},null,512),[[w]]),o.value.request_confirmation.status=="Pending"?m((b(),A(c,{key:0,flat:"",class:"tw-bg-red-500",icon:"mdi-close",label:"Disapprove",onClick:e[4]||(e[4]=r=>d(a).requestConfirmationStatus(o.value.request_confirmation.id,"Disapproved"))},null,512)),[[w]]):x("",!0),o.value.request_confirmation.status=="Pending"?m((b(),A(c,{key:1,flat:"",class:"tw-bg-green-400",icon:"mdi-check-bold",label:"Approve",onClick:e[5]||(e[5]=r=>d(a).requestConfirmationStatus(o.value.request_confirmation.id,"Approved"))},null,512)),[[w]]):x("",!0),m(t(c,{flat:"",class:Y(o.value.is_archive?"tw-bg-green-400":"tw-bg-red-400"),icon:"mdi-archive",label:o.value.is_archive?"Unarchive":"Archive",onClick:e[6]||(e[6]=r=>d(a).archivedRequest(o.value.id,o.value.is_archive))},null,8,["class","label"]),[[w]])]),_:1})])]),_:1},8,["modelValue"])],64))}},X={class:"!tw-h-min !tw-w-8/12 !tw-max-w-full tw-bg-white tw-p-6"},Z=s("div",{class:"tw-col-span-4 tw-text-3xl tw-font-extrabold tw-pb-3"}," Archived Approval ",-1),ee={__name:"ArchivedApprovalButton",setup(u){const a=S(),p=_(!1),o=_(""),i=[{name:"Request ID",required:!0,label:"Request ID",align:"left",field:l=>l.id,format:l=>`${l}`,sortable:!0},{name:"Request Date",align:"center",label:"Request Date",field:l=>l.request_confirmation.application_date,format:l=>V.formatDate(l,"MMM D, YYYY"),sortable:!0},{name:"Subject",align:"center",label:"Subject",field:"subject",sortable:!0},{name:"Description",align:"center",label:"Description",field:"description",sortable:!0},{name:"Recipient",align:"center",label:"Recipient",field:l=>l.recipient.last_name+" "+l.recipient.first_name,sortable:!0},{name:"actions",align:"center",label:"",field:""}];return(l,e)=>(b(),g(h,null,[t(c,{icon:"mdi-archive",label:"Archived Request",onClick:e[0]||(e[0]=r=>p.value=!0),class:"tw-bg-white"}),t(D,{modelValue:p.value,"onUpdate:modelValue":e[2]||(e[2]=r=>p.value=r),persistent:""},{default:n(()=>[s("div",X,[Z,t(j,{class:"my-sticky-header-table tw-w-11/12 tw-mx-auto tw-mt-6 tw-bg-white tw-shadow-lg tw-border tw-rounded-3xl tw-border-collapse",flat:"",bordered:"",filter:o.value,columns:i,rows:d(a).getArchivedApprovalList,"rows-per-page-options":[10,20,0],"row-key":"name"},{"body-cell-actions":n(r=>[t(k,{props:r},{default:n(()=>[s("div",null,[t(O,{rows:r.row},null,8,["rows"])])]),_:2},1032,["props"])]),"top-right":n(()=>[t(f,{borderless:"",dense:"",debounce:"300",modelValue:o.value,"onUpdate:modelValue":e[1]||(e[1]=r=>o.value=r),placeholder:"Search"},{append:n(()=>[t(U,{name:"search"})]),_:1},8,["modelValue"])]),_:1},8,["filter","rows"]),t(q,{align:"right",class:"text-primary"},{default:n(()=>[m(t(c,{flat:"",label:"Cancel"},null,512),[[w]])]),_:1})])]),_:1},8,["modelValue"])],64))}},te=I(),le=L("addApproval",{state:()=>({recipient:null,recipientOptions:null,issuer:null,issuerOptions:null,type:null,typeOptions:null,subject:null,description:null,current_user_id:te.getEmployeeId,insertRequestConfirmationID:null}),getters:{},actions:{async fetchEmployeeOptions(){try{const{data:u,error:a}=await y.from("employee").select("id, company_employee_id, first_name, middle_name, last_name");if(a)throw a;this.recipientOptions=u,this.issuerOptions=u}catch(u){console.log(u)}},async fetchRequestTypeOptions(){try{const{data:u,error:a}=await y.from("request_type").select("id, request_type_name");if(a)throw a;this.typeOptions=u}catch(u){console.log(u)}},async insertRequestForm(){try{const{data:u,error:a}=await y.from("request").insert([{request_employee_id:this.recipient.id,request_type_id:this.type.id,request_date:new Date().toLocaleDateString("en-US"),request_subject:this.subject,request_description:this.description,request_application_date:new Date().toLocaleDateString("en-US"),admin_employee_id:this.issuer.id,admin_approval_status:"Pending",admin_comments:"Pending",admin_confirmation_date:new Date().toLocaleDateString("en-US"),change_date:new Date().toLocaleDateString("en-US"),is_archive:!1}]);if(a)throw a}catch(u){console.log(u)}}}}),ae={class:"tw-m-4"},oe=s("div",{class:"tw-text-3xl tw-font-extrabold tw-pb-3"}," Add Request Form ",-1),se={class:"tw-flex tw-mb-3"},ie=s("div",{class:"tw-content-center tw-mr-3"},"Employee Name:",-1),ne={class:"tw-flex tw-mb-3"},re=s("div",{class:"tw-content-center tw-mr-3"},"Type:",-1),de={class:"tw-mb-3"},ue=s("div",null,"Subject:",-1),pe={class:"tw-pb-3 tw-px-2"},ce={class:"tw-mb-3"},me=s("div",null,"Description:",-1),we={class:"tw-pb-3 tw-px-2"},fe={__name:"AddApprovalButton",setup(u){const a=le(),p=_(!1);a.fetchEmployeeOptions(),a.fetchRequestTypeOptions();function o(i,l){l(()=>{console.log(i);const e=i.toLowerCase();a.selectorRecipientOptions=a.recipientOptions.filter(r=>String(r.company_employee_id).toLowerCase().indexOf(e)>-1)})}return(i,l)=>(b(),g(h,null,[t(c,{icon:"mdi-plus",label:"Add Request",onClick:l[0]||(l[0]=e=>p.value=!0),class:"tw-bg-white"}),t(D,{modelValue:p.value,"onUpdate:modelValue":l[5]||(l[5]=e=>p.value=e),persistent:""},{default:n(()=>[t(z,{class:"min-width: 500px"},{default:n(()=>[t(N,{onSubmit:M(d(a).insertRequestForm,["prevent"]),autofocus:""},{default:n(()=>[s("div",ae,[t(B,{class:"tw-pt-0 tw-pl-0"},{default:n(()=>[oe]),_:1}),s("div",se,[ie,t($,{filled:"",modelValue:d(a).recipient,"onUpdate:modelValue":l[1]||(l[1]=e=>d(a).recipient=e),"use-input":"","hide-selected":"","fill-input":"","hide-bottom-space":"","input-debounce":"0",options:d(a).selectorRecipientOptions,"option-label":e=>"first_name"in e?e.company_employee_id+" - "+e.last_name:"","option-value":i.id,onFilter:o,class:"!tw-pb-0; tw-capitalize","popup-content-class":"tw-capitalize"},{"no-option":n(()=>[t(Q,null,{default:n(()=>[t(C,{class:"text-grey"},{default:n(()=>[R(" No results ")]),_:1})]),_:1})]),_:1},8,["modelValue","options","option-label","option-value"])]),s("div",ne,[re,t($,{filled:"",modelValue:d(a).type,"onUpdate:modelValue":l[2]||(l[2]=e=>d(a).type=e),"use-input":"","hide-selected":"","fill-input":"","hide-bottom-space":"","input-debounce":"0",options:d(a).typeOptions,"option-label":"request_type_name",class:"!tw-pb-0; tw-capitalize;","popup-content-class":"tw-capitalize","emit-value":""},{"no-option":n(()=>[t(Q,null,{default:n(()=>[t(C,{class:"text-grey"},{default:n(()=>[R(" No results ")]),_:1})]),_:1})]),_:1},8,["modelValue","options"])]),s("div",de,[ue,s("div",pe,[t(f,{modelValue:d(a).subject,"onUpdate:modelValue":l[3]||(l[3]=e=>d(a).subject=e),filled:"",autogrow:"",class:"tw-max-w-full","lazy-rules":""},null,8,["modelValue"])])]),s("div",ce,[me,s("div",we,[t(f,{modelValue:d(a).description,"onUpdate:modelValue":l[4]||(l[4]=e=>d(a).description=e),filled:"",autogrow:"",class:"tw-max-w-full","lazy-rules":""},null,8,["modelValue"])])]),t(q,{align:"right",class:"text-primary"},{default:n(()=>[m(t(c,{flat:"",label:"Cancel"},null,512),[[w]]),m(t(c,{flat:"",class:"tw-bg-green-400",label:"Add Loan",type:"submit"},null,512),[[w]])]),_:1})])]),_:1},8,["onSubmit"])]),_:1})]),_:1},8,["modelValue"])],64))}},be={class:"tw-w-11/12 tw-mx-auto tw-flex tw-justify-end tw-mb-5 tw-gap-4"},je={__name:"AdminApprovalListPage",setup(u){const a=P();a.currentPage="Approval List";const p=S(),o=[{name:"Request ID",required:!0,label:"Request ID",align:"left",field:i=>i.id,format:i=>`${i}`,sortable:!0},{name:"Request Date",align:"center",label:"Request Date",field:i=>i.request_confirmation.application_date,format:i=>V.formatDate(i,"MMM D, YYYY"),sortable:!0},{name:"Subject",align:"center",label:"Subject",field:"subject",sortable:!0},{name:"Description",align:"center",label:"Description",field:"description",sortable:!0},{name:"Recipient",align:"center",label:"Recipient",field:i=>i.recipient.last_name+" "+i.recipient.first_name,sortable:!0},{name:"actions",align:"center",label:"",field:""}];return(i,l)=>(b(),g(h,null,[s("div",be,[t(ee),t(fe)]),t(j,{class:"my-sticky-header-table tw-w-11/12 tw-mx-auto tw-mt-6 tw-bg-white tw-shadow-lg tw-border tw-rounded-3xl tw-border-collapse",flat:"",bordered:"",filter:i.tableSearch,columns:o,rows:d(p).getUnarchivedApprovalList,"rows-per-page-options":[10,20,0],"row-key":"name"},{"body-cell-actions":n(e=>[t(k,{key:"actions",class:"tw-w-2/12",props:e},{default:n(()=>[t(O,{rows:e.row},null,8,["rows"])]),_:2},1032,["props"])]),"top-right":n(()=>[t(f,{borderless:"",dense:"",debounce:"300",modelValue:i.tableSearch,"onUpdate:modelValue":l[0]||(l[0]=e=>i.tableSearch=e),placeholder:"Search"},{append:n(()=>[t(U,{name:"search"})]),_:1},8,["modelValue"])]),_:1},8,["filter","rows"])],64))}};export{je as default};
