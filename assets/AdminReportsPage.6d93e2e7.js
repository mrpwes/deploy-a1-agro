import{u as rt}from"./pageHeader.10d9d4fd.js";import{ar as ee,as as M,k as it,r as N,j as H,h as ke,I as ut,p as x,t as ct,ax as dt,T as mt,S as Y,Q as O,i as ht,af as ft,o as j,c as de,d as h,n as pt,w as g,aN as yt,e as f,a as D,a8 as V,f as q,a7 as z,a5 as gt,G as me}from"./index.fa342762.js";import{Q as te}from"./QInput.d41ba563.js";import{Q as P}from"./QTd.8b5dee8d.js";import{G as K,Q as vt,w as he,t as fe}from"./position-engine.573b6235.js";import{b as pe}from"./QSelect.9e704e12.js";import{Q as ye}from"./QTable.0d774183.js";import{u as _t}from"./globalNotification.d7c9769f.js";import{T as bt}from"./TouchPan.5f31f974.js";import{b as wt,u as Dt}from"./focus-manager.09b3f23b.js";import{a as St,i as At,h as Tt}from"./use-key-composition.ddbcd19f.js";import{u as Oe,a as Ct,b as xt,g as It,Q as Re}from"./QPopupProxy.93ccc85a.js";import{_ as ce,f as Et}from"./date.56c1f476.js";import{C as W,Q as qe}from"./ClosePopup.bcad9a93.js";import{Q as Ht}from"./QForm.50b80046.js";import{Q as Te}from"./QTr.9b0cd7d7.js";import"./QList.21e76d84.js";const Fe=ee("attendanceTable",{state:()=>({rows:[],selectedDate:null,selectedDateOptions:null,attendanceColumns:{columns:[]}}),getters:{getSelectedDate(){return this.selectedDate},sortRowsByCompanyEmployeeId(e){e.rows.sort((t,a)=>t.company_employee_id-a.company_employee_id)}},actions:{capitalizeFirstLetterOfEachWord(e){return e.split(" ").map(t=>t.charAt(0).toUpperCase()+t.slice(1)).join(" ")},formatDate(e){const t=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0"),n=String(e.getDate()).padStart(2,"0");return`${t}-${a}-${n}`},getAndCheckDateRangesForCurrentMonth(){const e=new Date,t=e.getFullYear(),a=e.getMonth(),n=new Date(t,a,1),c=new Date(t,a,15),o=new Date(t,a,16),i=new Date(t,a+1,0),_={firstHalf:{start:this.formatDate(n),end:this.formatDate(c)},secondHalf:{start:this.formatDate(o),end:this.formatDate(i)}},d=this.formatDate(e),m=new Date(_.firstHalf.start),r=new Date(_.firstHalf.end),s=new Date(_.secondHalf.start),p=new Date(_.secondHalf.end);let b,y;return e>=m&&e<=r?(b=this.formatDate(m),y=this.formatDate(r)):e>=s&&e<=p?(b=this.formatDate(s),y=this.formatDate(p)):(b="out of range",y="out of range"),{todayDate:d,startDate:b,endDate:y}},async getSalaryHistory(){try{const{data:e,error:t}=await M.from("salary_history").select();t&&console.error(t),this.selectedDateOptions=e.sort((a,n)=>new Date(a.date_start)-new Date(n.date_start))}catch(e){console.error(e)}},fillMissingDates(e,t,a){console.log("FILLING MISSING DATES"+t+" "+a);const n=i=>{const _=i.getFullYear(),d=String(i.getMonth()+1).padStart(2,"0"),m=String(i.getDate()).padStart(2,"0");return`${_}-${d}-${m}`},c=new Date(t),o=new Date(a);return o.setDate(o.getDate()+1),e.forEach(i=>{const _=new Set(i.attendance.map(d=>d.date));for(let d=new Date(c);d<=o;d.setDate(d.getDate()+1)){const m=n(d);_.has(m)||i.attendance.push({id:null,date:m,employee:{first_name:i.first_name,last_name:i.first_name},remarks:null,time_in:null,time_out:null,employee_id:i.id,adjustment_salary_id:null})}i.attendance.sort((d,m)=>new Date(d.date)-new Date(m.date))}),e},calculateTotalHours(e){if(e.attendance_type==null)return 0;if(e.attendance_type.id!==1)return this.convertDecimalToHoursMinutes(8);let t=new Date(e.time_in);t.setMilliseconds(0);let a=new Date(e.time_out);a.setMilliseconds(0);const n=new Date(t);n.setHours(8,0,0),t<n&&t.setHours(8,0,0);const c=new Date(a);c.setHours(17,0,0),a>c&&a.setHours(17,0,0);let o=(a-t)/(1e3*60);const i=new Date(a);i.setHours(13,0,0);const _=new Date(a);_.setHours(12,0,0),a>i&&t<_&&(o-=60);const d=Math.floor(o/60)+o%60/60;return this.convertDecimalToHoursMinutes(d)},sumArray(e){return e.reduce((t,a)=>t+Number(a),0)},calculateTotalAttendanceHours(e){let t=0,a=[];return e.forEach(n=>{a.push(this.calculateTotalHours(n))}),console.log(a),t=this.sumArray(a),console.log(t),t.toFixed(4)},convertDecimalToHoursMinutes(e){const t=Math.floor(e),a=Math.floor((e-t)*60);return t+"."+a},async fetchAttendanceInRange(e=this.selectedDate.date_start,t=this.selectedDate.date_end){try{const{data:a,error:n}=await M.from("employee").select(`*,
             is_archive,
              attendance(*, attendance_type(*), employee(first_name, last_name, company_employee_id))`).gte("attendance.date",e).lte("attendance.date",t).eq("is_archive",!1);n&&console.error(n),this.rows=Object.values(this.fillMissingDates(a,e,t))}catch(a){console.error(a)}},columns(e=this.selectedDate.date_start,t=this.selectedDate.date_end){const a=new Date(e),n=new Date(t),c=[],o={day:"numeric",month:"numeric"},i=["S","M","T","W","TH","F","S"];for(let d=new Date(a);d<=n;d.setDate(d.getDate()+1)){d.getDate();const m=new Intl.DateTimeFormat("en-US",o).format(d),r=d.getDay(),s=`${m} ${i[r]}`;c.push((()=>({name:"actions",align:"center",label:`${s}`,sortable:!0}))())}const _=[{name:"employeeName",align:"center",label:"Name",sortable:!0,field:d=>d.company_employee_id+" - "+d.last_name+", "+d.first_name,format:d=>`${d}`},...c,{name:"totalHours",align:"center",label:"Total Hours",field:d=>this.calculateTotalAttendanceHours(d.attendance)},{name:"totalAbsent",align:"center",label:"A",sortable:!0,field:d=>{let m=0;const r=new Date;for(let s=0;s<d.attendance.length;s++)new Date(d.attendance[s].date)<=r&&(!d.attendance[s].time_in||!d.attendance[s].time_out)&&m++;return m}},{name:"totalLeave",align:"center",label:"LVE",field:d=>{let m=0;for(let r=0;r<d.attendance.length;r++)d.attendance[r].attendance_type_id==2&&m++;return m}}];this.attendanceColumns.columns.push(..._)},getNearestDateRange(){if(this.selectedDate!=null)return;const e=new Date;function t(o){return new Date(o)}function a(o){return Math.abs(e-o)}let n=null,c=1/0;for(const o of this.selectedDateOptions){const i=t(o.date_start),_=t(o.date_end),d=a(i),m=a(_),r=Math.min(d,m);r<c&&(c=r,n=o)}this.selectedDate=n},async fetchAttendanceReports(){this.attendanceColumns.columns=[],await this.getSalaryHistory(),this.getNearestDateRange(),this.columns(),this.fetchAttendanceInRange()}}}),$e=_t(),Mt=Fe(),Ne=ee("reportsViewAttendanceTable",{state:()=>({attendanceID:null,attendanceDate:null,attendanceRemarks:null,attendanceTimeIn:null,attendanceTimeInProxy:null,attendanceTimeOut:null,attendanceTimeOutProxy:null,attendanceEmployeeID:null,attendanceType:null,attendanceAdjustmentSalaryID:null,listOfAttendanceType:[],listOfAdjustmentSalary:[],hourOptions:[8,9,10,11,12,13,14,15,16,17],is_editing:!1}),getters:{getIsEditing(e){return e.is_editing},getFormattedTimeIn(e){if(e.attendanceTimeOut===null)return null;const t=new Date(e.attendanceTimeIn);let a=t.getHours();const n=t.getMinutes(),c=a>=12?"PM":"AM";a=a%12,a=a||12;const o=n<10?"0"+n:n;return`${a}:${o} ${c}`},getFormattedTimeOut(e){if(e.attendanceTimeOut===null)return null;const t=new Date(e.attendanceTimeOut);let a=t.getHours();const n=t.getMinutes(),c=a>=12?"PM":"AM";a=a%12,a=a||12;const o=n<10?"0"+n:n;return`${a}:${o} ${c}`}},actions:{updateProxy(e){e==!0?this.attendanceTimeInProxy=this.attendanceTimeIn:this.attendanceTimeOutProxy=this.attendanceTimeOut},saveProxy(e){e==!0?this.attendanceTimeIn=this.attendanceTimeInProxy:this.attendanceTimeOut=this.attendanceTimeOutProxy},async fetchAttendanceTable(){const{data:e,error:t}=await M.from("attendance").select("*").eq("id");if(t)console.log(t);else return e},async fetchAttendanceType(){const{data:e,error:t}=await M.from("attendance_type").select("*");t?console.log(t):this.listOfAttendanceType=e},async fetchAdjustmentSalary(){const{data:e,error:t}=await M.from("adjustment_salary").select("*");t?console.log(t):this.listOfAdjustmentSalary=e},async updateAttendance(){const{error:e}=await M.from("attendance").update({date:this.attendanceDate,remarks:this.attendanceRemarks,time_in:this.attendanceTimeIn,time_out:this.attendanceTimeOut,employee_id:this.attendanceEmployeeID,attendance_type_id:this.attendanceType,adjustment_salary_id:this.attendanceAdjustmentSalaryID}).eq("id",this.attendanceID);e?$e.showErrorNotification("Failed to update attendance"):(Mt.fetchAttendanceReports(),$e.showSuccessNotification("Attendance updated successfully"),this.is_editing=!1)},resetForm(){this.attendanceID=null,this.attendanceDate=null,this.attendanceRemarks=null,this.attendanceTimeIn=null,this.attendanceTimeInProxy=null,this.attendanceTimeOut=null,this.attendanceTimeOutProxy=null,this.attendanceEmployeeID=null,this.attendanceType=null,this.attendanceAdjustmentSalaryID=null,this.is_editing=!1}}});function kt(e,t){if(e.hour!==null){if(e.minute===null)return"minute";if(t===!0&&e.second===null)return"second"}return"hour"}function Ot(){const e=new Date;return{hour:e.getHours(),minute:e.getMinutes(),second:e.getSeconds(),millisecond:e.getMilliseconds()}}var Ve=it({name:"QTime",props:{...wt,...St,...Oe,modelValue:{required:!0,validator:e=>typeof e=="string"||e===null},mask:{...Oe.mask,default:null},format24h:{type:Boolean,default:null},defaultDate:{type:String,validator:e=>/^-?[\d]+\/[0-1]\d\/[0-3]\d$/.test(e)},options:Function,hourOptions:Array,minuteOptions:Array,secondOptions:Array,withSeconds:Boolean,nowBtn:Boolean},emits:Ct,setup(e,{slots:t,emit:a}){const n=ct(),{$q:c}=n.proxy,o=Dt(e,c),{tabindex:i,headerClass:_,getLocale:d,getCurrentDate:m}=xt(e,c),r=At(e),s=Tt(r);let p,b;const y=N(null),C=H(()=>Ye()),E=H(()=>d()),R=H(()=>Ke()),B=ce(e.modelValue,C.value,E.value,e.calendar,R.value),S=N(kt(B)),v=N(B),k=N(B.hour===null||B.hour<12),ge=H(()=>`q-time q-time--${e.landscape===!0?"landscape":"portrait"}`+(o.value===!0?" q-time--dark q-dark":"")+(e.disable===!0?" disabled":e.readonly===!0?" q-time--readonly":"")+(e.bordered===!0?" q-time--bordered":"")+(e.square===!0?" q-time--square no-border-radius":"")+(e.flat===!0?" q-time--flat no-shadow":"")),ve=H(()=>{const l=v.value;return{hour:l.hour===null?"--":F.value===!0?K(l.hour):String(k.value===!0?l.hour===0?12:l.hour:l.hour>12?l.hour-12:l.hour),minute:l.minute===null?"--":K(l.minute),second:l.second===null?"--":K(l.second)}}),F=H(()=>e.format24h!==null?e.format24h:c.lang.date.format24h),Ue=H(()=>{const l=S.value==="hour",u=l===!0?12:60,w=v.value[S.value];let I=`rotate(${Math.round(w*(360/u))-180}deg) translateX(-50%)`;return l===!0&&F.value===!0&&v.value.hour>=12&&(I+=" scale(.7)"),{transform:I}}),Ce=H(()=>v.value.hour!==null),je=H(()=>Ce.value===!0&&v.value.minute!==null),G=H(()=>e.hourOptions!==void 0?l=>e.hourOptions.includes(l):e.options!==void 0?l=>e.options(l,null,null):null),ae=H(()=>e.minuteOptions!==void 0?l=>e.minuteOptions.includes(l):e.options!==void 0?l=>e.options(v.value.hour,l,null):null),ne=H(()=>e.secondOptions!==void 0?l=>e.secondOptions.includes(l):e.options!==void 0?l=>e.options(v.value.hour,v.value.minute,l):null),U=H(()=>{if(G.value===null)return null;const l=oe(0,11,G.value),u=oe(12,11,G.value);return{am:l,pm:u,values:l.values.concat(u.values)}}),X=H(()=>ae.value!==null?oe(0,59,ae.value):null),J=H(()=>ne.value!==null?oe(0,59,ne.value):null),le=H(()=>{switch(S.value){case"hour":return U.value;case"minute":return X.value;case"second":return J.value}}),Be=H(()=>{let l,u,w=0,T=1;const I=le.value!==null?le.value.values:void 0;S.value==="hour"?F.value===!0?(l=0,u=23):(l=0,u=11,k.value===!1&&(w=12)):(l=0,u=55,T=5);const L=[];for(let A=l,$=l;A<=u;A+=T,$++){const Q=A+w,ot=I!==void 0&&I.includes(Q)===!1,st=S.value==="hour"&&A===0?F.value===!0?"00":"12":A;L.push({val:Q,index:$,disable:ot,label:st})}return L}),Qe=H(()=>[[bt,We,void 0,{stop:!0,prevent:!0,mouse:!0}]]);ke(()=>e.modelValue,l=>{const u=ce(l,C.value,E.value,e.calendar,R.value);(u.dateHash!==v.value.dateHash||u.timeHash!==v.value.timeHash)&&(v.value=u,u.hour===null?S.value="hour":k.value=u.hour<12)}),ke([C,E],()=>{ht(()=>{Ae()})});function xe(){const l={...m(),...Ot()};Ae(l),Object.assign(v.value,l),S.value="hour"}function oe(l,u,w){const T=Array.apply(null,{length:u+1}).map((I,L)=>{const A=L+l;return{index:A,val:w(A)===!0}}).filter(I=>I.val===!0).map(I=>I.index);return{min:T[0],max:T[T.length-1],values:T,threshold:u+1}}function Ie(l,u,w){const T=Math.abs(l-u);return Math.min(T,w-T)}function _e(l,{min:u,max:w,values:T,threshold:I}){if(l===u)return u;if(l<u||l>w)return Ie(l,u,I)<=Ie(l,w,I)?u:w;const L=T.findIndex(Q=>l<=Q),A=T[L-1],$=T[L];return l-A<=$-l?A:$}function Ye(){return e.calendar!=="persian"&&e.mask!==null?e.mask:`HH:mm${e.withSeconds===!0?":ss":""}`}function Ke(){if(typeof e.defaultDate!="string"){const l=m(!0);return l.dateHash=It(l),l}return ce(e.defaultDate,"YYYY/MM/DD",void 0,e.calendar)}function be(){return ft(n)===!0||le.value!==null&&(le.value.values.length===0||S.value==="hour"&&F.value!==!0&&U.value[k.value===!0?"am":"pm"].values.length===0)}function we(){const l=y.value,{top:u,left:w,width:T}=l.getBoundingClientRect(),I=T/2;return{top:u+I,left:w+I,dist:I*.7}}function We(l){if(be()!==!0){if(l.isFirst===!0){p=we(),b=se(l.evt,p);return}b=se(l.evt,p,b),l.isFinal===!0&&(p=!1,b=null,Ee())}}function Ee(){S.value==="hour"?S.value="minute":e.withSeconds&&S.value==="minute"&&(S.value="second")}function se(l,u,w){const T=dt(l),I=Math.abs(T.top-u.top),L=Math.sqrt(Math.pow(Math.abs(T.top-u.top),2)+Math.pow(Math.abs(T.left-u.left),2));let A,$=Math.asin(I/L)*(180/Math.PI);if(T.top<u.top?$=u.left<T.left?90-$:270+$:$=u.left<T.left?$+90:270-$,S.value==="hour"){if(A=$/30,U.value!==null){const Q=F.value!==!0?k.value===!0:U.value.am.values.length!==0&&U.value.pm.values.length!==0?L>=u.dist:U.value.am.values.length!==0;A=_e(A+(Q===!0?0:12),U.value[Q===!0?"am":"pm"])}else A=Math.round(A),F.value===!0?L<u.dist?A<12&&(A+=12):A===12&&(A=0):k.value===!0&&A===12?A=0:k.value===!1&&A!==12&&(A+=12);F.value===!0&&(k.value=A<12)}else A=Math.round($/6)%60,S.value==="minute"&&X.value!==null?A=_e(A,X.value):S.value==="second"&&J.value!==null&&(A=_e(A,J.value));return w!==A&&at[S.value](A),A}const De={hour(){S.value="hour"},minute(){S.value="minute"},second(){S.value="second"}};function ze(l){l.keyCode===13&&He()}function Ge(l){l.keyCode===13&&Me()}function Xe(l){be()!==!0&&(c.platform.is.desktop!==!0&&se(l,we()),Ee())}function Je(l){be()!==!0&&se(l,we())}function Ze(l){if(l.keyCode===13)S.value="hour";else if([37,39].includes(l.keyCode)){const u=l.keyCode===37?-1:1;if(U.value!==null){const w=F.value===!0?U.value.values:U.value[k.value===!0?"am":"pm"].values;if(w.length===0)return;if(v.value.hour===null)re(w[0]);else{const T=(w.length+w.indexOf(v.value.hour)+u)%w.length;re(w[T])}}else{const w=F.value===!0?24:12,T=F.value!==!0&&k.value===!1?12:0,I=v.value.hour===null?-u:v.value.hour;re(T+(24+I+u)%w)}}}function et(l){if(l.keyCode===13)S.value="minute";else if([37,39].includes(l.keyCode)){const u=l.keyCode===37?-1:1;if(X.value!==null){const w=X.value.values;if(w.length===0)return;if(v.value.minute===null)ie(w[0]);else{const T=(w.length+w.indexOf(v.value.minute)+u)%w.length;ie(w[T])}}else{const w=v.value.minute===null?-u:v.value.minute;ie((60+w+u)%60)}}}function tt(l){if(l.keyCode===13)S.value="second";else if([37,39].includes(l.keyCode)){const u=l.keyCode===37?-1:1;if(J.value!==null){const w=J.value.values;if(w.length===0)return;if(v.value.seconds===null)ue(w[0]);else{const T=(w.length+w.indexOf(v.value.second)+u)%w.length;ue(w[T])}}else{const w=v.value.second===null?-u:v.value.second;ue((60+w+u)%60)}}}function re(l){v.value.hour!==l&&(v.value.hour=l,Z())}function ie(l){v.value.minute!==l&&(v.value.minute=l,Z())}function ue(l){v.value.second!==l&&(v.value.second=l,Z())}const at={hour:re,minute:ie,second:ue};function He(){k.value===!1&&(k.value=!0,v.value.hour!==null&&(v.value.hour-=12,Z()))}function Me(){k.value===!0&&(k.value=!1,v.value.hour!==null&&(v.value.hour+=12,Z()))}function Se(l){const u=e.modelValue;S.value!==l&&u!==void 0&&u!==null&&u!==""&&typeof u!="string"&&(S.value=l)}function Z(){if(G.value!==null&&G.value(v.value.hour)!==!0){v.value=ce(),Se("hour");return}if(ae.value!==null&&ae.value(v.value.minute)!==!0){v.value.minute=null,v.value.second=null,Se("minute");return}if(e.withSeconds===!0&&ne.value!==null&&ne.value(v.value.second)!==!0){v.value.second=null,Se("second");return}v.value.hour===null||v.value.minute===null||e.withSeconds===!0&&v.value.second===null||Ae()}function Ae(l){const u=Object.assign({...v.value},l),w=e.calendar==="persian"?K(u.hour)+":"+K(u.minute)+(e.withSeconds===!0?":"+K(u.second):""):Et(new Date(u.year,u.month===null?null:u.month-1,u.day,u.hour,u.minute,u.second,u.millisecond),C.value,E.value,u.year,u.timezoneOffset);u.changed=w!==e.modelValue,a("update:modelValue",w,u)}function nt(){const l=[x("div",{class:"q-time__link "+(S.value==="hour"?"q-time__link--active":"cursor-pointer"),tabindex:i.value,onClick:De.hour,onKeyup:Ze},ve.value.hour),x("div",":"),x("div",Ce.value===!0?{class:"q-time__link "+(S.value==="minute"?"q-time__link--active":"cursor-pointer"),tabindex:i.value,onKeyup:et,onClick:De.minute}:{class:"q-time__link"},ve.value.minute)];e.withSeconds===!0&&l.push(x("div",":"),x("div",je.value===!0?{class:"q-time__link "+(S.value==="second"?"q-time__link--active":"cursor-pointer"),tabindex:i.value,onKeyup:tt,onClick:De.second}:{class:"q-time__link"},ve.value.second));const u=[x("div",{class:"q-time__header-label row items-center no-wrap",dir:"ltr"},l)];return F.value===!1&&u.push(x("div",{class:"q-time__header-ampm column items-between no-wrap"},[x("div",{class:"q-time__link "+(k.value===!0?"q-time__link--active":"cursor-pointer"),tabindex:i.value,onClick:He,onKeyup:ze},"AM"),x("div",{class:"q-time__link "+(k.value!==!0?"q-time__link--active":"cursor-pointer"),tabindex:i.value,onClick:Me,onKeyup:Ge},"PM")])),x("div",{class:"q-time__header flex flex-center no-wrap "+_.value},u)}function lt(){const l=v.value[S.value];return x("div",{class:"q-time__content col relative-position"},[x(mt,{name:"q-transition--scale"},()=>x("div",{key:"clock"+S.value,class:"q-time__container-parent absolute-full"},[x("div",{ref:y,class:"q-time__container-child fit overflow-hidden"},[Y(x("div",{class:"q-time__clock cursor-pointer non-selectable",onClick:Xe,onMousedown:Je},[x("div",{class:"q-time__clock-circle fit"},[x("div",{class:"q-time__clock-pointer"+(v.value[S.value]===null?" hidden":e.color!==void 0?` text-${e.color}`:""),style:Ue.value}),Be.value.map(u=>x("div",{class:`q-time__clock-position row flex-center q-time__clock-pos-${u.index}`+(u.val===l?" q-time__clock-position--active "+_.value:u.disable===!0?" q-time__clock-position--disable":"")},[x("span",u.label)]))])]),Qe.value)])])),e.nowBtn===!0?x(O,{class:"q-time__now-button absolute",icon:c.iconSet.datetime.now,unelevated:!0,size:"sm",round:!0,color:e.color,textColor:e.textColor,tabindex:i.value,onClick:xe}):null])}return n.proxy.setNow=xe,()=>{const l=[lt()],u=ut(t.default);return u!==void 0&&l.push(x("div",{class:"q-time__actions"},u)),e.name!==void 0&&e.disable!==!0&&s(l,"push"),x("div",{class:ge.value,tabindex:-1},[nt(),x("div",{class:"q-time__main col overflow-auto"},l)])}}});const Rt={key:0,class:"!tw-h-min !tw-w-4/12 !tw-max-w-full tw-bg-white tw-p-6"},qt={class:"tw-grid tw-gap-7"},$t={class:"tw-text-3xl tw-font-extrabold tw-flex tw-justify-between"},Vt={class:"tw-flex tw-justify-between"},Pt={class:"row items-center justify-end q-gutter-sm"},Ft={class:"row items-center justify-end q-gutter-sm"},Nt={key:1},Lt={__name:"ViewAttendance",props:["rows","column","columns","qBtnLabel","qBtnClass"],setup(e){const t=Ne(),a=N(!1),n=N(null),c=N(null),o=N(null);function i(r,s,p){c.value=_(p,s),n.value=r.row.attendance[c.value-1],a.value=!0,o.value=d(n),console.log(o.value),t.attendanceID=n.value.id,t.attendanceDate=n.value.date,t.attendanceRemarks=n.value.remarks,t.attendanceTimeIn=n.value.time_in,t.attendanceTimeOut=n.value.time_out,t.attendanceEmployeeID=n.value.employee_id,t.attendanceType=n.value.attendance_type_id,t.attendanceAdjustmentSalaryID=n.value.adjustment_salary_id}function _(r,s){return r.findIndex(p=>p.name===s.name&&p.align===s.align&&p.label===s.label&&p.sortable===s.sortable&&p.__iconClass===s.__iconClass&&p.__thClass===s.__thClass)}function d(r){const s=new Date;if(new Date(r.date)>=s)return"N/A";let b;const y=r.time_in?new Date(r.time_in):null,C=r.time_out?new Date(r.time_out):null;if(C===null&&y!==null)return"No Time Out";if(r.attendance_type_id!==1&&r.attendance_type_id!==void 0)return m(r.attendance_type.attendance_type_name);if(y){const E=new Date(y);E.setHours(8,0,0,0),y<E&&y.setHours(8,0,0,0)}if(C){const E=new Date(C);if(E.setHours(17,0,0,0),C>E&&C.setHours(17,0,0,0),y&&C){b=((C-y)/(1e3*60*60)).toFixed(2);const R=new Date(C);R.setHours(13,0,0,0),C>R&&(b=(parseFloat(b)-1).toFixed(2))}else b="No Time Out"}else b="No Time Out";return b}function m(r){return r.replace(/\b\w/g,s=>s.toUpperCase())}return(r,s)=>(j(),de(gt,null,[h(O,{unelevated:"",padding:"none",label:e.qBtnLabel,onClick:s[0]||(s[0]=p=>i(e.rows,e.column,e.columns)),class:pt(e.qBtnClass)},null,8,["label","class"]),h(vt,{modelValue:a.value,"onUpdate:modelValue":s[10]||(s[10]=p=>a.value=p),persistent:""},{default:g(()=>[n.value.id!=null&&n.value.attendance_type_id==1?(j(),de("div",Rt,[h(Ht,{onSubmit:s[9]||(s[9]=yt(p=>f(t).updateAttendance(),["prevent"]))},{default:g(()=>[D("div",qt,[D("div",$t,[D("div",null,"Attendance ID: "+V(n.value.id),1),D("div",null,V(e.column.label),1)]),D("div",null," Employee: "+V(n.value.employee.company_employee_id)+" - "+V(n.value.employee.last_name)+", "+V(n.value.employee.first_name),1),D("div",null,[q(" Remarks: "),h(te,{rounded:"",standout:"bg-teal text-white",modelValue:f(t).attendanceRemarks,"onUpdate:modelValue":s[1]||(s[1]=p=>f(t).attendanceRemarks=p),type:"textarea",autogrow:"",disable:!f(t).is_editing},null,8,["modelValue","disable"])]),D("div",Vt,[D("div",null,[q(" Time In: "),h(O,{rounded:"",standout:"bg-teal text-white",icon:"access_time",label:f(t).getFormattedTimeIn,disable:!f(t).is_editing},{default:g(()=>[h(Re,{onBeforeShow:s[4]||(s[4]=p=>f(t).updateProxy(r.isTimeIn=!0)),cover:"","transition-show":"scale","transition-hide":"scale"},{default:g(()=>[h(Ve,{modelValue:f(t).attendanceTimeInProxy,"onUpdate:modelValue":s[3]||(s[3]=p=>f(t).attendanceTimeInProxy=p),mask:"YYYY-MM-DDTHH:mm:ss","hour-options":f(t).hourOptions},{default:g(()=>[D("div",Pt,[Y(h(O,{label:"Cancel",color:"primary",flat:""},null,512),[[W]]),Y(h(O,{label:"OK",color:"primary",flat:"",onClick:s[2]||(s[2]=p=>f(t).saveProxy(r.isTimeIn=!0))},null,512),[[W]])])]),_:1},8,["modelValue","hour-options"])]),_:1})]),_:1},8,["label","disable"])]),D("div",null,[q(" Time Out: "),h(O,{rounded:"",standout:"bg-teal text-white",icon:"access_time",label:f(t).getFormattedTimeOut,disable:!f(t).is_editing},{default:g(()=>[h(Re,{onBeforeShow:s[7]||(s[7]=p=>f(t).updateProxy(r.isTimeIn=!1)),cover:"","transition-show":"scale","transition-hide":"scale"},{default:g(()=>[h(Ve,{modelValue:f(t).attendanceTimeOutProxy,"onUpdate:modelValue":s[6]||(s[6]=p=>f(t).attendanceTimeOutProxy=p),mask:"YYYY-MM-DDTHH:mm:ss","hour-options":f(t).hourOptions},{default:g(()=>[D("div",Ft,[Y(h(O,{label:"Cancel",color:"primary",flat:""},null,512),[[W]]),Y(h(O,{label:"OK",color:"primary",flat:"",onClick:s[5]||(s[5]=p=>f(t).saveProxy(r.isTimeIn=!1))},null,512),[[W]])])]),_:1},8,["modelValue","hour-options"])]),_:1})]),_:1},8,["label","disable"])])])]),h(qe,{align:"right",class:"text-primary noPrint"},{default:g(()=>[f(t).is_editing==!1?(j(),z(O,{key:0,flat:"",class:"tw-bg-green-400",icon:f(t).is_editing?"save":"edit",label:f(t).is_editing?"Save":"Edit",onClick:s[8]||(s[8]=p=>f(t).is_editing=!0)},null,8,["icon","label"])):(j(),z(O,{key:1,flat:"",type:"submit",class:"tw-bg-green-400",icon:f(t).is_editing?"save":"edit",label:f(t).is_editing?"Save":"Edit"},null,8,["icon","label"])),Y(h(O,{flat:"",label:"CLOSE",onClick:f(t).resetForm},null,8,["onClick"]),[[W]])]),_:1})]),_:1})])):(j(),de("div",Nt,[q(V(n.value)+" ",1),h(qe,{align:"right",class:"text-primary noPrint"},{default:g(()=>[Y(h(O,{flat:"",label:"Cancel"},null,512),[[W]])]),_:1})]))]),_:1},8,["modelValue"])],64))}},Ut=D("div",{class:"tw-text-xl, tw-font-bold"},"Attendance Report",-1),jt=D("div",{class:"tw-w-3"},null,-1),Bt=D("div",{class:"tw-flex tw-items-center tw-ml-5"},[D("div",{class:"tw-flex tw-items-center tw-mr-3"},[D("div",{class:"tw-rounded-lg tw-w-3 tw-h-6 !tw-bg-[#4ade80]"}),D("div",{class:"tw-ml-2"},"Present")]),D("div",{class:"tw-flex tw-items-center tw-mr-3"},[D("div",{class:"tw-rounded-lg tw-w-3 tw-h-6 !tw-bg-[#f87171]"}),D("div",{class:"tw-ml-2"},"Absent")]),D("div",{class:"tw-flex tw-items-center tw-mr-3"},[D("div",{class:"tw-rounded-lg tw-w-3 tw-h-6 !tw-bg-[#fb923c]"}),D("div",{class:"tw-ml-2"},"Late")]),D("div",{class:"tw-flex tw-items-center tw-mr-3"},[D("div",{class:"tw-rounded-lg tw-w-3 tw-h-6 !tw-bg-[#ec4899]"}),D("div",{class:"tw-ml-2"},"Undertime")]),D("div",{class:"tw-flex tw-items-center tw-mr-3"},[D("div",{class:"tw-rounded-lg tw-w-3 tw-h-6 !tw-bg-[#3b82f6]"}),D("div",{class:"tw-ml-2"},"Leave")]),D("div",{class:"tw-flex tw-items-center tw-mr-3"},[D("div",{class:"tw-rounded-lg tw-w-3 tw-h-6 !tw-bg-[#fef08a]"}),D("div",{class:"tw-ml-2"},"Holiday")])],-1),Qt={__name:"AttendanceTable",setup(e){Ne().fetchAttendanceType();const a=Fe(),n=N("");function c(m){const r=document.getElementById(m);let s="";s+=Array.from(r.querySelectorAll("th")).map(v=>v.innerText.replace(/arrow_upward/g,"")).join(",")+`
`,Array.from(r.querySelectorAll("tr")).slice(1).forEach(v=>{s+=Array.from(v.querySelectorAll("td")).map(ge=>ge.innerText).join(",")+`
`});const y=new Date,C={month:"short",day:"2-digit",year:"numeric"},E=y.toLocaleDateString("en-US",C).replace(",","").replace(/\s+/g,"-"),R=new Blob([s],{type:"text/csv;charset=utf-8;"}),B=URL.createObjectURL(R),S=document.createElement("a");S.setAttribute("href",B),S.setAttribute("download",`Attendance-Report-${E}.csv`),document.body.appendChild(S),S.click(),document.body.removeChild(S),URL.revokeObjectURL(B)}a.fetchAttendanceReports();function o(m,r){return m.findIndex(s=>s.name===r.name&&s.align===r.align&&s.label===r.label&&s.sortable===r.sortable&&s.__iconClass===r.__iconClass&&s.__thClass===r.__thClass)}function i(m,r,s){const p=o(m,r),b=s.row.attendance[p-1];return b.attendance_type_id===2?"LEAVE":_(b)}function _(m){if(m.attendance_type==null)return 0;if(m.attendance_type.id!==1)return 8;let r=new Date(m.time_in);r.setMilliseconds(0);let s=new Date(m.time_out);s.setMilliseconds(0);const p=new Date(r);p.setHours(8,0,0),r<p&&r.setHours(8,0,0);const b=new Date(s);b.setHours(17,0,0),s>b&&s.setHours(17,0,0);let y=(s-r)/(1e3*60);const C=new Date(s);C.setHours(13,0,0);const E=new Date(s);E.setHours(12,0,0),s>C&&r<E&&(y-=60);const R=Math.floor(y/60)+y%60/60;return d(R)}function d(m){const r=Math.floor(m),s=Math.floor((m-r)*60);return r+"."+s}return(m,r)=>(j(),z(ye,{id:"attendance-table",class:"tw-border tw-rounded-3xl tw-shadow-lg",flat:"",bordered:"",dense:"",title:"Attendance Report","title-class":["tw-text-xl","tw-font-bold"],filter:n.value,columns:f(a).attendanceColumns.columns,rows:f(a).rows,"rows-per-page-options":[0],separator:"cell","row-key":"name"},{"top-right":g(()=>[h(O,{color:"blue","icon-right":"archive",label:"Export to CSV","no-caps":"",onClick:r[0]||(r[0]=s=>c("attendance-table")),class:"tw-mr-16"}),h(te,{borderless:"",dense:"",debounce:"300",modelValue:n.value,"onUpdate:modelValue":r[1]||(r[1]=s=>n.value=s),placeholder:"Search"},{append:g(()=>[h(me,{name:"search"})]),_:1},8,["modelValue"])]),"body-cell-actions":g(s=>[h(P,{key:"actions",class:"!tw-w-20 !tw-p-0",props:s},{default:g(()=>[h(Lt,{rows:s,columns:s.cols,qBtnLabel:i(s.cols,s.col,s),column:s.col},null,8,["rows","columns","qBtnLabel","column"])]),_:2},1032,["props"])]),"top-left":g(()=>[Ut,jt,h(pe,{rounded:"",standout:"",modelValue:f(a).selectedDate,"onUpdate:modelValue":[r[2]||(r[2]=s=>f(a).selectedDate=s),r[3]||(r[3]=s=>f(a).fetchAttendanceReports())],"use-input":"","hide-selected":"","fill-input":"","hide-bottom-space":"","input-debounce":"0",options:f(a).selectedDateOptions,"option-label":s=>s.date_start+" "+s.date_end,class:"!tw-pb-0"},{"no-option":g(()=>[h(he,null,{default:g(()=>[h(fe,{class:"text-grey"},{default:g(()=>[q(" No results ")]),_:1})]),_:1})]),_:1},8,["modelValue","options","option-label"])]),bottom:g(()=>[Bt]),_:1},8,["filter","columns","rows"]))}},Yt=ee("philhealthTable",{state:()=>({rows:[],columns:[{name:"employeeId",required:!0,label:"Emp. Id",field:e=>e.employee.company_employee_id,align:"left",sortable:!0},{name:"employeeName",align:"center",label:"Name",field:e=>e.employee.last_name+" "+e.employee.first_name+" "+e.employee.middle_name,sortable:!0,classes:"!tw-bg-neutral-300"},{name:"philhealthNumber",align:"center",label:"PhilHealth No.",field:e=>e.employee.phil_health_number,sortable:!0,classes:"!tw-bg-neutral-300"},{name:"employeeShare",align:"center",label:"Employee Share",field:e=>e.amount,sortable:!0,classes:"!tw-bg-neutral-300"},{name:"employerShare",align:"center",label:"Employer Share",field:e=>e.amount,sortable:!0,classes:"!tw-bg-neutral-300"}],selectedDate:null,selectedDateOptions:null,employeeIds:[],philhealthAudit:[],philhealthContributionTableAudit:[]}),getters:{getSelectedDate(){return this.selectedDate},getTotalEmployeeShare(){let e=0;return this.philhealthAudit.forEach(t=>{e+=t.amount}),e}},actions:{capitalizeFirstLetterOfEachWord(e){return e.split(" ").map(t=>t.charAt(0).toUpperCase()+t.slice(1)).join(" ")},formatDate(e){const t=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0"),n=String(e.getDate()).padStart(2,"0");return`${t}-${a}-${n}`},getEmployeeIds(e){return e.map(t=>t.employee_id)},getAndCheckDateRangesForCurrentMonth(){const e=new Date,t=e.getFullYear(),a=e.getMonth(),n=new Date(t,a,1),c=new Date(t,a,15),o=new Date(t,a,16),i=new Date(t,a+1,0),_={firstHalf:{start:this.formatDate(n),end:this.formatDate(c)},secondHalf:{start:this.formatDate(o),end:this.formatDate(i)}},d=this.formatDate(e),m=new Date(_.firstHalf.start),r=new Date(_.firstHalf.end),s=new Date(_.secondHalf.start),p=new Date(_.secondHalf.end);let b,y;return e>=m&&e<=r?(b=this.formatDate(m),y=this.formatDate(r)):e>=s&&e<=p?(b=this.formatDate(s),y=this.formatDate(p)):(b="out of range",y="out of range"),{todayDate:d,startDate:b,endDate:y}},async getSalaryHistory(){try{const{data:e,error:t}=await M.from("salary_history").select();t&&console.error(t),this.selectedDateOptions=e.sort((a,n)=>new Date(a.date_start)-new Date(n.date_start))}catch(e){console.error(e)}},filterHighestAuditId(e){const t=e.reduce((a,n)=>{const{employee_id:c,audit_id:o}=n;return(!a[c]||a[c].audit_id<o)&&(a[c]=n),a},{});return Object.values(t)},getHighestAuditId(e){return e.length===0?null:e.reduce((a,n)=>n.audit_id>a.audit_id?n:a)},async fetchEmployeeInRange(e=this.selectedDate.date_end){try{const{data:t,error:a}=await M.from("employee_audit").select("*").lte("change_date",e).eq("is_archive",!1);a&&console.error(a),this.rows=this.filterHighestAuditId(t),this.employeeIds=this.getEmployeeIds(this.rows)}catch(t){console.error(t)}},async fetchPhilhealthContribAudit(e=this.selectedDate.date_end){try{const{data:t,error:a}=await M.from("emp_philhealth_contrib_audit").select("*, employee!emp_philhealth_contrib_audit_employee_id_fkey(last_name, first_name, middle_name, company_employee_id, phil_health_number, is_archive)").lte("change_date",e).eq("employee.is_archive",!1).in("employee_id",this.employeeIds);a&&console.error(a),this.philhealthAudit=this.filterHighestAuditId(t.filter(n=>n.employee!==null))}catch(t){console.error(t)}},async fetchPhilhealthContributionTableAudit(e=this.selectedDate.date_end){try{const{data:t,error:a}=await M.from("philhealth_contribution_table_audit").select("*").lte("change_date",e);a&&console.error(a),this.philhealthContributionTableAudit=this.getHighestAuditId(t)}catch(t){console.error(t)}},getNearestDateRange(){if(this.selectedDate!=null)return;const e=new Date;function t(o){return new Date(o)}function a(o){return Math.abs(e-o)}let n=null,c=1/0;for(const o of this.selectedDateOptions){const i=t(o.date_start),_=t(o.date_end),d=a(i),m=a(_),r=Math.min(d,m);r<c&&(c=r,n=o)}this.selectedDate=n},async fetchEmployeeReports(){await this.getSalaryHistory(),await this.getNearestDateRange(),await this.fetchEmployeeInRange(),await this.fetchPhilhealthContribAudit(),await this.fetchPhilhealthContributionTableAudit()}}}),Kt=D("div",{class:"tw-text-xl, tw-font-bold"},"PhilHealth Report",-1),Wt=D("div",{class:"tw-w-3"},null,-1),zt={__name:"PhilhealthTable",setup(e){const t=Yt(),a=N("");function n(c){const o=document.getElementById(c);let i="";i+=Array.from(o.querySelectorAll("th")).map(C=>C.innerText.replace(/arrow_upward/g,"")).join(",")+`
`,Array.from(o.querySelectorAll("tr")).slice(1).forEach(C=>{i+=Array.from(C.querySelectorAll("td")).map(R=>R.innerText).join(",")+`
`});const m=new Date,r={month:"short",day:"2-digit",year:"numeric"},s=m.toLocaleDateString("en-US",r).replace(",","").replace(/\s+/g,"-"),p=new Blob([i],{type:"text/csv;charset=utf-8;"}),b=URL.createObjectURL(p),y=document.createElement("a");y.setAttribute("href",b),y.setAttribute("download",`Philhealth-Report-${s}.csv`),document.body.appendChild(y),y.click(),document.body.removeChild(y),URL.revokeObjectURL(b)}return t.fetchEmployeeReports(),(c,o)=>(j(),z(ye,{id:"philhealth-table",class:"tw-border tw-rounded-3xl tw-shadow-lg",flat:"",bordered:"",dense:"",title:"Attendance Report","title-class":["tw-text-xl","tw-font-bold"],filter:a.value,columns:f(t).columns,rows:f(t).philhealthAudit,"rows-per-page-options":[0],separator:"cell","row-key":"name"},{"top-right":g(()=>[h(O,{color:"blue","icon-right":"archive",label:"Export to CSV","no-caps":"",onClick:o[0]||(o[0]=i=>n("philhealth-table")),class:"tw-mr-16"}),h(te,{borderless:"",dense:"",debounce:"300",modelValue:a.value,"onUpdate:modelValue":o[1]||(o[1]=i=>a.value=i),placeholder:"Search"},{append:g(()=>[h(me,{name:"search"})]),_:1},8,["modelValue"])]),"top-left":g(()=>[Kt,Wt,h(pe,{rounded:"",standout:"",modelValue:f(t).selectedDate,"onUpdate:modelValue":[o[2]||(o[2]=i=>f(t).selectedDate=i),o[3]||(o[3]=i=>f(t).fetchEmployeeReports())],"use-input":"","hide-selected":"","fill-input":"","hide-bottom-space":"","input-debounce":"0",options:f(t).selectedDateOptions,"option-label":i=>i.date_start+" "+i.date_end,class:"!tw-pb-0"},{"no-option":g(()=>[h(he,null,{default:g(()=>[h(fe,{class:"text-grey"},{default:g(()=>[q(" No results ")]),_:1})]),_:1})]),_:1},8,["modelValue","options","option-label"])]),"bottom-row":g(()=>[h(Te,null,{default:g(()=>[h(P,{colspan:"3"}),h(P,{class:"tw-text-center"},{default:g(()=>[q(" Total Employee Share: "+V(f(t).getTotalEmployeeShare),1)]),_:1}),h(P,{class:"tw-text-center"},{default:g(()=>[q(" Total Employer Share: "+V(f(t).getTotalEmployeeShare),1)]),_:1})]),_:1})]),bottom:g(()=>[]),_:1},8,["filter","columns","rows"]))}};function Le(e){var t=e.toString().match(/^-?\d+(?:\.\d{0,2})?/)[0];return parseFloat(t)}function Gt(e,t=30){return Le(e*t)}function Pe(e){const t=Gt(e);let a,n;return t<=1500?(a=.01,n=Math.min(t,1e4)*a):(a=.02,n=Math.min(t,1e4)*a),Le(n)}const Xt=ee("pagibigTable",{state:()=>({rows:[],columns:[{name:"employeeId",required:!0,label:"Emp. Id",field:e=>e.employee.company_employee_id,align:"left",sortable:!0},{name:"employeeName",align:"center",label:"Name",field:e=>e.employee.last_name+" "+e.employee.first_name+" "+e.employee.middle_name,sortable:!0,classes:"!tw-bg-neutral-300"},{name:"pagibigNumber",align:"center",label:"Pagibig No.",field:e=>e.employee.pag_ibig_number,sortable:!0,classes:"!tw-bg-neutral-300"},{name:"employeeShare",align:"center",label:"Employee Share",field:e=>e.amount,sortable:!0,classes:"!tw-bg-neutral-300"},{name:"employerShare",align:"center",label:"Employer Share",field:e=>Pe(e.employee.rate_per_day),sortable:!0,classes:"!tw-bg-neutral-300"}],selectedDate:null,selectedDateOptions:null,employeeIds:[],pagibigAudit:[],pagibigContributionTableAudit:[]}),getters:{getSelectedDate(){return this.selectedDate},getTotalEmployerShare(){let e=0;return this.pagibigAudit.forEach(t=>{e+=Pe(t.amount)}),e},getTotalEmployeeShare(){let e=0;return this.pagibigAudit.forEach(t=>{e+=t.amount}),e}},actions:{capitalizeFirstLetterOfEachWord(e){return e.split(" ").map(t=>t.charAt(0).toUpperCase()+t.slice(1)).join(" ")},formatDate(e){const t=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0"),n=String(e.getDate()).padStart(2,"0");return`${t}-${a}-${n}`},getEmployeeIds(e){return e.map(t=>t.employee_id)},getAndCheckDateRangesForCurrentMonth(){const e=new Date,t=e.getFullYear(),a=e.getMonth(),n=new Date(t,a,1),c=new Date(t,a,15),o=new Date(t,a,16),i=new Date(t,a+1,0),_={firstHalf:{start:this.formatDate(n),end:this.formatDate(c)},secondHalf:{start:this.formatDate(o),end:this.formatDate(i)}},d=this.formatDate(e),m=new Date(_.firstHalf.start),r=new Date(_.firstHalf.end),s=new Date(_.secondHalf.start),p=new Date(_.secondHalf.end);let b,y;return e>=m&&e<=r?(b=this.formatDate(m),y=this.formatDate(r)):e>=s&&e<=p?(b=this.formatDate(s),y=this.formatDate(p)):(b="out of range",y="out of range"),{todayDate:d,startDate:b,endDate:y}},async getSalaryHistory(){try{const{data:e,error:t}=await M.from("salary_history").select();t&&console.error(t),this.selectedDateOptions=e.sort((a,n)=>new Date(a.date_start)-new Date(n.date_start))}catch(e){console.error(e)}},filterHighestAuditId(e){const t=e.reduce((a,n)=>{const{employee_id:c,audit_id:o}=n;return(!a[c]||a[c].audit_id<o)&&(a[c]=n),a},{});return Object.values(t)},getHighestAuditId(e){return e.length===0?null:e.reduce((a,n)=>n.audit_id>a.audit_id?n:a)},async fetchEmployeeInRange(e=this.selectedDate.date_end){try{const{data:t,error:a}=await M.from("employee_audit").select("*").lte("change_date",e).eq("is_archive",!1);a&&console.error(a),this.rows=this.filterHighestAuditId(t),this.employeeIds=this.getEmployeeIds(this.rows)}catch(t){console.error(t)}},async fetchPagibigContribAudit(e=this.selectedDate.date_end){try{const{data:t,error:a}=await M.from("emp_pagibig_contrib_audit").select("*, employee!emp_pagibig_contrib_audit_employee_id_fkey(last_name, first_name, middle_name, company_employee_id, pag_ibig_number, rate_per_day, is_archive)").lte("change_date",e).eq("employee.is_archive",!1).in("employee_id",this.employeeIds);a&&console.error(a),this.pagibigAudit=this.filterHighestAuditId(t.filter(n=>n.employee!==null)),console.log(t)}catch(t){console.error(t)}},async fetchPagibigContributionTableAudit(e=this.selectedDate.date_end){try{const{data:t,error:a}=await M.from("pagibig_contribution_table_audit").select("*").lte("change_date",e);a&&console.error(a),this.pagibigContributionTableAudit=this.getHighestAuditId(t)}catch(t){console.error(t)}},getNearestDateRange(){if(this.selectedDate!=null)return;const e=new Date;function t(o){return new Date(o)}function a(o){return Math.abs(e-o)}let n=null,c=1/0;for(const o of this.selectedDateOptions){const i=t(o.date_start),_=t(o.date_end),d=a(i),m=a(_),r=Math.min(d,m);r<c&&(c=r,n=o)}this.selectedDate=n},async fetchEmployeeReports(){await this.getSalaryHistory(),await this.getNearestDateRange(),await this.fetchEmployeeInRange(),await this.fetchPagibigContribAudit(),await this.fetchPagibigContributionTableAudit()}}}),Jt=D("div",{class:"tw-text-xl, tw-font-bold"},"Pag-IBIG Report",-1),Zt=D("div",{class:"tw-w-3"},null,-1),ea={__name:"PagibigTable",setup(e){const t=Xt(),a=N("");function n(c){const o=document.getElementById(c);let i="";i+=Array.from(o.querySelectorAll("th")).map(C=>C.innerText.replace(/arrow_upward/g,"")).join(",")+`
`,Array.from(o.querySelectorAll("tr")).slice(1).forEach(C=>{i+=Array.from(C.querySelectorAll("td")).map(R=>R.innerText).join(",")+`
`});const m=new Date,r={month:"short",day:"2-digit",year:"numeric"},s=m.toLocaleDateString("en-US",r).replace(",","").replace(/\s+/g,"-"),p=new Blob([i],{type:"text/csv;charset=utf-8;"}),b=URL.createObjectURL(p),y=document.createElement("a");y.setAttribute("href",b),y.setAttribute("download",`Pag-IBIG-Report-${s}.csv`),document.body.appendChild(y),y.click(),document.body.removeChild(y),URL.revokeObjectURL(b)}return t.fetchEmployeeReports(),(c,o)=>(j(),z(ye,{id:"pagibig-table",class:"tw-border tw-rounded-3xl tw-shadow-lg",flat:"",bordered:"",dense:"",title:"Attendance Report","title-class":["tw-text-xl","tw-font-bold"],filter:a.value,columns:f(t).columns,rows:f(t).pagibigAudit,"rows-per-page-options":[0],separator:"cell","row-key":"name"},{"top-right":g(()=>[h(O,{color:"blue","icon-right":"archive",label:"Export to CSV","no-caps":"",onClick:o[0]||(o[0]=i=>n("pagibig-table")),class:"tw-mr-16"}),h(te,{borderless:"",dense:"",debounce:"300",modelValue:a.value,"onUpdate:modelValue":o[1]||(o[1]=i=>a.value=i),placeholder:"Search"},{append:g(()=>[h(me,{name:"search"})]),_:1},8,["modelValue"])]),"top-left":g(()=>[Jt,Zt,h(pe,{rounded:"",standout:"",modelValue:f(t).selectedDate,"onUpdate:modelValue":[o[2]||(o[2]=i=>f(t).selectedDate=i),o[3]||(o[3]=i=>f(t).fetchEmployeeReports())],"use-input":"","hide-selected":"","fill-input":"","hide-bottom-space":"","input-debounce":"0",options:f(t).selectedDateOptions,"option-label":i=>i.date_start+" "+i.date_end,class:"!tw-pb-0"},{"no-option":g(()=>[h(he,null,{default:g(()=>[h(fe,{class:"text-grey"},{default:g(()=>[q(" No results ")]),_:1})]),_:1})]),_:1},8,["modelValue","options","option-label"])]),"bottom-row":g(()=>[h(Te,null,{default:g(()=>[h(P,{colspan:"3"}),h(P,{class:"tw-text-center"},{default:g(()=>[q(" Total Employee Share: "+V(f(t).getTotalEmployeeShare),1)]),_:1}),h(P,{class:"tw-text-center"},{default:g(()=>[q(" Total Employer Share: "+V(f(t).getTotalEmployerShare),1)]),_:1})]),_:1})]),bottom:g(()=>[]),_:1},8,["filter","columns","rows"]))}},ta=ee("sssTable",{state:()=>({rows:[],columns:[],selectedDate:null,selectedDateOptions:null,employeeIds:[],sssAudit:[],sssContributionTableAudit:[]}),getters:{getSelectedDate(){return this.selectedDate},getTotalEmployeeShare(){let e=0;return this.sssAudit.forEach(t=>{e+=t.amount}),e},getTotalEmployerShare(){let e=0;return this.sssAudit.forEach(t=>{e+=typeof this.getEmployerShare(t.amount)=="number"?this.getEmployerShare(t.amount):0}),e},getTotalECEmployerShare(){let e=0;return this.sssAudit.forEach(t=>{e+=typeof this.getECER(t.amount)=="number"?this.getECER(t.amount):0}),e}},actions:{setColumns(){this.columns=[{name:"employeeId",required:!0,label:"Emp. Id",field:e=>e.employee.company_employee_id,align:"left",sortable:!0},{name:"employeeName",align:"center",label:"Name",field:e=>e.employee.last_name+" "+e.employee.first_name+" "+e.employee.middle_name,sortable:!0,classes:"!tw-bg-neutral-300"},{name:"sssNumber",align:"center",label:"SSS No.",field:e=>e.employee.sss_number,sortable:!0,classes:"!tw-bg-neutral-300"},{name:"employeeShare",align:"center",label:"Employee Share",field:e=>e.amount,sortable:!0,classes:"!tw-bg-neutral-300"},{name:"employerShare",align:"center",label:"Employer Share",field:e=>this.getEmployerShare(e.amount),sortable:!0,classes:"!tw-bg-neutral-300"},{name:"ecEmployerShare",align:"center",label:"EC Employer Share",field:e=>this.getECER(e.amount),sortable:!0,classes:"!tw-bg-neutral-300"}]},getEmployerShare(e){console.log(e,this.sssContributionTableAudit);for(const t of this.sssContributionTableAudit)if(e==t.ee_share)return t.er_share;return"Out of range"},getECER(e){for(const t of this.sssContributionTableAudit)if(e==t.ee_share)return t.ec_er_share;return"Out of range"},capitalizeFirstLetterOfEachWord(e){return e.split(" ").map(t=>t.charAt(0).toUpperCase()+t.slice(1)).join(" ")},formatDate(e){const t=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0"),n=String(e.getDate()).padStart(2,"0");return`${t}-${a}-${n}`},getEmployeeIds(e){return e.map(t=>t.employee_id)},getAndCheckDateRangesForCurrentMonth(){const e=new Date,t=e.getFullYear(),a=e.getMonth(),n=new Date(t,a,1),c=new Date(t,a,15),o=new Date(t,a,16),i=new Date(t,a+1,0),_={firstHalf:{start:this.formatDate(n),end:this.formatDate(c)},secondHalf:{start:this.formatDate(o),end:this.formatDate(i)}},d=this.formatDate(e),m=new Date(_.firstHalf.start),r=new Date(_.firstHalf.end),s=new Date(_.secondHalf.start),p=new Date(_.secondHalf.end);let b,y;return e>=m&&e<=r?(b=this.formatDate(m),y=this.formatDate(r)):e>=s&&e<=p?(b=this.formatDate(s),y=this.formatDate(p)):(b="out of range",y="out of range"),{todayDate:d,startDate:b,endDate:y}},async getSalaryHistory(){try{const{data:e,error:t}=await M.from("salary_history").select();t&&console.error(t),this.selectedDateOptions=e.sort((a,n)=>new Date(a.date_start)-new Date(n.date_start))}catch(e){console.error(e)}},filterHighestAuditId(e){const t=e.reduce((a,n)=>{const{employee_id:c,audit_id:o}=n;return(!a[c]||a[c].audit_id<o)&&(a[c]=n),a},{});return Object.values(t)},getHighestAuditId(e){return e.length===0?null:e.reduce((a,n)=>n.audit_id>a.audit_id?n:a)},async fetchEmployeeInRange(e=this.selectedDate.date_end){try{const{data:t,error:a}=await M.from("employee_audit").select("*").lte("change_date",e).eq("is_archive",!1);a&&console.error(a),this.rows=this.filterHighestAuditId(t),this.employeeIds=this.getEmployeeIds(this.rows)}catch(t){console.error(t)}},async fetchSssContribAudit(e=this.selectedDate.date_end){try{const{data:t,error:a}=await M.from("emp_sss_contrib_audit").select("*, employee!emp_sss_contrib_audit_employee_id_fkey(last_name, first_name, middle_name, company_employee_id, sss_number, is_archive)").lte("change_date",e).eq("employee.is_archive",!1).in("employee_id",this.employeeIds);a&&console.error(a),this.sssAudit=this.filterHighestAuditId(t.filter(n=>n.employee!==null))}catch(t){console.error(t)}},async fetchSssContributionTableAudit(e=this.selectedDate.date_end){try{const{data:t,error:a}=await M.from("sss_contribution_table_audit").select("*").lte("change_date",e);a&&console.error(a),this.sssContributionTableAudit=this.getHighestAuditId(t),this.sssContributionTableAudit=this.sssContributionTableAudit.data.map(n=>{const c=n.combinedValue;let o,i,_,d,m;if(_=parseFloat(n.values[4].replace(",","")),d=parseFloat(n.values[3].replace(",","")),m=parseFloat(n.values[6].replace(",","")),c.startsWith("Below"))o=0,i=parseFloat(c.split(" ")[1].replace(",",""));else if(c.includes("Over"))o=parseFloat(c.split(" ")[0].replace(",","")),i=null;else{const[r,s]=c.split(" - ");o=parseFloat(r.replace(",","")),i=parseFloat(s.replace(",",""))}return{min:o,max:i,ee_share:_,er_share:d,ec_er_share:m}}),this.setColumns()}catch(t){console.error(t)}},getNearestDateRange(){if(this.selectedDate!=null)return;const e=new Date;function t(o){return new Date(o)}function a(o){return Math.abs(e-o)}let n=null,c=1/0;for(const o of this.selectedDateOptions){const i=t(o.date_start),_=t(o.date_end),d=a(i),m=a(_),r=Math.min(d,m);r<c&&(c=r,n=o)}this.selectedDate=n},async fetchEmployeeReports(){await this.getSalaryHistory(),await this.getNearestDateRange(),await this.fetchSssContributionTableAudit(),await this.fetchEmployeeInRange(),await this.fetchSssContribAudit()}}}),aa=D("div",{class:"tw-text-xl, tw-font-bold"},"SSS Report",-1),na=D("div",{class:"tw-w-3"},null,-1),la={__name:"SssTable",setup(e){const t=ta(),a=N("");function n(c){const o=document.getElementById(c);let i="";i+=Array.from(o.querySelectorAll("th")).map(C=>C.innerText.replace(/arrow_upward/g,"")).join(",")+`
`,Array.from(o.querySelectorAll("tr")).slice(1).forEach(C=>{i+=Array.from(C.querySelectorAll("td")).map(R=>R.innerText).join(",")+`
`});const m=new Date,r={month:"short",day:"2-digit",year:"numeric"},s=m.toLocaleDateString("en-US",r).replace(",","").replace(/\s+/g,"-"),p=new Blob([i],{type:"text/csv;charset=utf-8;"}),b=URL.createObjectURL(p),y=document.createElement("a");y.setAttribute("href",b),y.setAttribute("download",`SSS-Report-${s}.csv`),document.body.appendChild(y),y.click(),document.body.removeChild(y),URL.revokeObjectURL(b)}return t.fetchEmployeeReports(),(c,o)=>(j(),z(ye,{id:"sss-table",class:"tw-border tw-rounded-3xl tw-shadow-lg",flat:"",bordered:"",dense:"",title:"Attendance Report",filter:a.value,columns:f(t).columns,rows:f(t).sssAudit,"rows-per-page-options":[0],separator:"cell","row-key":"name"},{"top-right":g(()=>[h(O,{color:"blue","icon-right":"archive",label:"Export to CSV","no-caps":"",onClick:o[0]||(o[0]=i=>n("sss-table")),class:"tw-mr-16"}),h(te,{borderless:"",dense:"",debounce:"300",modelValue:a.value,"onUpdate:modelValue":o[1]||(o[1]=i=>a.value=i),placeholder:"Search"},{append:g(()=>[h(me,{name:"search"})]),_:1},8,["modelValue"])]),"top-left":g(()=>[aa,na,h(pe,{rounded:"",standout:"",modelValue:f(t).selectedDate,"onUpdate:modelValue":[o[2]||(o[2]=i=>f(t).selectedDate=i),o[3]||(o[3]=i=>f(t).fetchEmployeeReports())],"use-input":"","hide-selected":"","fill-input":"","hide-bottom-space":"","input-debounce":"0",options:f(t).selectedDateOptions,"option-label":i=>i.date_start+" "+i.date_end,class:"!tw-pb-0"},{"no-option":g(()=>[h(he,null,{default:g(()=>[h(fe,{class:"text-grey"},{default:g(()=>[q(" No results ")]),_:1})]),_:1})]),_:1},8,["modelValue","options","option-label"])]),"bottom-row":g(()=>[h(Te,null,{default:g(()=>[h(P),h(P),h(P),h(P,{class:"tw-text-center"},{default:g(()=>[q(" Total EE Share: "+V(f(t).getTotalEmployeeShare),1)]),_:1}),h(P,{class:"tw-text-center"},{default:g(()=>[q(" Total ER Share: "+V(f(t).getTotalEmployerShare),1)]),_:1}),h(P,{class:"tw-text-center"},{default:g(()=>[q(" Total EC ER Share: "+V(f(t).getTotalECEmployerShare),1)]),_:1})]),_:1})]),bottom:g(()=>[]),_:1},8,["filter","columns","rows"]))}},oa={class:"tw-w-12/12 tw-max-w-full tw-mx-auto tw-bg-white tw-shadow-lg tw-border tw-rounded-3xl tw-border-collapse tw-p-4 tw-mt-0"},sa=D("br",null,null,-1),ra=D("br",null,null,-1),ia=D("br",null,null,-1),ua=D("br",null,null,-1),xa={__name:"AdminReportsPage",setup(e){const t=rt();return t.currentPage="Reports",(a,n)=>(j(),de("div",oa,[D("div",null,[h(Qt),sa,h(zt),ra,h(ea),ia,h(la),ua])]))}};export{xa as default};
