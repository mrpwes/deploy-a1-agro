import{ar as D,as as m,u as Q,r as q,o as f,c as w,d as r,Q as v,w as c,a as n,a8 as _,g as k,a5 as V,a6 as S,G as C,S as h,a7 as A,e as g,f as N}from"./index.fa342762.js";import{Q as R}from"./QInput.d41ba563.js";import{Q as E}from"./QDate.3f2630ec.js";import{Q as L}from"./QPopupProxy.93ccc85a.js";import{C as y,Q as I}from"./ClosePopup.bcad9a93.js";import{Q as U}from"./position-engine.573b6235.js";import{u as $}from"./globalNotification.d7c9769f.js";const u=$(),x=D("viewApproval",{state:()=>({rows:[],columns:[{name:"id",align:"center",label:"Request ID",field:e=>e.id,format:e=>`${e}`,sortable:!0},{name:"employeeName",align:"center",label:"Employee Name",field:e=>e.employee_id.first_name+" "+e.employee_id.last_name,format:e=>`${e}`,sortable:!0},{name:"type",align:"center",label:"Type",format:()=>"Leave",sortable:!0},{name:"description",align:"center",label:"Description",field:e=>e.description,format:e=>`${e}`,sortable:!0},{name:"status",align:"center",label:"Status",field:e=>{if(e.is_approved===null)return"Pending";if(e.is_approved===!0)return"Approved - "+e.admin_id.first_name+" "+e.admin_id.last_name;if(e.is_approved===!1)return"Declined - "+e.admin_id.first_name+" "+e.admin_id.last_name},format:e=>`${e}`,sortable:!0},{name:"actions",align:"center",label:"",field:""}]}),getters:{getArchivedApprovalList(e){return e.rows.filter(t=>t.is_archive===!0)},getUnarchivedApprovalList(e){return this.rows.sort((t,o)=>t.id-o.id)}},actions:{async getRequestList(){try{const{data:e,error:t}=await m.from("leave_request").select("*, employee_id(id,first_name, last_name, company_employee_id), admin_id(first_name, last_name, company_employee_id)");if(t)throw t;this.rows=e}catch(e){console.log(e)}},async insertAttendance(e,t){try{const o=new Date(t);o.setHours(8,0,0,0);const s=new Date(t);s.setHours(17,0,0,0);const{data:a,error:p}=await m.from("attendance").insert({employee_id:e,adjustment_salary_id:2,time_in:o,time_out:s,attendance_type_id:2,date:t});if(p)throw p;u.showSuccessNotification("Leave Added")}catch(o){console.log(o),u.showErrorNotification("Failed to add Leave, please try again")}},async checkAttendance(e,t){try{const{data:o,error:s}=await m.from("attendance").select("id").eq("employee_id",e).eq("date",t);if(s)throw s;if(o&&o.length>0){const a=await this.deleteAttendance(o[0].id);if(a)throw a}return o}catch(o){console.log(o),u.showErrorNotification("Failed to check attendance, please try again")}},async deleteAttendance(e){try{const{error:t}=await m.from("attendance").delete().eq("id",e);if(t)throw t;return null}catch(t){return console.log(t),u.showErrorNotification("Failed to delete attendance, please try again"),t}},async approveRequest(e,t,o,s){try{for(const d of s)await this.checkAttendance(o,d.date);const{data:a,error:p}=await m.from("leave_request").update({is_approved:!0,admin_id:t}).eq("id",e);if(p)throw p;this.getRequestList(),u.showSuccessNotification("Request Approved");for(const d of s)await this.insertAttendance(o,d.date)}catch(a){console.log(a),u.showErrorNotification("Failed to approve request, please try again")}},async declineRequest(e,t){try{const{data:o,error:s}=await m.from("leave_request").update({is_approved:!1,admin_id:t}).eq("id",e);if(s)throw s;this.getRequestList(),u.showSuccessNotification("Request Declined")}catch(o){console.log(o),u.showErrorNotification("Failed to decline request, please try again")}}}}),B={class:"!tw-h-min !tw-w-4/12 !tw-max-w-full tw-bg-white tw-p-6"},F={class:"tw-grid tw-grid-cols-3 tw-gap-5 tw-pb-5"},P={class:"tw-col-span-2 tw-text-end"},j={key:0,class:"tw-col-span-2"},O=n("div",{class:"tw-col-span-3"},"Description:",-1),G={class:"tw-col-span-3"},H=n("div",{class:"tw-col-span-3"},"Leave Request Contents:",-1),T={class:"tw-col-span-1"},z=["dense"],J={class:"row items-center justify-end"},te={__name:"ViewApprovalButton",props:["rows"],setup(e){const t=Q(),o=x(),s=q(!1),a=q(null);function p(d){a.value=d,s.value=!0}return(d,l)=>(f(),w(V,null,[r(v,{icon:"visibility",label:"View",onClick:l[0]||(l[0]=i=>p(e.rows))}),r(U,{modelValue:s.value,"onUpdate:modelValue":l[4]||(l[4]=i=>s.value=i)},{default:c(()=>[n("div",B,[n("div",F,[n("div",null,"Request ID: "+_(a.value.id),1),n("div",P," Name: "+_(a.value.employee_id.first_name)+" "+_(a.value.employee_id.last_name),1),a.value.admin_id?(f(),w("div",j," Admin: "+_(a.value.admin_id.first_name)+" "+_(a.value.admin_id.last_name)+" - "+_(a.value.is_approved===null?"Pending":a.value.is_approved===!0?"Approved Request":a.value.is_approved===!1?"Declined Request":""),1)):k("",!0),O,n("div",G,[r(R,{dense:d.dense,modelValue:a.value.description,"onUpdate:modelValue":l[1]||(l[1]=i=>a.value.description=i),disable:"",autogrow:"",filled:"","hide-bottom-space":""},null,8,["dense","modelValue"])]),H,n("div",T,[(f(!0),w(V,null,S(a.value.date_list,i=>(f(),w("div",{key:i,dense:d.dense,disable:"",autogrow:"",filled:"","hide-bottom-space":""},[r(R,{filled:"",modelValue:i.date,"onUpdate:modelValue":b=>i.date=b,mask:"date",rules:["date"],disable:""},{append:c(()=>[r(C,{name:"event",class:"cursor-pointer"},{default:c(()=>[r(L,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:c(()=>[r(E,{modelValue:i.date,"onUpdate:modelValue":b=>i.date=b},{default:c(()=>[n("div",J,[h(r(v,{label:"Close",color:"primary",flat:""},null,512),[[y]])])]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024)]),_:2},1032,["modelValue","onUpdate:modelValue"])],8,z))),128))])]),r(I,{align:"right",class:"text-primary"},{default:c(()=>[h((f(),A(v,{onClick:l[2]||(l[2]=i=>g(o).approveRequest(a.value.id,g(t).getEmployeeId,a.value.employee_id.id,a.value.date_list)),class:"tw-bg-green-500"},{default:c(()=>[N("Approve")]),_:1})),[[y]]),h((f(),A(v,{onClick:l[3]||(l[3]=i=>g(o).declineRequest(a.value.id,g(t).getEmployeeId)),class:"tw-bg-red-500"},{default:c(()=>[N("Refuse")]),_:1})),[[y]]),h(r(v,{flat:"",label:"Close"},null,512),[[y]])]),_:1})])]),_:1},8,["modelValue"])],64))}};export{te as _,x as u};
